# 航班数据包扩展说明

## 📋 更新概览

本次更新扩展了 `app/validators/support/data_packs/v1/flights.rb` 数据包，新增了多条城市往返航线的航班数据。

## 🛫 新增航线

### 1. 北京 ⇄ 上海
- **北京 → 上海**: 每天3个航班
  - CA1801 (07:30-10:00) 中国国航 - 首都T3→虹桥T2
  - MU5201 (12:00-14:30) 东方航空 - 大兴→浦东T2
  - CZ3401 (16:30-19:00) 南方航空 - 首都T2→虹桥T2
  
- **上海 → 北京**: 每天3个航班
  - MU5108 (08:15-10:45) 东方航空 - 虹桥T2→首都T3
  - CA1802 (13:30-16:00) 中国国航 - 浦东T2→大兴
  - HU7201 (18:45-21:15) 海南航空 - 虹桥T2→首都T2

### 2. 广州 ⇄ 成都
- **广州 → 成都**: 每天2个航班
  - CZ3601 (09:20-12:10) 南方航空 - 白云T2→双流T2
  - 3U8901 (15:40-18:30) 四川航空 - 白云T2→双流T1
  
- **成都 → 广州**: 每天2个航班
  - CZ3602 (10:15-13:05) 南方航空 - 双流T2→白云T2
  - MU5401 (17:25-20:15) 东方航空 - 双流T1→白云T2

### 3. 杭州 ⇄ 三亚
- **杭州 → 三亚**: 每天2个航班
  - GJ8801 (08:40-11:30) 长龙航空 - 萧山T3→凤凰T2
  - HU7601 (14:20-17:10) 海南航空 - 萧山T3→凤凰T2
  
- **三亚 → 杭州**: 每天2个航班
  - MU5601 (09:50-12:40) 东方航空 - 凤凰T2→萧山T3
  - 9C8901 (16:00-18:50) 春秋航空 - 凤凰T2→萧山T3

### 4. 西安 ⇄ 南京
- **西安 → 南京**: 每天2个航班
  - MU2201 (10:30-12:40) 东方航空 - 咸阳T3→禄口T2
  - HO1401 (17:15-19:25) 吉祥航空 - 咸阳T3→禄口T2
  
- **南京 → 西安**: 每天2个航班
  - MU2202 (11:20-13:30) 东方航空 - 禄口T2→咸阳T3
  - CA1601 (18:30-20:40) 中国国航 - 禄口T2→咸阳T3

## 📊 数据统计

### 原有数据
- 深圳 → 北京: 每天4个航班 (28个/7天)
- 上海 → 深圳: 每天2个航班 (14个/7天)

### 新增数据
- 北京 ⇄ 上海: 每天6个航班 (42个/7天)
- 广州 ⇄ 成都: 每天4个航班 (28个/7天)
- 杭州 ⇄ 三亚: 每天4个航班 (28个/7天)
- 西安 ⇄ 南京: 每天4个航班 (28个/7天)

### 总计
- **总航班数**: 168个航班 (24个/天 × 7天)
- **覆盖航线**: 10条航线
- **覆盖城市**: 8个城市
- **参与航司**: 7家航空公司

## 💰 价格区间

| 航线 | 最低价 | 最高价 | 平均价 |
|------|--------|--------|--------|
| 深圳→北京 | ¥550 | ¥1200 | ¥830 |
| 上海→深圳 | ¥450 | ¥520 | ¥485 |
| 北京⇄上海 | ¥650 | ¥870 | ¥770 |
| 广州⇄成都 | ¥570 | ¥700 | ¥635 |
| 杭州⇄三亚 | ¥720 | ¥950 | ¥850 |
| 西安⇄南京 | ¥520 | ¥640 | ¥580 |

## 🛠️ 技术特性

### 数据生成策略
- **日期范围**: 未来7天 (从明天开始)
- **动态生成**: 使用 `Date.current + 1.day` 确保数据始终有效
- **批量插入**: 使用 `insert_all` 提高性能
- **自动ID**: 不使用显式ID，让数据库自动生成

### 航班编号规则
- 基础编号 + day_suffix (相对于当前日期的天数差)
- 确保每个航班都有唯一的航班号
- 示例: CA1234, CA1235, CA1236...

### 数据完整性
- 每个航班包含完整信息:
  - 出发/到达城市
  - 出发/到达机场
  - 起飞/降落时间
  - 航空公司
  - 航班号
  - 机型
  - 价格/折扣价
  - 舱位等级
  - 可用座位数

## 📦 使用方法

### 1. 加载所有数据包
```bash
rails runner "Dir.glob(Rails.root.join('app/validators/support/data_packs/v1/*.rb')).sort.each { |f| load f }"
```

### 2. 仅加载航班数据包
```bash
rails runner "load Rails.root.join('app/validators/support/data_packs/v1/flights.rb')"
```

### 3. 验证数据加载
```bash
rails runner "puts 'Total flights: ' + Flight.count.to_s"
```

### 4. 查看航线统计
```bash
rails runner "Flight.group(:departure_city, :destination_city).count.each { |k, v| puts '  ' + k.join(' -> ') + ': ' + v.to_s }"
```

## ✅ 测试结果

运行测试脚本后的输出:
```
正在加载 flights_v1 数据包...
  航班日期范围: 2026-01-23 至 2026-01-29 (共7天)
✓ flights_v1 数据包加载完成（共 168 个航班）
  - 深圳到北京: 每天4个航班，最低价 550元（共 28 个）
  - 上海到深圳: 每天2个航班，最低价 450元（共 14 个）
  - 北京往返上海: 每天各3个航班（共 42 个）
  - 广州往返成都: 每天各2个航班（共 28 个）
  - 杭州往返三亚: 每天各2个航班（共 28 个）
  - 西安往返南京: 每天各2个航班（共 28 个）
航班总数: 210
```

**注意**: 实际数据库中有210个航班（包括了之前已存在的数据），新加载的是168个。

## 🎯 应用场景

### 1. 单程搜索
用户可以搜索任意单程航班:
- 北京 → 上海
- 广州 → 成都
- 杭州 → 三亚
- 西安 → 南京

### 2. 往返搜索
用户可以搜索往返航班组合:
- 北京 ⇄ 上海 (商务出行)
- 广州 ⇄ 成都 (旅游线路)
- 杭州 ⇄ 三亚 (度假线路)
- 西安 ⇄ 南京 (文化旅游)

### 3. 多程搜索
支持多程组合搜索:
- 北京 → 上海 → 深圳
- 西安 → 成都 → 三亚

## 🔧 维护说明

### 添加新航线
在 `flights.rb` 文件中按照现有格式添加新的航线数据段:
```ruby
# ==================== 城市A <-> 城市B 往返航班 ====================
all_flights = []

(start_date..end_date).each do |date|
  # ... 添加航班数据
end

Flight.insert_all(all_flights)
```

### 修改航班数量
调整文件最后的统计数字:
```ruby
total_flights = (start_date..end_date).count * 24  # 更新这里的数字
```

### 更新价格
直接修改各航班的 `price` 和 `discount_price` 字段。

## 📝 更新日志

- **2026-01-22**: 初始版本，新增4条往返航线
  - 北京 ⇄ 上海
  - 广州 ⇄ 成都
  - 杭州 ⇄ 三亚
  - 西安 ⇄ 南京

---

**文件位置**: `app/validators/support/data_packs/v1/flights.rb`  
**总行数**: 589行  
**数据版本**: v1
