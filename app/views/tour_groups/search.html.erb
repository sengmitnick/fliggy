<div class="bg-gray-100">
  <!-- 搜索栏 - 固定顶部 -->
  <div class="sticky top-0 z-50 bg-white px-4 py-2 flex items-center space-x-3">
    <% 
      # 根据travel_type决定返回路径
      back_path = case @travel_type
      when '独立成团'
        private_groups_path
      when '自由出行'
        free_travels_path
      else
        tour_groups_path
      end
    %>
    <%= link_to back_path do %>
      <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
      </svg>
    <% end %>
    <div class="flex-1 relative" data-controller="filter-dropdown">
      <button type="button" 
              data-action="filter-dropdown#toggle" 
              data-dropdown-id="destination"
              class="w-full bg-gray-100 rounded-full flex items-center px-4 py-1.5 border border-yellow-400">
        <svg class="w-4 h-4 text-gray-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
        </svg>
        <span class="flex-1 text-gray-700 text-sm text-left"><%= @destination %></span>
        <svg class="w-3 h-3 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
          <path d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"/>
        </svg>
      </button>
      
      <!-- 目的地下拉菜单 -->
      <div data-filter-dropdown-target="dropdown" 
           data-dropdown-id="destination"
           class="hidden absolute top-full left-0 right-0 mt-2 bg-white rounded-lg shadow-lg border z-50 max-h-96 overflow-y-auto">
        <div class="py-2">
          <div class="px-3 py-2 text-gray-500 text-xs font-bold">选择目的地</div>
          <div class="grid grid-cols-2 gap-1 px-2">
            <% @destinations.each do |dest| %>
              <%= link_to dest, search_tour_groups_path(destination: dest), 
                  class: "block px-3 py-2 text-center rounded hover:bg-gray-50 transition-colors text-sm #{@destination == dest ? 'bg-primary/10 text-primary font-bold' : 'text-gray-700'}",
                  data: { action: 'filter-dropdown#selectOption' } %>
            <% end %>
          </div>
        </div>
      </div>
    </div>
    <svg class="w-6 h-6 text-gray-600" fill="currentColor" viewBox="0 0 24 24">
      <path d="M5 12h.01M12 12h.01M19 12h.01M6 12a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0z"/>
    </svg>
  </div>

  <!-- 主导航图标 -->
  <div class="bg-gray-100 pt-2">
    <div class="grid grid-cols-5 text-center text-xs text-gray-600">
      <% 
        tabs = [
          { id: 'comprehensive', icon: 'tourism_tabs/综合.png', icon_active: 'tourism_tabs/综合-激活.png', label: '综合' },
          { id: 'group_tour', icon: 'tourism_tabs/跟团游.png', icon_active: 'tourism_tabs/跟团游-激活.png', label: '跟团游' },
          { id: 'private_group', icon: 'tourism_tabs/独立成团.png', icon_active: 'tourism_tabs/独立成团-激活.png', label: '独立成团' },
          { id: 'free_travel', icon: 'tourism_tabs/自由出行.png', icon_active: 'tourism_tabs/自由出行-激活.png', label: '自由出行' },
          { id: 'outbound_essentials', icon: 'tourism_tabs/出境必备.png', icon_active: 'tourism_tabs/出境必备-激活.png', label: '出境必备' }
        ]
      %>
      
      <% tabs.each do |tab| %>
        <% 
          tab_travel_type = {'group_tour' => '跟团游', 'private_group' => '独立成团', 'free_travel' => '自由出行'}[tab[:id]]
          # 出境必备跳转到签证服务页面
          tab_url = tab[:id] == 'outbound_essentials' ? visa_services_path : search_tour_groups_path(destination: @destination, tab: tab[:id], travel_type: tab_travel_type)
        %>
        <%= link_to tab_url, 
            class: "flex flex-col items-center space-y-1 #{@active_tab == tab[:id] ? 'bg-white rounded-t-md pt-1' : ''}" do %>
          <div class="w-8 h-8 flex items-center justify-center">
            <%= image_tag(@active_tab == tab[:id] ? tab[:icon_active] : tab[:icon], 
                class: 'w-6 h-6', alt: tab[:label]) %>
          </div>
          <span class="<%= @active_tab == tab[:id] ? 'font-bold text-black text-sm' : '' %>">
            <%= tab[:label] %>
          </span>
        <% end %>
      <% end %>
    </div>
  </div>

  <!-- 二级导航 -->
  <div class="bg-white flex px-4 py-3 space-x-6 text-sm text-gray-600 border-b overflow-x-auto hide-scrollbar">
    <% 
      current_category = params[:tour_category].presence
      categories = [
        { label: '全部', value: nil },
        { label: '精品小团', value: 'group_tour' },
        { label: '多日游', value: 'private_group' },
        { label: '一日游', value: 'free_travel' }
      ]
    %>
    
    <% categories.each do |category| %>
      <% is_active = (current_category == category[:value]) || (current_category.nil? && category[:value].nil?) %>
      <%= link_to search_tour_groups_path(
            destination: @destination,
            duration: @duration,
            group_size: @group_size,
            tour_category: category[:value]
          ), 
          class: "relative flex flex-col items-center shrink-0 #{'font-bold text-black' if is_active} #{'text-gray-600' unless is_active}" do %>
        <span><%= category[:label] %></span>
        <% if is_active %>
          <div class="absolute -bottom-3 w-6 h-0.5 bg-black"></div>
        <% end %>
      <% end %>
    <% end %>
  </div>

  <!-- 顶部横排卡片 -->
  <div class="bg-white p-3 flex space-x-2 overflow-x-auto hide-scrollbar">
    <% 
      # 为每个目的地定义背景图片和主题色
      destination_config = {
        '云南' => { image: 'https://images.unsplash.com/photo-1508804185872-d7badad00f7d?w=600', color: 'bg-blue-900/40', desc: '彩云之南·古城风情' },
        '四川' => { image: 'https://images.unsplash.com/photo-1508253578933-20b529c1783d?w=600', color: 'bg-orange-900/40', desc: '天府之国·自然奇观' },
        '广西' => { image: 'https://images.unsplash.com/photo-1559827260-dc66d52bef19?w=600', color: 'bg-green-900/40', desc: '山水甲天下·民族风情' },
        '新疆' => { image: 'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=600', color: 'bg-yellow-900/40', desc: '丝路明珠·大漠风光' },
        '浙江' => { image: 'https://images.unsplash.com/photo-1548919973-5cef591cdbc9?w=600', color: 'bg-cyan-900/40', desc: '江南水乡·诗画山水' },
        '海南' => { image: 'https://images.unsplash.com/photo-1559827260-dc66d52bef19?w=600', color: 'bg-teal-900/40', desc: '椰风海韵·热带天堂' },
        '西藏' => { image: 'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=600', color: 'bg-purple-900/40', desc: '雪域高原·朝圣之旅' },
        '青海' => { image: 'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=600', color: 'bg-indigo-900/40', desc: '大美青海·湖光山色' }
      }
    %>
    
    <% @destinations.each do |dest| %>
      <% config = destination_config[dest] || { image: 'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=600', color: 'bg-gray-900/40', desc: '探索之旅' } %>
      <%= link_to search_tour_groups_path(destination: dest), class: "relative w-48 h-16 rounded-lg overflow-hidden shrink-0 #{'ring-2 ring-primary' if @destination == dest}" do %>
        <div class="absolute inset-0 <%= config[:color] %> flex flex-col items-center justify-center text-white">
          <span class="font-bold text-sm"><%= dest %></span>
          <span class="text-[10px] opacity-80"><%= config[:desc] %></span>
        </div>
        <%= image_tag config[:image], class: 'w-full h-full object-cover', alt: dest %>
      <% end %>
    <% end %>
  </div>

  <!-- 筛选栏 -->
  <div class="bg-white px-4 py-2 border-b" data-controller="filter-dropdown">
    <div class="flex justify-between text-xs">
      <!-- 智能排序 -->
      <div class="relative">
        <button type="button" 
                data-action="filter-dropdown#toggle" 
                data-dropdown-id="sort"
                class="flex items-center <%= @sort_by != 'smart' ? 'text-[#FF7043]' : 'text-gray-700' %> hover:text-[#FF5722] transition-colors relative">
          <span><%= @sort_by == 'smart' ? '智能排序' : @sort_by == 'sales' ? '销量优先' : '好评优先' %></span>
          <% if @sort_by != 'smart' %>
            <span class="absolute -top-1 -right-1 bg-[#FF5722] text-white text-[9px] w-4 h-4 rounded-full flex items-center justify-center font-bold">1</span>
          <% end %>
          <svg class="w-3 h-3 ml-1" fill="currentColor" viewBox="0 0 20 20">
            <path d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"/>
          </svg>
        </button>
        
        <!-- 排序下拉菜单 -->
        <div data-filter-dropdown-target="dropdown" 
             data-dropdown-id="sort"
             class="hidden absolute top-full left-0 mt-2 w-32 bg-white rounded-lg shadow-lg border z-50">
          <div class="py-2">
            <%= link_to '智能排序', search_tour_groups_path(destination: @destination, tour_category: @tour_category, sort_by: 'smart', tag: @selected_tag, duration: @duration, departure_city: @departure_city, travel_type: @travel_type), 
                class: "block px-4 py-2 hover:bg-gray-50 transition-colors #{@sort_by == 'smart' ? 'text-primary font-bold' : 'text-gray-700'}",
                data: { action: 'filter-dropdown#selectOption' } %>
            <%= link_to '销量优先', search_tour_groups_path(destination: @destination, tour_category: @tour_category, sort_by: 'sales', tag: @selected_tag, duration: @duration, departure_city: @departure_city, travel_type: @travel_type), 
                class: "block px-4 py-2 hover:bg-gray-50 transition-colors #{@sort_by == 'sales' ? 'text-primary font-bold' : 'text-gray-700'}",
                data: { action: 'filter-dropdown#selectOption' } %>
            <%= link_to '好评优先', search_tour_groups_path(destination: @destination, tour_category: @tour_category, sort_by: 'rating', tag: @selected_tag, duration: @duration, departure_city: @departure_city, travel_type: @travel_type), 
                class: "block px-4 py-2 hover:bg-gray-50 transition-colors #{@sort_by == 'rating' ? 'text-primary font-bold' : 'text-gray-700'}",
                data: { action: 'filter-dropdown#selectOption' } %>
          </div>
        </div>
      </div>
      
      <!-- 旅游类型 -->
      <div class="relative">
        <button type="button" 
                data-action="filter-dropdown#toggle" 
                data-dropdown-id="travel-type"
                class="flex items-center <%= @travel_type.present? ? 'text-[#FF7043]' : 'text-gray-700' %> hover:text-[#FF5722] transition-colors relative">
          <span><%= @travel_type.present? ? @travel_type : '旅游类型' %></span>
          <% if @travel_type.present? %>
            <span class="absolute -top-1 -right-1 bg-[#FF5722] text-white text-[9px] w-4 h-4 rounded-full flex items-center justify-center font-bold">1</span>
          <% end %>
          <svg class="w-3 h-3 ml-1" fill="currentColor" viewBox="0 0 20 20">
            <path d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"/>
          </svg>
        </button>
        
        <!-- 旅游类型下拉菜单 -->
        <div data-filter-dropdown-target="dropdown" 
             data-dropdown-id="travel-type"
             class="hidden absolute top-full left-1/2 -translate-x-1/2 mt-2 w-40 bg-white rounded-lg shadow-lg border z-50">
          <div class="py-2">
            <div class="px-3 py-2 text-gray-500 text-xs font-bold">选择类型</div>
            <%= link_to '全部', search_tour_groups_path(destination: @destination, tour_category: @tour_category, sort_by: @sort_by, tag: @selected_tag, duration: @duration, departure_city: @departure_city), 
                class: "block px-4 py-2 hover:bg-gray-50 transition-colors #{@travel_type.blank? ? 'text-primary font-bold' : 'text-gray-700'}",
                data: { action: 'filter-dropdown#selectOption' } %>
            <%= link_to '跟团游', search_tour_groups_path(destination: @destination, tour_category: @tour_category, sort_by: @sort_by, tag: @selected_tag, duration: @duration, departure_city: @departure_city, travel_type: '跟团游'), 
                class: "block px-4 py-2 hover:bg-gray-50 transition-colors #{@travel_type == '跟团游' ? 'text-primary font-bold' : 'text-gray-700'}",
                data: { action: 'filter-dropdown#selectOption' } %>
            <%= link_to '独立成团', search_tour_groups_path(destination: @destination, tour_category: @tour_category, sort_by: @sort_by, tag: @selected_tag, duration: @duration, departure_city: @departure_city, travel_type: '独立成团'), 
                class: "block px-4 py-2 hover:bg-gray-50 transition-colors #{@travel_type == '独立成团' ? 'text-primary font-bold' : 'text-gray-700'}",
                data: { action: 'filter-dropdown#selectOption' } %>
            <%= link_to '自由出行', search_tour_groups_path(destination: @destination, tour_category: @tour_category, sort_by: @sort_by, tag: @selected_tag, duration: @duration, departure_city: @departure_city, travel_type: '自由出行'), 
                class: "block px-4 py-2 hover:bg-gray-50 transition-colors #{@travel_type == '自由出行' ? 'text-primary font-bold' : 'text-gray-700'}",
                data: { action: 'filter-dropdown#selectOption' } %>
          </div>
        </div>
      </div>
      
      <!-- 出发地 -->
      <div class="relative">
        <button type="button" 
                data-action="filter-dropdown#toggle" 
                data-dropdown-id="departure"
                class="flex items-center <%= @departure_city.present? ? 'text-[#FF7043]' : 'text-gray-700' %> hover:text-[#FF5722] transition-colors relative">
          <span><%= @departure_city.present? ? @departure_city : '出发地' %></span>
          <% if @departure_city.present? %>
            <span class="absolute -top-1 -right-1 bg-[#FF5722] text-white text-[9px] w-4 h-4 rounded-full flex items-center justify-center font-bold">1</span>
          <% end %>
          <svg class="w-3 h-3 ml-1" fill="currentColor" viewBox="0 0 20 20">
            <path d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"/>
          </svg>
        </button>
        
        <!-- 出发地下拉菜单 -->
        <div data-filter-dropdown-target="dropdown" 
             data-dropdown-id="departure"
             class="hidden fixed top-[180px] left-1/2 -translate-x-1/2 w-[380px] bg-white rounded-lg shadow-lg border z-50 max-h-[70vh] overflow-y-auto">
          <div class="py-3">
            <% @departure_city_groups.each_with_index do |group, index| %>
              <!-- 分组标题 -->
              <div class="px-4 py-2 flex items-center justify-between">
                <h3 class="text-gray-700 text-sm font-bold"><%= group[:title] %></h3>
                <button type="button" 
                        class="text-gray-400 hover:text-gray-600 transition-colors"
                        data-action="click->filter-dropdown#toggleGroup"
                        data-group-index="<%= index %>">
                  <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"/>
                  </svg>
                </button>
              </div>
              
              <!-- 城市网格 -->
              <div class="grid grid-cols-4 gap-2 px-3 pb-3" data-group="<%= index %>">
                <% group[:cities].each do |city| %>
                  <%= link_to city, search_tour_groups_path(destination: @destination, tour_category: @tour_category, sort_by: @sort_by, tag: @selected_tag, duration: @duration, departure_city: city, travel_type: @travel_type), 
                      class: "block px-3 py-2 text-center rounded hover:bg-gray-100 transition-colors text-sm #{@departure_city == city ? 'bg-gray-200 text-gray-900 font-bold' : 'text-gray-600'}",
                      data: { action: 'filter-dropdown#selectOption' } %>
                <% end %>
              </div>
              
              <% if index < @departure_city_groups.length - 1 %>
                <div class="border-t my-2"></div>
              <% end %>
            <% end %>
            
            <!-- 底部按钮 -->
            <div class="border-t mt-3 pt-3 px-3 flex gap-2">
              <%= link_to '重置', search_tour_groups_path(destination: @destination, tour_category: @tour_category, sort_by: @sort_by, tag: @selected_tag, duration: @duration, travel_type: @travel_type), 
                  class: "flex-1 px-4 py-2.5 text-center rounded-full border border-gray-300 text-gray-600 hover:bg-gray-50 transition-colors text-sm",
                  data: { action: 'filter-dropdown#selectOption' } %>
              <button type="button" 
                      data-action="click->filter-dropdown#closeAllDropdowns"
                      class="flex-1 px-4 py-2.5 text-center rounded-full bg-[#FFD54F] text-gray-800 font-bold hover:bg-[#FFC107] transition-colors text-sm">
                完成
              </button>
            </div>
          </div>
        </div>
      </div>
      
      <!-- 天数/日期 -->
      <div class="relative">
        <button type="button" 
                data-action="filter-dropdown#toggle" 
                data-dropdown-id="duration"
                class="flex items-center <%= @duration.present? && @duration > 0 ? 'text-[#FF7043]' : 'text-gray-700' %> hover:text-[#FF5722] transition-colors relative">
          <span><%= @duration.present? && @duration > 0 ? "#{@duration}日" : '天数/日期' %></span>
          <% if @duration.present? && @duration > 0 %>
            <span class="absolute -top-1 -right-1 bg-[#FF5722] text-white text-[9px] w-4 h-4 rounded-full flex items-center justify-center font-bold">1</span>
          <% end %>
          <svg class="w-3 h-3 ml-1" fill="currentColor" viewBox="0 0 20 20">
            <path d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"/>
          </svg>
        </button>
        
        <!-- 天数下拉菜单 -->
        <div data-filter-dropdown-target="dropdown" 
             data-dropdown-id="duration"
             class="hidden absolute top-full left-1/2 -translate-x-1/2 mt-2 w-56 bg-white rounded-lg shadow-lg border z-50">
          <div class="py-2">
            <div class="px-3 py-2 text-gray-500 text-xs font-bold">选择天数</div>
            <div class="grid grid-cols-4 gap-2 px-3 pb-2">
              <% [1, 2, 3, 4, 5, 6, 7, 8].each do |day| %>
                <%= link_to "#{day}日", search_tour_groups_path(destination: @destination, tour_category: @tour_category, sort_by: @sort_by, tag: @selected_tag, duration: day, departure_city: @departure_city, travel_type: @travel_type), 
                    class: "block px-3 py-2 text-center rounded hover:bg-gray-50 transition-colors #{@duration == day ? 'text-primary font-bold bg-primary/10' : 'text-gray-700'}",
                    data: { action: 'filter-dropdown#selectOption' } %>
              <% end %>
            </div>
            <% if @duration.present? && @duration > 0 %>
              <%= link_to '清除', search_tour_groups_path(destination: @destination, tour_category: @tour_category, sort_by: @sort_by, tag: @selected_tag, departure_city: @departure_city, travel_type: @travel_type), 
                  class: "block mx-3 mb-2 px-3 py-2 text-center rounded text-red-600 hover:bg-red-50 transition-colors text-xs",
                  data: { action: 'filter-dropdown#selectOption' } %>
            <% end %>
          </div>
        </div>
      </div>
      
      <!-- 套餐类型 -->
      <div class="relative">
        <button type="button" 
                data-action="filter-dropdown#toggle" 
                data-dropdown-id="filter"
                class="flex items-center <%= @selected_tag.present? ? 'text-[#FF7043]' : 'text-gray-700' %> hover:text-[#FF5722] transition-colors relative">
          <span><%= @selected_tag.present? ? @selected_tag : '套餐类型' %></span>
          <% if @selected_tag.present? %>
            <span class="absolute -top-1 -right-1 bg-[#FF5722] text-white text-[9px] w-4 h-4 rounded-full flex items-center justify-center font-bold">1</span>
          <% end %>
          <svg class="w-3 h-3 ml-1" fill="currentColor" viewBox="0 0 20 20">
            <path d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z"/>
          </svg>
        </button>
        
        <!-- 特色标签下拉菜单 -->
        <div data-filter-dropdown-target="dropdown" 
             data-dropdown-id="filter"
             class="hidden absolute top-full right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border z-50">
          <div class="py-2">
            <div class="px-3 py-2 text-gray-500 text-xs font-bold">特色标签</div>
            <% ['不用早起', '往返直飞', '全额退', '无自费', '纯玩无购物', '小团出行', '含门票', '上门接送'].each do |tag| %>
              <%= link_to tag, search_tour_groups_path(destination: @destination, tour_category: @tour_category, sort_by: @sort_by, tag: tag, duration: @duration, departure_city: @departure_city, travel_type: @travel_type), 
                  class: "block px-4 py-2 hover:bg-gray-50 transition-colors #{@selected_tag == tag ? 'text-primary font-bold' : 'text-gray-700'}",
                  data: { action: 'filter-dropdown#selectOption' } %>
            <% end %>
            <% if @selected_tag.present? %>
              <div class="border-t mt-2 pt-2">
                <%= link_to '清除筛选', search_tour_groups_path(destination: @destination, tour_category: @tour_category, sort_by: @sort_by, duration: @duration, departure_city: @departure_city, travel_type: @travel_type), 
                    class: "block mx-3 px-3 py-2 text-center rounded text-red-600 hover:bg-red-50 transition-colors text-xs",
                    data: { action: 'filter-dropdown#selectOption' } %>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>
    
    <!-- 遮罩层 -->
    <div data-filter-dropdown-target="overlay" 
         data-action="click->filter-dropdown#closeOnOverlay"
         class="hidden fixed inset-0 bg-black/20 z-40"></div>
  </div>

  <!-- 列表内容 -->
  <div class="space-y-3 p-3">
    <% if @search_results.empty? %>
      <!-- 空状态提示 -->
      <div class="bg-white rounded-lg p-8 text-center">
        <div class="text-gray-300 mb-4">
          <svg class="w-20 h-20 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M12 12h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
        </div>
        <h3 class="text-lg font-bold text-gray-700 mb-2">暂无相关产品</h3>
        <p class="text-gray-500 text-sm">暂无<%= @destination %>相关旅游产品，请尝试其他目的地</p>
      </div>
    <% else %>
      <% @search_results.each_with_index do |result, index| %>
        <!-- 卡片 <%= index + 1 %> -->
        <%= link_to tour_group_path(result[:id]), class: "bg-white rounded-md flex overflow-hidden hover:shadow-md transition-shadow" do %>
          <div class="relative w-32 h-44 shrink-0">
            <div class="absolute top-0 left-0 bg-black/60 text-white text-[10px] px-1.5 py-0.5 rounded-br-lg"><%= result[:badge] %></div>
            <% if result[:departure].present? %>
              <div class="absolute bottom-0 w-full text-center bg-black/30 text-white text-[10px] py-1"><%= result[:departure] %></div>
            <% end %>
            <div class="w-full h-full bg-sky-200 flex items-center justify-center">
              <%= image_tag result[:image], class: 'w-full h-full object-cover', alt: result[:title] %>
            </div>
          </div>
          <div class="flex-1 p-2 flex flex-col justify-between">
            <div>
              <h3 class="font-bold text-sm leading-snug line-clamp-2"><%= result[:title] %></h3>
              <% if result[:rating].present? %>
                <div class="mt-1 flex items-center text-[10px]">
                  <span class="bg-blue-600 text-white px-1 rounded-sm mr-1 font-bold"><%= result[:rating] %></span>
                  <span class="text-blue-600 font-bold">超棒</span>
                  <span class="text-gray-400 ml-1"><%= result[:rating_desc] %></span>
                </div>
              <% end %>
              <% if result[:highlights].present? %>
                <div class="text-[11px] text-gray-500 mt-1"><%= result[:highlights].join('·') %></div>
              <% end %>
              <% if result[:tags].present? %>
                <div class="flex space-x-1 mt-1">
                  <% result[:tags].each do |tag| %>
                    <span class="text-[9px] border border-gray-200 text-gray-400 px-1 rounded"><%= tag %></span>
                  <% end %>
                </div>
              <% end %>
            </div>
            <div class="flex justify-between items-end">
              <div class="text-[10px] text-gray-400">
                <% if result[:provider].present? %>
                  <div><%= result[:provider] %></div>
                <% end %>
                <% if result[:sales].present? %>
                  <div><%= result[:sales] %></div>
                <% end %>
              </div>
              <div class="text-red-500 font-bold">
                <span class="text-xs">¥</span><span class="text-xl"><%= result[:price].gsub('¥', '') %></span><span class="text-xs font-normal ml-0.5 text-gray-500"><%= result[:price_suffix] %></span>
              </div>
            </div>
          </div>
        <% end %>
      <% end %>
    <% end %>
  </div>
</div>

<style>
  .hide-scrollbar::-webkit-scrollbar {
    display: none;
  }
  .hide-scrollbar {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
  
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
