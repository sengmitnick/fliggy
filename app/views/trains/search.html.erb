<div class="min-h-screen bg-surface" data-controller="train-list">
  <!-- Header with Route Info -->
  <div class="bg-white border-b border-border sticky top-0 z-10">
    <!-- Back Button and Actions -->
    <div class="flex items-center justify-between px-4 py-3">
      <%= link_to trains_path, class: "text-foreground" do %>
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
        </svg>
      <% end %>
      
      <div class="flex items-center gap-2 text-lg font-medium">
        <span><%= @departure_city %></span>
        <svg class="w-4 h-4 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
        </svg>
        <span><%= @arrival_city %></span>
      </div>
      
      <div class="flex items-center gap-3">
        <button class="text-foreground">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"/>
          </svg>
        </button>
      </div>
    </div>
    
    <!-- Date Selector -->
    <div class="flex overflow-x-auto gap-2 px-4 pb-3 no-scrollbar">
      <% (0..4).each do |offset| %>
        <% target_date = Date.today + offset.days %>
        <% is_selected = target_date == @date %>
        <%= link_to search_trains_path(
          departure_city: @departure_city,
          arrival_city: @arrival_city,
          date: target_date,
          sort_by: @sort_by,
          only_high_speed: @only_high_speed
        ), class: "flex flex-col items-center justify-center px-4 py-2 rounded-lg whitespace-nowrap transition-colors #{is_selected ? 'bg-primary text-primary-foreground' : 'bg-surface-elevated text-foreground'}" do %>
          <div class="text-xs text-muted-foreground <%= 'text-primary-foreground' if is_selected %>">
            <%= offset == 0 ? '今天' : offset == 1 ? '明天' : target_date.strftime('%m-%d') %>
          </div>
          <div class="text-base font-medium">
            <%= target_date.strftime('%d') %>
          </div>
        <% end %>
      <% end %>
    </div>
  </div>

  <!-- Tab Navigation -->
  <div class="bg-white border-b border-border sticky top-[120px] z-10">
    <div class="flex items-center px-4 py-3 gap-6">
      <button class="text-sm font-medium text-primary border-b-2 border-primary pb-1">
        火车票
      </button>
      <button class="text-sm text-muted-foreground">
        智能中转
      </button>
      <button class="text-sm text-muted-foreground">
        机票
      </button>
    </div>
  </div>

  <!-- Flight Promo Banner -->
  <div class="bg-gradient-to-r from-orange-50 to-red-50 mx-4 mt-3 rounded-lg p-3 flex items-center justify-between">
    <div class="flex items-center gap-2">
      <span class="bg-gradient-to-r from-orange-500 to-red-500 text-white text-xs px-2 py-1 rounded">机票</span>
      <span class="text-sm"><%= @departure_city %></span>
      <svg class="w-4 h-4 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/>
      </svg>
      <span class="text-sm"><%= @arrival_city %></span>
      <span class="text-xs text-muted-foreground">2时15分</span>
      <span class="text-xs px-2 py-0.5 border border-red-300 text-red-600 rounded">比高铁便宜¥163</span>
      <span class="text-xs px-2 py-0.5 border border-red-300 text-red-600 rounded">超值特惠</span>
    </div>
    <div class="flex items-center gap-1">
      <span class="text-red-500 text-lg font-bold">¥400</span>
      <span class="text-xs text-muted-foreground">起</span>
    </div>
  </div>

  <!-- Coupon Banner -->
  <div class="bg-white mx-4 mt-2 rounded-lg p-3 flex items-center justify-between">
    <div class="flex items-center gap-2">
      <svg class="w-5 h-5 text-red-500" fill="currentColor" viewBox="0 0 24 24">
        <path d="M20 6h-2.18c.11-.31.18-.65.18-1 0-1.66-1.34-3-3-3-1.05 0-1.96.54-2.5 1.35l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm11 15H4v-2h16v2zm0-5H4V8h5.08L7 10.83 8.62 12 11 8.76l1-1.36 1 1.36L15.38 12 17 10.83 14.92 8H20v6z"/>
      </svg>
      <span class="text-sm"><span class="text-red-500 font-medium">新客专享</span> 可享<span class="text-red-500 font-medium">2元优惠券</span>，下单更优惠</span>
    </div>
    <button class="text-sm text-primary px-3 py-1 border border-primary rounded-full">
      查看
    </button>
  </div>

  <!-- Filter Tags -->
  <div class="flex items-center gap-2 px-4 py-3 overflow-x-auto no-scrollbar">
    <button class="px-3 py-1 rounded-full text-sm whitespace-nowrap <%= @only_high_speed ? 'bg-primary text-primary-foreground' : 'bg-surface-elevated text-foreground' %>"
            data-action="click->train-list#toggleFilter"
            data-filter="only-tickets">
      只看有票
    </button>
    <button class="px-3 py-1 rounded-full text-sm whitespace-nowrap bg-surface-elevated text-foreground"
            data-action="click->train-list#toggleStation"
            data-station="departure">
      北京站
    </button>
    <button class="px-3 py-1 rounded-full text-sm whitespace-nowrap bg-surface-elevated text-foreground"
            data-action="click->train-list#toggleStation"
            data-station="arrival">
      杭州站
    </button>
    <%= link_to search_trains_path(
      departure_city: @departure_city,
      arrival_city: @arrival_city,
      date: @date,
      sort_by: @sort_by,
      only_high_speed: !@only_high_speed
    ), class: "px-3 py-1 rounded-full text-sm whitespace-nowrap #{@only_high_speed ? 'bg-primary text-primary-foreground' : 'bg-surface-elevated text-foreground'}" do %>
      高铁动车
    <% end %>
    <button class="px-3 py-1 rounded-full text-sm whitespace-nowrap bg-surface-elevated text-foreground"
            data-action="click->train-list#toggleFilter"
            data-filter="can-split">
      可积分兑换
    </button>
  </div>

  <!-- Train List -->
  <div class="px-4 pb-20">
    <% if @trains.any? %>
      <% @trains.each do |train| %>
        <%= link_to train_path(train), class: "block" do %>
          <div class="bg-white rounded-xl shadow-sm border border-border hover:shadow-md transition-shadow mb-3 overflow-hidden" data-train-list-target="trainItem">
            <!-- Main Train Info -->
            <div class="p-4">
              <div class="flex items-center justify-between mb-4">
                <!-- Departure Time & Station -->
                <div class="flex-1">
                  <div class="text-3xl font-bold text-foreground mb-1">
                    <%= train.departure_time.strftime('%H:%M') %>
                  </div>
                  <div class="text-sm text-muted-foreground">
                    <%= train.departure_city %>
                  </div>
                </div>
                
                <!-- Duration & Train Number -->
                <div class="flex-1 flex flex-col items-center px-4">
                  <div class="inline-flex items-center gap-1.5 px-3 py-1 bg-primary/10 rounded-full mb-2">
                    <span class="text-sm font-semibold text-primary">
                      <%= train.train_number %>
                    </span>
                    <% if train.train_number.start_with?('G') %>
                      <span class="text-xs px-1.5 py-0.5 bg-primary text-primary-foreground rounded">复兴号</span>
                    <% end %>
                  </div>
                  <div class="flex items-center gap-2 text-xs text-muted-foreground">
                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    <span><%= (train.duration / 60).to_i %>时<%= train.duration % 60 %>分</span>
                  </div>
                  <!-- Progress Line -->
                  <div class="w-full max-w-[100px] h-0.5 bg-border mt-2 relative">
                    <div class="absolute left-0 top-1/2 -translate-y-1/2 w-2 h-2 rounded-full bg-primary"></div>
                    <div class="absolute right-0 top-1/2 -translate-y-1/2 w-2 h-2 rounded-full border-2 border-primary bg-white"></div>
                  </div>
                </div>
                
                <!-- Arrival Time & Station -->
                <div class="flex-1 text-right">
                  <div class="text-3xl font-bold text-foreground mb-1">
                    <%= train.arrival_time.strftime('%H:%M') %>
                    <% if train.arrival_time.to_date > train.departure_time.to_date %>
                      <span class="text-xs font-normal px-1.5 py-0.5 bg-orange-100 text-orange-600 rounded ml-1 align-middle">次日</span>
                    <% end %>
                  </div>
                  <div class="text-sm text-muted-foreground">
                    <%= train.arrival_city %>
                  </div>
                </div>
              </div>
              
              <!-- Seat Types & Availability -->
              <div class="flex items-center gap-3 py-3 px-4 bg-surface-elevated rounded-lg">
                <% if train.price_business_class && train.price_business_class > 0 %>
                  <div class="flex-1 text-center py-2 px-3 bg-white rounded-lg border border-border hover:border-primary transition-colors cursor-pointer">
                    <div class="text-xs text-muted-foreground mb-1">商务座</div>
                    <div class="text-sm font-semibold text-foreground">¥<%= train.price_business_class.to_i %></div>
                    <div class="text-xs text-green-600 mt-0.5"><%= (rand(100) + 10).to_s %>张</div>
                  </div>
                <% end %>
                <% if train.price_first_class && train.price_first_class > 0 %>
                  <div class="flex-1 text-center py-2 px-3 bg-white rounded-lg border border-border hover:border-primary transition-colors cursor-pointer">
                    <div class="text-xs text-muted-foreground mb-1">一等座</div>
                    <div class="text-sm font-semibold text-foreground">¥<%= train.price_first_class.to_i %></div>
                    <div class="text-xs text-green-600 mt-0.5">有票</div>
                  </div>
                <% end %>
                <% if train.price_second_class && train.price_second_class > 0 %>
                  <div class="flex-1 text-center py-2 px-3 bg-white rounded-lg border-2 border-primary hover:bg-primary/5 transition-colors cursor-pointer">
                    <div class="text-xs text-muted-foreground mb-1">二等座</div>
                    <div class="text-lg font-bold text-primary">¥<%= train.price_second_class.to_i %></div>
                    <div class="text-xs <%= train.available_seats > 0 ? 'text-green-600' : 'text-red-600' %> mt-0.5">
                      <%= train.available_seats > 0 ? '有票' : '候补' %>
                    </div>
                  </div>
                <% end %>
                <% if train.available_seats == 0 %>
                  <div class="flex-1 text-center py-2 px-3 bg-white rounded-lg border border-orange-300 hover:border-orange-500 transition-colors cursor-pointer">
                    <div class="text-xs text-muted-foreground mb-1">无座</div>
                    <div class="text-sm font-semibold text-orange-600">¥<%= (train.price_second_class * 0.75).to_i %></div>
                    <div class="text-xs text-orange-600 mt-0.5">候补</div>
                  </div>
                <% end %>
              </div>
            </div>
            
            <!-- Tags & Features -->
            <% if train.train_number.start_with?('G') || rand(10) > 5 %>
              <div class="px-4 py-2 bg-surface-elevated border-t border-border flex items-center gap-2 text-xs">
                <% if train.train_number.start_with?('G') %>
                  <span class="inline-flex items-center gap-1 px-2 py-1 bg-blue-100 text-blue-700 rounded">
                    <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                      <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/>
                      <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"/>
                    </svg>
                    积分兑换
                  </span>
                <% end %>
                <% if rand(10) > 5 %>
                  <span class="inline-flex items-center gap-1 px-2 py-1 bg-red-100 text-red-700 rounded">
                    <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z" clip-rule="evenodd"/>
                    </svg>
                    立减¥<%= rand(20) + 5 %>
                  </span>
                <% end %>
              </div>
            <% end %>
          </div>
        <% end %>
      <% end %>
    <% else %>
      <div class="bg-white p-12 text-center">
        <svg class="w-20 h-20 mx-auto text-muted-foreground mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
        <p class="text-muted-foreground">暂无符合条件的车次</p>
      </div>
    <% end %>
  </div>

  <!-- Bottom Filter Bar -->
  <div class="fixed bottom-0 left-0 right-0 bg-white border-t border-border shadow-lg z-20">
    <div class="flex max-w-md mx-auto">
      <button class="flex-1 flex flex-col items-center justify-center py-3 text-foreground hover:bg-surface-elevated transition-colors"
              data-action="click->train-list#showAdvancedFilters">
        <svg class="w-5 h-5 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"/>
        </svg>
        <span class="text-xs">高级筛选</span>
      </button>
      
      <%= link_to search_trains_path(
        departure_city: @departure_city,
        arrival_city: @arrival_city,
        date: @date,
        sort_by: 'price',
        only_high_speed: @only_high_speed
      ), class: "flex-1 flex flex-col items-center justify-center py-3 #{@sort_by == 'price' ? 'text-primary' : 'text-foreground'} hover:bg-surface-elevated transition-colors" do %>
        <svg class="w-5 h-5 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
        <span class="text-xs">价格最低</span>
      <% end %>
      
      <%= link_to search_trains_path(
        departure_city: @departure_city,
        arrival_city: @arrival_city,
        date: @date,
        sort_by: 'duration',
        only_high_speed: @only_high_speed
      ), class: "flex-1 flex flex-col items-center justify-center py-3 #{@sort_by == 'duration' ? 'text-primary' : 'text-foreground'} hover:bg-surface-elevated transition-colors" do %>
        <svg class="w-5 h-5 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
        <span class="text-xs">耗时最短</span>
      <% end %>
      
      <%= link_to search_trains_path(
        departure_city: @departure_city,
        arrival_city: @arrival_city,
        date: @date,
        sort_by: 'departure_time',
        only_high_speed: @only_high_speed
      ), class: "flex-1 flex flex-col items-center justify-center py-3 #{@sort_by == 'departure_time' ? 'text-primary' : 'text-foreground'} hover:bg-surface-elevated transition-colors" do %>
        <svg class="w-5 h-5 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>
        </svg>
        <span class="text-xs">出发早-晚</span>
      <% end %>
    </div>
  </div>
</div>
