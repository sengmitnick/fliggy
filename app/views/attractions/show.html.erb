<div class="min-h-screen bg-background pb-20" data-controller="scroll-spy" data-scroll-spy-offset-value="120">
  <!-- Top Navigation -->
  <div class="sticky top-0 z-50 bg-background/95 backdrop-blur-sm border-b border-border">
    <div class="flex items-center justify-between px-4 h-14">
      <div class="flex items-center gap-4 flex-1 min-w-0">
        <button onclick="history.back()" class="text-foreground">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
          </svg>
        </button>
        <h1 class="text-lg font-semibold text-foreground truncate flex-1 min-w-0"><%= @attraction.name %></h1>
      </div>
      <div class="flex items-center gap-4">
        <button type="button" class="text-foreground-muted hover:text-foreground">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"></path>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Image Gallery -->
  <div class="relative bg-surface">
    <% if @attraction.cover_image.attached? %>
      <%= image_tag @attraction.cover_image, class: "w-full h-80 object-cover" %>
    <% else %>
      <div class="w-full h-80 bg-gray-200 flex items-center justify-center">
        <span class="text-6xl">🎫</span>
      </div>
    <% end %>
    
    <% if @attraction.gallery_images.attached? && @attraction.gallery_images.count > 0 %>
      <div class="absolute bottom-4 right-4 px-3 py-1 bg-surface-dark/80 backdrop-blur-sm rounded-full text-sm text-white">
        1/<%= @attraction.gallery_images.count + 1 %>
      </div>
    <% end %>
  </div>

  <!-- Basic Info -->
  <div class="bg-surface p-4">
    <h2 class="text-xl font-bold text-foreground mb-2"><%= @attraction.name %></h2>
    
    <div class="flex items-center gap-4 mb-3">
      <% if @attraction.average_rating > 0 %>
        <div class="flex items-center gap-1">
          <span class="text-2xl font-bold text-accent"><%= @attraction.average_rating %></span>
          <div class="flex">
            <% 5.times do |i| %>
              <svg class="w-4 h-4 <%= i < @attraction.average_rating.floor ? 'text-accent' : 'text-border' %>" fill="currentColor" viewBox="0 0 20 20">
                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
              </svg>
            <% end %>
          </div>
        </div>
        <span class="text-sm text-foreground-muted"><%= @attraction.reviews_count %>条评价</span>
      <% end %>
    </div>

    <% if @attraction.address.present? %>
      <p class="text-sm text-foreground-secondary mb-2">
        📍 <%= @attraction.address %>
      </p>
    <% end %>

    <% if @attraction.opening_hours.present? %>
      <p class="text-sm text-foreground-secondary">
        🕒 <%= @attraction.opening_hours %>
      </p>
    <% end %>
  </div>

  <!-- Tab Navigation -->
  <div class="sticky top-14 z-40 bg-background border-b border-border">
    <div class="flex overflow-x-auto scrollbar-hide">
      <a href="#tickets" 
         data-scroll-spy-target="tab" 
         data-section="tickets"
         data-action="click->scroll-spy#scrollToSection"
         class="flex-shrink-0 px-4 py-3 text-sm font-medium border-b-2 transition-colors border-transparent text-foreground-muted hover:text-foreground">
        门票
      </a>
      <a href="#activities" 
         data-scroll-spy-target="tab" 
         data-section="activities"
         data-action="click->scroll-spy#scrollToSection"
         class="flex-shrink-0 px-4 py-3 text-sm font-medium border-b-2 transition-colors border-transparent text-foreground-muted hover:text-foreground">
        园内项目
      </a>
      <a href="#tours" 
         data-scroll-spy-target="tab" 
         data-section="tours"
         data-action="click->scroll-spy#scrollToSection"
         class="flex-shrink-0 px-4 py-3 text-sm font-medium border-b-2 transition-colors border-transparent text-foreground-muted hover:text-foreground">
        一日游
      </a>
      <a href="#hotels" 
         data-scroll-spy-target="tab" 
         data-section="hotels"
         data-action="click->scroll-spy#scrollToSection"
         class="flex-shrink-0 px-4 py-3 text-sm font-medium border-b-2 transition-colors border-transparent text-foreground-muted hover:text-foreground">
        附近酒店
      </a>
      <a href="#reviews" 
         data-scroll-spy-target="tab" 
         data-section="reviews"
         data-action="click->scroll-spy#scrollToSection"
         class="flex-shrink-0 px-4 py-3 text-sm font-medium border-b-2 transition-colors border-transparent text-foreground-muted hover:text-foreground">
        评价
      </a>
    </div>
  </div>

  <!-- Page Content -->
  <div class="pb-4">
    <!-- Tickets Section -->
    <section id="tickets" data-scroll-spy-target="section" class="scroll-mt-28 bg-surface p-4 mb-4">
      <h3 class="text-base font-semibold text-foreground mb-3">门票</h3>
      
      <% if @tickets.any? %>
        <div class="space-y-3">
          <% @tickets.each do |ticket| %>
            <div class="border border-border rounded-lg p-4">
              <div class="flex items-start justify-between mb-2">
                <div class="flex-1">
                  <h4 class="font-semibold text-foreground mb-1"><%= ticket.name %></h4>
                  <% if ticket.validity_days && ticket.validity_days > 0 %>
                    <p class="text-xs text-foreground-muted">有效期：<%= ticket.validity_days %>天</p>
                  <% end %>
                </div>
                <div class="text-right">
                  <div class="flex items-baseline gap-1">
                    <span class="text-xs text-accent">¥</span>
                    <span class="text-xl font-bold text-accent"><%= ticket.current_price.to_i %></span>
                  </div>
                  <% if ticket.original_price && ticket.original_price > ticket.current_price %>
                    <div class="text-xs text-foreground-muted line-through">¥<%= ticket.original_price.to_i %></div>
                  <% end %>
                </div>
              </div>
              
              <% if ticket.requirements.present? %>
                <p class="text-sm text-foreground-secondary mb-3"><%= ticket.requirements %></p>
              <% end %>
              
              <%= link_to select_ticket_path(ticket), class: "btn-primary w-full text-center py-2" do %>
                立即预订
              <% end %>
            </div>
          <% end %>
        </div>
      <% else %>
        <div class="text-center py-8 text-foreground-muted">
          <div class="text-4xl mb-2">🎫</div>
          <p>暂无门票</p>
        </div>
      <% end %>
    </section>

    <!-- Activities Section -->
    <section id="activities" data-scroll-spy-target="section" class="scroll-mt-28 bg-surface p-4 mb-4">
      <h3 class="text-base font-semibold text-foreground mb-3">园内项目</h3>
      
      <% if @activities.any? %>
        <div class="space-y-3">
          <% @activities.each do |activity| %>
            <div class="border border-border rounded-lg p-4">
              <div class="flex items-start justify-between mb-2">
                <div class="flex-1">
                  <h4 class="font-semibold text-foreground mb-1"><%= activity.name %></h4>
                  <% if activity.duration.present? %>
                    <p class="text-xs text-foreground-muted">时长：<%= activity.duration %></p>
                  <% end %>
                </div>
                <div class="text-right">
                  <div class="flex items-baseline gap-1">
                    <span class="text-xs text-accent">¥</span>
                    <span class="text-xl font-bold text-accent"><%= activity.current_price.to_i %></span>
                  </div>
                </div>
              </div>
              
              <% if activity.description.present? %>
                <p class="text-sm text-foreground-secondary mb-3"><%= activity.description %></p>
              <% end %>
              
              <%= link_to new_attraction_activity_activity_order_path(activity), class: "btn-primary w-full text-center py-2" do %>
                立即预订
              <% end %>
            </div>
          <% end %>
        </div>
      <% else %>
        <div class="text-center py-8 text-foreground-muted">
          <div class="text-4xl mb-2">🎢</div>
          <p>暂无园内项目</p>
        </div>
      <% end %>
    </section>

    <!-- Tours Section -->
    <section id="tours" data-scroll-spy-target="section" class="scroll-mt-28 bg-surface p-4 mb-4">
      <h3 class="text-base font-semibold text-foreground mb-3">一日游 / 跟团游</h3>
      
      <% if @tours.any? %>
        <div class="space-y-3">
          <% @tours.each do |tour| %>
            <%= link_to tour_group_path(tour), class: "block border border-border rounded-lg p-4 hover:border-primary transition-colors" do %>
              <h4 class="font-semibold text-foreground mb-2"><%= tour.title %></h4>
              <div class="flex items-center justify-between">
                <div class="text-sm text-foreground-muted">
                  <% if tour.days && tour.days > 0 %>
                    <%= tour.days %>天<%= tour.nights %>晚
                  <% end %>
                </div>
                <div class="text-right">
                  <span class="text-xs text-accent">¥</span>
                  <span class="text-lg font-bold text-accent"><%= tour.price.to_i %></span>
                  <span class="text-xs text-foreground-muted">起</span>
                </div>
              </div>
            <% end %>
          <% end %>
        </div>
      <% else %>
        <div class="text-center py-8 text-foreground-muted">
          <div class="text-4xl mb-2">🚌</div>
          <p>暂无一日游产品</p>
        </div>
      <% end %>
    </section>

    <!-- Hotels Section -->
    <section id="hotels" data-scroll-spy-target="section" class="scroll-mt-28 bg-surface p-4 mb-4">
      <h3 class="text-base font-semibold text-foreground mb-3">附近酒店</h3>
      
      <% if @nearby_hotels.any? %>
        <div class="space-y-3">
          <% @nearby_hotels.each do |hotel| %>
            <%= link_to hotel_path(hotel), class: "block border border-border rounded-lg p-4 hover:border-primary transition-colors" do %>
              <div class="flex gap-3">
                <% if hotel.image_url.present? %>
                  <%= image_tag hotel.image_url, class: "w-20 h-20 object-cover rounded" %>
                <% else %>
                  <div class="w-20 h-20 bg-gray-200 rounded flex items-center justify-center">
                    <span class="text-2xl">🏨</span>
                  </div>
                <% end %>
                
                <div class="flex-1">
                  <h4 class="font-semibold text-foreground mb-1"><%= hotel.name %></h4>
                  <% if hotel.address.present? %>
                    <p class="text-xs text-foreground-muted mb-1">📍 <%= hotel.address %></p>
                  <% end %>
                  <div class="text-right">
                    <span class="text-xs text-accent">¥</span>
                    <span class="text-lg font-bold text-accent"><%= hotel.price.to_i %></span>
                    <span class="text-xs text-foreground-muted">起</span>
                  </div>
                </div>
              </div>
            <% end %>
          <% end %>
        </div>
      <% else %>
        <div class="text-center py-8 text-foreground-muted">
          <div class="text-4xl mb-2">🏨</div>
          <p>暂无附近酒店信息</p>
        </div>
      <% end %>
    </section>

    <!-- Reviews Section -->
    <section id="reviews" data-scroll-spy-target="section" class="scroll-mt-28 bg-surface p-4 mb-4">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-base font-semibold text-foreground">用户评价</h3>
        <% if @reviews.any? %>
          <span class="text-sm text-foreground-muted"><%= @attraction.reviews_count %>条评价</span>
        <% end %>
      </div>
      
      <% if @reviews.any? %>
        <div class="space-y-4">
          <% @reviews.each do |review| %>
            <div class="border-b border-border pb-4 last:border-0">
              <div class="flex items-center gap-2 mb-2">
                <div class="w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center font-bold text-primary">
                  <%= review.user.name[0] %>
                </div>
                <div class="flex-1">
                  <div class="font-medium text-foreground"><%= review.user.name %></div>
                  <div class="flex items-center gap-1">
                    <% review.rating.to_i.times do %>
                      <svg class="w-3 h-3 text-accent" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                      </svg>
                    <% end %>
                  </div>
                </div>
                <span class="text-xs text-foreground-muted"><%= review.created_at.strftime('%Y-%m-%d') %></span>
              </div>
              <p class="text-sm text-foreground-secondary"><%= review.comment %></p>
            </div>
          <% end %>
        </div>
        
        <!-- Pagination -->
        <div class="mt-4">
          <%= paginate @reviews %>
        </div>
      <% else %>
        <div class="text-center py-8 text-foreground-muted">
          <div class="text-4xl mb-2">💬</div>
          <p>暂无评价</p>
        </div>
      <% end %>
    </section>
  </div>
</div>
