<div class="min-h-screen bg-gray-100" data-controller="city-selector date-picker" data-city-selector-departure-city-value="深圳" data-city-selector-destination-city-value="杭州" data-date-picker-current-date-value="<%= Date.today.to_s %>">
  <!-- Header with Banner -->
  <div class="relative pb-8">
    <%= render 'shared/transport_header', background_image: '活动.png', return_path: root_path %>

    <!-- Tabs Container with Gray Background -->
    <div class="relative mx-4 -mt-3 overflow-hidden z-50">
      <%= render 'shared/transport_tabs', active_tab: :special_flight %>
  
      <!-- White Card Container with Form -->
      <div class="bg-white rounded-b-[24px] shadow-sm">
        <div class="px-4 py-4">
          <!-- Banner Section -->
          <div class="mb-4 p-4 rounded-xl" style="background: linear-gradient(135deg, #FFD93D 0%, #FFB347 100%);">
            <div class="flex items-center justify-between">
              <div>
                <div class="text-xl font-bold text-gray-900 mb-1">特价机票进群领</div>
                <div class="flex items-center gap-2">
                  <span class="px-2 py-0.5 bg-red-500 text-white text-xs rounded-full font-bold">特价机票</span>
                  <span class="text-xs text-gray-700">随心飞 特价机票 不错过</span>
                </div>
              </div>
              <%= image_tag "home/特价机票.png", class: "w-16 h-16", alt: "特价机票" %>
            </div>
          </div>

          <!-- Search Form -->
          <%= form_with url: search_flights_path, method: :get, data: { turbo: false, controller: "special-flights-form", action: "submit->special-flights-form#handleSubmit" }, class: "space-y-3" do |f| %>
            
            <!-- Departure City -->
            <div class="flex items-center justify-between py-3 border-b border-gray-100">
              <div class="text-sm text-gray-500">出发</div>
              <div class="flex items-center gap-2">
                <button type="button" 
                        data-action="click->city-selector#openDeparture"
                        class="text-lg font-bold text-gray-900">
                  <span data-city-selector-target="departure">深圳</span>
                </button>
                <%= f.hidden_field :departure_city, value: '深圳', data: { city_selector_target: "departureCityInput" } %>
              </div>
            </div>

            <!-- Destination Cities (Multi-select) -->
            <div class="flex items-center justify-between py-3 border-b border-gray-100">
              <div class="text-sm text-gray-500">目的地</div>
              <div class="flex items-center gap-2">
                <button type="button" 
                        data-action="click->city-selector#openDestination click->city-selector#switchToMultiSelect"
                        class="text-lg font-bold text-gray-900 flex items-center gap-1">
                  <span data-city-selector-target="destination">杭州</span>
                  <svg class="w-5 h-5 text-primary" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"/>
                  </svg>
                </button>
                <%= f.hidden_field :destination_cities, value: '杭州', data: { city_selector_target: "destinationCityInput" } %>
              </div>
            </div>

            <!-- Date Selection -->
            <div class="flex items-center justify-between py-3 border-b border-gray-100">
              <div class="text-sm text-gray-500">出发时间</div>
              <div class="flex items-center gap-2">
                <button type="button" 
                        data-action="click->date-picker#openModal"
                        class="text-base font-medium text-gray-900">
                  <span data-date-picker-target="selectedDate">
                    <%= Date.today.month %>月<%= Date.today.day %>日 <span class="text-sm text-gray-600">今天</span>
                  </span>
                </button>
                <%= f.hidden_field :date, value: Date.today, data: { date_picker_target: "dateInput" } %>
              </div>
            </div>

            <!-- Hidden fields for routing -->
            <%= f.hidden_field :sort_by, value: 'price' %>
            <%= f.hidden_field :trip_type, value: 'one_way' %>

            <!-- Search Button -->
            <div class="pt-2">
              <%= f.submit "搜索特价机票", class: "w-full py-4 rounded-full text-lg font-bold text-black", style: "background: #FFD700;" %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <!-- Special Offers Section -->
  <div class="px-4 py-6">
    <h2 class="text-lg font-bold text-gray-900 mb-4">精选特价推荐</h2>
    
    <div class="space-y-3">
      <%
        sample_offers = [
          { from: '深圳', to: '武汉', date: '02.25 周三', price: 320, discount: '超低1.6折' },
          { from: '深圳', to: '杭州', date: '01.06 周二', price: 247, discount: '超低1.3折' },
          { from: '深圳', to: '新加坡', date: '02.03 周二', price: 606, discount: '特价' },
          { from: '深圳', to: '曼谷', date: '02.25 周三', price: 414, discount: '特价' }
        ]
      %>
      
      <% sample_offers.each do |offer| %>
        <div class="bg-white rounded-lg p-4 shadow-sm hover:shadow-md transition-shadow">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-2">
              <%= image_tag "home/机票.png", class: "w-12 h-12 rounded", alt: "机票" %>
              <div>
                <div class="text-base font-bold text-gray-900">
                  <%= offer[:from] %> → <%= offer[:to] %>
                </div>
                <div class="text-xs text-gray-500"><%= offer[:date] %></div>
              </div>
            </div>
            <div class="text-right">
              <div class="text-sm text-red-500 font-bold mb-1"><%= offer[:discount] %></div>
              <div class="text-xl font-bold text-red-500">¥<%= offer[:price] %></div>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  </div>

  <!-- City Selector Modal -->
  <%= render 'shared/city_selector_modal' %>
  
  <!-- Date Picker Modal -->
  <%= render 'shared/date_picker_modal' %>
</div>
