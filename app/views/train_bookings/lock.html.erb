<div class="min-h-screen bg-yellow-400" 
     data-controller="train-booking-lock payment-confirmation"
     data-payment-confirmation-amount-value="<%= @train_booking.total_price.to_i %>"
     data-payment-confirmation-user-email-value="<%= current_user.email %>"
     data-payment-confirmation-payment-url-value="<%= pay_train_booking_path(@train_booking) %>"
     data-payment-confirmation-success-url-value="<%= success_train_booking_path(@train_booking) %>">
  <!-- Header -->
  <div class="bg-yellow-400 p-4">
    <div class="flex items-center justify-between">
      <%= link_to train_path(@train), class: "text-gray-900 text-2xl" do %>
        â†
      <% end %>
      
      <!-- Recording indicator (optional) -->
      <div class="flex items-center space-x-2">
        
        
      </div>
      
      <button type="button" onclick="window.showToast('åŠŸèƒ½å¼€å‘ä¸­')" class="text-gray-900 text-2xl">
        â‹¯
      </button>
    </div>
  </div>

  <!-- Main Content -->
  <div class="px-4 pt-8">
    <!-- Status Title -->
    <div class="mb-4">
      <h1 class="text-4xl font-bold text-gray-900" data-train-booking-lock-target="statusTitle">
        å åº§ä¸­ <span data-train-booking-lock-target="progressPercent">30</span>%
      </h1>
      <p class="text-gray-900 mt-2" data-train-booking-lock-target="statusMessage">
        æ­£åœ¨ä¸ºæ‚¨æäº¤è®¢å•ï¼Œè¯·è€å¿ƒç­‰å¾…
      </p>
    </div>

    <!-- Seat Animation -->
    <div class="flex justify-center mb-8">
      <div class="relative">
        <!-- Circular progress background -->
        <svg class="w-48 h-48" viewBox="0 0 200 200">
          <!-- Background circle -->
          <circle cx="100" cy="100" r="85" fill="none" stroke="rgba(255,255,255,0.3)" stroke-width="8"/>
          <!-- Progress circle -->
          <circle cx="100" cy="100" r="85" fill="none" stroke="white" stroke-width="8" 
                  stroke-dasharray="534" 
                  stroke-dashoffset="534"
                  transform="rotate(-90 100 100)"
                  data-train-booking-lock-target="progressCircle"
                  class="transition-all duration-500"/>
        </svg>
        
        <!-- Seat icon in center -->
        <div class="absolute inset-0 flex items-center justify-center">
          <div class="text-6xl" data-train-booking-lock-target="seatIcon">ğŸ’º</div>
        </div>
      </div>
    </div>

    <!-- Train Info Card -->
    <div class="bg-white rounded-lg shadow p-4 mb-4">
      <div class="flex items-center justify-between mb-4">
        <div class="text-sm text-gray-600">
          <%= @train.departure_time.strftime('%m-%d') %> å‘¨<%= %w[æ—¥ ä¸€ äºŒ ä¸‰ å›› äº” å…­][@train.departure_time.wday] %>
        </div>
        <div class="text-sm text-gray-600">
          <%= @train.departure_time.strftime('%m-%d') %> å‘¨<%= %w[æ—¥ ä¸€ äºŒ ä¸‰ å›› äº” å…­][@train.arrival_time.wday] %>
        </div>
      </div>

      <div class="flex items-center justify-between mb-4">
        <div>
          <div class="text-3xl font-bold text-gray-900"><%= @train.departure_time.strftime('%H:%M') %></div>
          <div class="text-sm text-gray-600"><%= @train.departure_city %></div>
        </div>
        
        <div class="flex-1 px-4 text-center">
          <div class="text-sm text-gray-500 mb-1">
            <%= (((@train.arrival_time - @train.departure_time) / 3600).to_i) %>å°æ—¶<%= (((@train.arrival_time - @train.departure_time) % 3600) / 60).to_i %>åˆ†
          </div>
          <div class="border-t-2 border-gray-300 relative">
            <div class="absolute -top-2 left-1/2 transform -translate-x-1/2 bg-white px-2 text-sm text-gray-600">
              <%= @train.train_number %> >
            </div>
          </div>
        </div>
        
        <div class="text-right">
          <div class="text-3xl font-bold text-gray-900"><%= @train.arrival_time.strftime('%H:%M') %></div>
          <div class="text-sm text-gray-600"><%= @train.arrival_city %></div>
        </div>
      </div>

      <div class="border-t pt-3 flex items-center justify-between">
        <div>
          <span class="font-medium text-gray-900"><%= @train_booking.passenger_name %></span>
        </div>
        <div class="flex items-center space-x-2">
          <span class="text-gray-900"><%= @train_booking.seat_type_label %></span>
          <span class="text-gray-900">Â¥<%= @train_booking.total_price.to_i %></span>
          <span class="text-gray-900" data-train-booking-lock-target="seatDisplay" style="display: none;">
            <%= @train_booking.carriage_number %>è½¦å¢ <%= @train_booking.seat_number %>
          </span>
          <span class="px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded" data-train-booking-lock-target="seatBadge" style="display: none;">
            é çª—
          </span>
        </div>
      </div>
    </div>

    <!-- Trust Badge -->
    <div class="text-center mb-20">
      <div class="inline-flex items-center space-x-2 text-gray-900">
        <span class="text-xl">ğŸ“</span>
        <span class="font-medium">æ—…æ¸¸ç¯å¢ƒ01 Â· ç¡¬æ ¸ä¿éšœ</span>
      </div>
      <div class="text-sm text-gray-700 mt-1">
        å‡ºç¥¨å®‰å¿ƒ Â· å‡ºè¡Œå®‰å¿ƒ Â· æœåŠ¡å®‰å¿ƒ
      </div>
    </div>
  </div>

  <!-- Bottom Payment Button (hidden initially) -->
  <div class="fixed bottom-0 left-0 right-0 bg-white border-t shadow-lg p-4" 
       data-train-booking-lock-target="paymentBar" 
       style="display: none;">
    <div class="flex items-center justify-between">
      <div class="flex items-center space-x-2">
        <div class="text-left">
          <div class="text-red-500 text-2xl font-bold">
            Â¥ <%= @train_booking.total_price.to_i %>
          </div>
          <div class="text-xs text-gray-500">è®¢å•æ€»é¢</div>
        </div>
        <button type="button" 
                onclick="window.showToast('åŠŸèƒ½å¼€å‘ä¸­')"
                class="text-gray-600 text-sm">
          æ˜ç»† âŒ„
        </button>
      </div>
      
      <button type="button"
              data-action="click->payment-confirmation#showPasswordModal"
              class="bg-gradient-to-r from-orange-400 to-orange-500 text-white px-12 py-3 rounded-full font-bold text-lg shadow-lg">
        å»æ”¯ä»˜
      </button>
    </div>
  </div>

  <!-- Cancel Button (shown during locking) -->
  <div class="fixed bottom-0 left-0 right-0 bg-white border-t shadow-lg p-4 text-center"
       data-train-booking-lock-target="cancelBar">
    <button type="button"
            onclick="if(confirm('ç¡®å®šè¦å–æ¶ˆè®¢å•å—ï¼Ÿ')) { window.location.href = '<%= cancel_train_booking_path(@train_booking) %>' }"
            class="text-gray-600 font-medium">
      å–æ¶ˆè®¢å•
    </button>
  </div>

  <!-- Shared Payment Confirmation Modals -->
  <%= render 'shared/payment_confirmation_modals' %>
</div>
