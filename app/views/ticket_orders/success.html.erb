<div class="bg-[#f5f6fa] min-h-screen pb-20">

  <!-- 顶部导航栏 -->
  <div class="bg-white sticky top-0 z-50 flex items-center justify-between px-4 py-3 border-b border-gray-100">
    <%= link_to bookings_path, class: "text-gray-800" do %>
      <svg fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6">
        <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" />
      </svg>
    <% end %>
    <h1 class="text-lg font-medium text-gray-900">支付成功</h1>
    <div class="w-6"></div>
  </div>

  <!-- 主要内容 -->
  <div class="px-4 pt-3 pb-4">

    <!-- 成功状态卡片 -->
    <div class="bg-gradient-to-br from-green-400 to-green-500 rounded-2xl px-6 py-8 text-white text-center mb-3 shadow-md">
      <div class="flex justify-center mb-3">
        <div class="w-16 h-16 bg-white rounded-full flex items-center justify-center">
          <svg class="w-10 h-10 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 13l4 4L19 7"></path>
          </svg>
        </div>
      </div>
      <h2 class="text-2xl font-bold mb-2">支付成功</h2>
      <p class="text-green-50 text-sm">订单已提交，请凭预订信息到景区换票</p>
      <p class="text-green-50 text-sm mt-1">出票完成后会发送短信到您的手机号</p>
    </div>

    <!-- 订单信息卡片 -->
    <div class="bg-white rounded-xl shadow-sm mb-3 overflow-hidden">
      <div class="px-4 py-4 border-b border-gray-100">
        <div class="flex justify-between items-center mb-1">
          <span class="text-gray-500 text-sm">订单编号</span>
          <div class="flex items-center text-primary text-sm">
            <span><%= @order.id %></span>
            <button class="ml-2 text-primary" onclick="navigator.clipboard.writeText('<%= @order.id %>')">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
              </svg>
            </button>
          </div>
        </div>
        <div class="flex justify-between items-center">
          <span class="text-gray-500 text-sm">订单状态</span>
          <span class="text-green-600 text-sm font-medium">
            <%= case @order.status
                when 'paid' then '已支付'
                when 'pending' then '待支付'
                when 'completed' then '已完成'
                when 'cancelled' then '已取消'
                else @order.status
                end %>
          </span>
        </div>
      </div>

      <div class="px-4 py-4 space-y-3">
        <div>
          <div class="text-gray-900 font-bold text-lg mb-1">
            <%= @ticket.name %>
          </div>
          <div class="text-gray-500 text-sm"><%= @attraction.name %></div>
        </div>

        <div class="space-y-2 text-sm">
          <div class="flex">
            <span class="text-gray-400 w-20">游玩日期</span>
            <span class="text-gray-900 font-medium"><%= @order.visit_date.strftime('%Y年%m月%d日') %></span>
          </div>
          <div class="flex">
            <span class="text-gray-400 w-20">购买数量</span>
            <span class="text-gray-900"><%= @order.quantity %>张</span>
          </div>
          <% if @order.insurance_type.present? && @order.insurance_type != 'none' %>
            <div class="flex">
              <span class="text-gray-400 w-20">保险</span>
              <span class="text-gray-900">
                <%= case @order.insurance_type
                    when 'basic' then '基础保障（10元/人）'
                    when 'premium' then '全面保障（30元/人）'
                    else '无保险'
                    end %>
              </span>
            </div>
          <% end %>
          <div class="flex">
            <span class="text-gray-400 w-20">出行人</span>
            <div class="text-gray-900">
              <% if @order.passengers.any? %>
                <% @order.passengers.each_with_index do |passenger, index| %>
                  <div><%= passenger.name %> | <%= passenger.id_number %></div>
                <% end %>
              <% elsif @order.passenger %>
                <span><%= @order.passenger.name %> | <%= @order.passenger.id_number %></span>
              <% elsif @passenger %>
                <span><%= @passenger.name %> | <%= @passenger.id_number %></span>
              <% else %>
                <span class="text-gray-500">未指定</span>
              <% end %>
            </div>
          </div>
          <div class="flex">
            <span class="text-gray-400 w-20">联系方式</span>
            <span class="text-gray-900"><%= @order.contact_phone %></span>
          </div>
        </div>

        <div class="pt-3 border-t border-gray-100">
          <div class="flex justify-between items-center">
            <span class="text-gray-900 font-medium">实付金额</span>
            <div class="text-accent text-xl font-bold">
              ¥<%= sprintf('%.2f', @order.total_price || @order.total_amount) %>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 二维码卡片 (出票后显示) -->
    <% if @order.status == 'completed' %>
      <div class="bg-white rounded-xl shadow-sm mb-3 p-4">
        <div class="text-center mb-3">
          <h3 class="text-lg font-bold text-gray-900 mb-1">入园二维码</h3>
          <p class="text-gray-500 text-sm">请保存此二维码，到景区门口扫码入园</p>
        </div>
        
        <div class="flex justify-center py-6 bg-gray-50 rounded-lg">
          <div class="w-48 h-48 bg-gray-200 rounded-lg flex items-center justify-center">
            <!-- 这里将来会显示真实的二维码 -->
            <svg class="w-32 h-32 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"></path>
            </svg>
          </div>
        </div>
        
        <div class="mt-3 text-center">
          <button class="text-primary text-sm font-medium">保存到相册</button>
        </div>
      </div>
    <% else %>
      <div class="bg-gradient-to-r from-blue-50 to-blue-100 rounded-xl p-4 mb-3 border border-blue-200">
        <div class="flex items-start">
          <svg class="w-5 h-5 text-blue-600 mr-2 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          <div class="flex-1">
            <h4 class="text-blue-900 font-medium text-sm mb-1">等待出票中</h4>
            <p class="text-blue-700 text-xs leading-relaxed">
              商家正在为您出票，出票完成后将发送短信通知，同时您可以在订单详情中查看入园二维码。
            </p>
          </div>
        </div>
      </div>
    <% end %>

    <!-- 温馨提示 -->
    <div class="bg-white rounded-xl shadow-sm p-4">
      <h3 class="text-gray-900 font-bold mb-3 flex items-center">
        <svg class="w-5 h-5 text-amber-500 mr-2" fill="currentColor" viewBox="0 0 24 24">
          <path fill-rule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm8.706-1.442c1.146-.573 2.437.463 2.126 1.706l-.709 2.836.042-.02a.75.75 0 01.67 1.34l-.04.022c-1.147.573-2.438-.463-2.127-1.706l.71-2.836-.042.02a.75.75 0 11-.671-1.34l.041-.022zM12 9a.75.75 0 100-1.5.75.75 0 000 1.5z" clip-rule="evenodd"></path>
        </svg>
        温馨提示
      </h3>
      <ul class="space-y-2 text-sm text-gray-600">
        <li class="flex items-start">
          <span class="text-primary mr-2">•</span>
          <span>出票后请及时查看入园二维码，到达景区后出示二维码即可入园</span>
        </li>
        <li class="flex items-start">
          <span class="text-primary mr-2">•</span>
          <span>请在预订的游玩日期当天使用，逾期不可使用</span>
        </li>
        <li class="flex items-start">
          <span class="text-primary mr-2">•</span>
          <span>建议提前30分钟到达景区，避免高峰期排队</span>
        </li>
        <li class="flex items-start">
          <span class="text-primary mr-2">•</span>
          <span>如有任何问题，请及时联系商家客服</span>
        </li>
      </ul>
    </div>
  </div>

  <!-- 底部按钮 -->
  <div class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-100 px-4 py-3 flex space-x-3">
    <%= link_to "查看订单详情", ticket_order_path(@order), class: "flex-1 py-3 bg-gray-100 text-gray-900 rounded-full font-medium text-center" %>
    <%= link_to "返回首页", tickets_path, class: "flex-1 py-3 bg-primary text-white rounded-full font-medium text-center" %>
  </div>

</div>
