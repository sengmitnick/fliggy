<div class="w-full max-w-[430px] mx-auto bg-surface min-h-screen relative shadow-2xl flex flex-col">
  
  <!-- App 头部导航 -->
  <div class="bg-white px-4 py-3 flex items-center justify-between sticky top-0 z-20">
    <%= link_to abroad_tickets_path, class: "p-1" do %>
      <svg class="w-6 h-6 text-gray-800" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
      </svg>
    <% end %>
    <div class="flex items-center gap-2 font-bold text-lg text-gray-900">
      <span><%= @origin %></span>
      <svg class="w-4 h-4 text-gray-400" viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/>
      </svg>
      <span><%= @destination %></span>
      <svg class="w-3 h-3 text-gray-800 fill-current" viewBox="0 0 20 20">
        <path d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"/>
      </svg>
    </div>
    <button class="p-1">
      <svg class="w-6 h-6 text-gray-800" fill="currentColor" viewBox="0 0 24 24">
        <circle cx="5" cy="12" r="2" />
        <circle cx="12" cy="12" r="2" />
        <circle cx="19" cy="12" r="2" />
      </svg>
    </button>
  </div>

  <!-- 日期选择栏 -->
  <div class="bg-white pb-2 flex border-b border-gray-100" data-controller="abroad-date-picker">
    <div class="flex-1 flex overflow-x-auto hide-scrollbar pl-2 pr-2 items-center">
      <% @date_range.each do |date| %>
        <% is_selected = date == @date %>
        <%= link_to search_abroad_tickets_path(region: @region, origin: @origin, destination: @destination, date: date.strftime('%Y-%m-%d')), 
                    class: "flex-shrink-0 flex flex-col items-center justify-center w-[4.5rem] py-2 #{is_selected ? 'bg-[#FFD900] rounded-lg mx-1 shadow-sm' : ''}" do %>
          <span class="text-xs <%= is_selected ? 'text-gray-900 font-semibold' : 'text-gray-400' %>">
            <%= date.strftime('%m-%d') %>
          </span>
          <span class="text-sm font-medium <%= is_selected ? 'text-gray-900 font-bold' : 'text-gray-400' %>">
            <%= ['周日', '周一', '周二', '周三', '周四', '周五', '周六'][date.wday] %>
          </span>
        <% end %>
      <% end %>
    </div>
    <!-- 日历按钮 -->
    <div class="w-12 flex items-center justify-center border-l border-gray-100 shadow-[-5px_0_10px_-5px_rgba(0,0,0,0.05)] z-10 bg-white cursor-pointer"
         data-action="click->abroad-date-picker#openCalendar">
      <svg class="w-6 h-6 text-gray-800" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
        <circle cx="12" cy="15" r="1" fill="currentColor"/>
      </svg>
    </div>
  </div>

  <!-- 内容区域 -->
  <div class="flex-1 overflow-y-auto pb-20">
    
    <!-- 提示语 -->
    <div class="flex justify-between items-end px-4 py-3">
      <h2 class="text-lg font-bold text-gray-900">选择当地<span class="text-primary">意向出发时间段</span></h2>
      <span class="text-[10px] text-gray-400">实际时间以票面为准</span>
    </div>

    <!-- 卡片列表容器 -->
    <div class="px-3 space-y-3">
      <% if @tickets.any? %>
        <% @tickets.each do |ticket| %>
          <%= link_to abroad_ticket_path(ticket, origin: @origin, destination: @destination, date: @date.strftime('%Y-%m-%d')), class: "block" do %>
            <div class="bg-white rounded-xl p-4 relative shadow-sm hover:shadow-md transition">
              <!-- 电子票标签 -->
              <div class="absolute top-4 right-4 border border-gray-300 rounded text-[10px] px-1 text-gray-500">
                电子票
              </div>
              
              <div class="text-sm text-gray-900 mb-1">出发时间段(当地时间)</div>
              
              <div class="flex justify-between items-baseline mt-1">
                <!-- 左侧时间 -->
                <div class="flex items-baseline">
                  <span class="text-[28px] font-bold text-gray-900 font-sans tracking-tight"><%= ticket.time_slot_start %></span>
                  <span class="mx-2 text-sm font-medium text-gray-900">至</span>
                  <span class="text-[28px] font-bold text-gray-900 font-sans tracking-tight"><%= ticket.time_slot_end %></span>
                  <span class="ml-2 text-sm text-gray-900">之间出发</span>
                </div>
                <!-- 右侧价格 -->
                <div class="text-accent font-bold">
                  <span class="text-sm">¥</span>
                  <span class="text-xl"><%= ticket.price.to_i %></span>
                  <span class="text-sm">.<%= sprintf('%02d', (ticket.price % 1 * 100).to_i) %>起</span>
                </div>
              </div>

              <!-- 车站信息 -->
              <div class="flex justify-between items-start mt-1 pr-24">
                <div class="flex flex-col">
                  <span class="text-sm text-gray-800"><%= ticket.origin %></span>
                  <span class="text-[10px] text-gray-400"><%= ticket.origin_en %></span>
                </div>
                
                <!-- 装饰线 -->
                <div class="flex-1 mx-4 h-[1px] bg-gray-200 mt-2.5 relative"></div>

                <div class="flex flex-col text-right">
                  <span class="text-sm text-gray-800"><%= ticket.destination %></span>
                  <span class="text-[10px] text-gray-400"><%= ticket.destination_en %></span>
                </div>
              </div>
            </div>
          <% end %>
        <% end %>
      <% else %>
        <div class="bg-white rounded-xl p-8 text-center">
          <div class="text-gray-400 mb-2">
            <svg class="w-16 h-16 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
            </svg>
          </div>
          <p class="text-gray-500">暂无可用班次</p>
          <p class="text-sm text-gray-400 mt-1">请尝试其他日期或路线</p>
        </div>
      <% end %>
    </div>
  </div>
</div>

<style>
  .hide-scrollbar::-webkit-scrollbar {
    display: none;
  }
  .hide-scrollbar {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
</style>
