<div class="max-w-md mx-auto bg-surface min-h-screen relative shadow-2xl overflow-hidden pb-6">
  
  <!-- 顶部黄色背景区域 -->
  <div class="bg-[#FEEF88] px-4 pt-3 pb-12">
    <!-- 顶部导航栏 -->
    <div class="flex justify-between items-center mb-4">
      <%= link_to (params[:ref] == 'outbound_tours' ? outbound_tours_path : root_path), class: "p-1 -ml-2" do %>
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
          <path d="M15 18l-6-6 6-6"/>
        </svg>
      <% end %>
      <h1 class="text-[17px] font-bold tracking-wide">境外当地交通</h1>
      <button class="p-1 -mr-2">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
          <circle cx="5" cy="12" r="2"/>
          <circle cx="12" cy="12" r="2"/>
          <circle cx="19" cy="12" r="2"/>
        </svg>
      </button>
    </div>
  </div>

  <!-- 核心搜索卡片区域 (上移覆盖黄色背景) -->
  <div class="mx-3 -mt-[54px] relative z-10" data-controller="abroad-ticket-search abroad-date-picker" data-abroad-ticket-search-current-date-value="<%= @date.to_s %>" data-abroad-date-picker-current-date-value="<%= @date.to_s %>">
    <!-- 卡片式 Tab -->
    <div class="flex">
      <!-- 日本 Tab -->
      <div class="flex-1 <%= @region == 'japan' ? 'bg-white' : 'bg-surface-alt' %> rounded-tl-2xl rounded-tr-lg py-3 flex flex-col items-center justify-center relative cursor-pointer"
           data-action="click->abroad-ticket-search#selectRegion"
           data-abroad-ticket-search-region-param="japan">
        <span class="text-lg font-bold <%= @region == 'japan' ? 'text-gray-900' : 'text-gray-500' %>">日本</span>
        <% if @region == 'japan' %>
          <div class="w-8 h-1 bg-gray-900 rounded-full mt-1 absolute bottom-2"></div>
        <% end %>
      </div>
      <!-- 欧洲 Tab -->
      <div class="flex-1 <%= @region == 'europe' ? 'bg-white' : 'bg-surface-alt' %> rounded-tr-2xl rounded-tl-lg py-3 flex flex-col items-center justify-start cursor-pointer"
           data-action="click->abroad-ticket-search#selectRegion"
           data-abroad-ticket-search-region-param="europe">
        <span class="text-lg font-medium <%= @region == 'europe' ? 'text-gray-900' : 'text-gray-500' %> mt-0.5">欧洲</span>
        <% if @region == 'europe' %>
          <div class="w-8 h-1 bg-gray-900 rounded-full mt-1 absolute bottom-2"></div>
        <% end %>
      </div>
    </div>

    <!-- 白色内容主体 -->
    <div class="bg-white rounded-b-2xl rounded-tr-none p-4 pb-6">
      
      <%= form_with url: search_abroad_tickets_path, method: :get, class: "space-y-6", data: { abroad_ticket_search_target: "form" } do |f| %>
        <%= f.hidden_field :region, value: @region, data: { abroad_ticket_search_target: "regionInput" } %>
        
        <!-- 内部切换器 (火车票) -->
        

        <!-- 车站选择 -->
        <div class="flex justify-between items-center mb-8 px-1">
          <!-- 出发站 -->
          <div class="flex flex-col items-start w-1/3 cursor-pointer" 
               data-action="click->abroad-ticket-search#selectOrigin">
            <span class="text-[22px] font-bold text-gray-900 leading-tight" data-abroad-ticket-search-target="originText">
              <%= @origin || (@region == 'japan' ? '东京站' : '巴黎北站') %>
            </span>
            <span class="text-xs text-gray-400 mt-1 font-light">
              <%= @region == 'japan' ? 'Tokyo Station' : 'Paris Nord' %>
            </span>
          </div>

          <!-- 交换图标 -->
          <div class="flex justify-center w-1/3">
            <div class="relative cursor-pointer" data-action="click->abroad-ticket-search#swapStations">
              <!-- 浅绿背景 -->
              <svg width="36" height="36" viewBox="0 0 36 36" fill="none">
                <circle cx="18" cy="18" r="18" fill="#E8F5E9" opacity="0.6"/>
              </svg>
              <!-- 绿色箭头 -->
              <svg class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#22C55E" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M4 16v-2.38C4 11.5 9.16 8 13.62 8a7 7 0 0 1 2.38.45L13 6"/> 
                <path d="M15 6l4 4-4 4"/>
                <path d="M20 8v2.38C20 12.5 14.84 16 10.38 16a7 7 0 0 1-2.38-.45L11 18"/>
                <path d="M9 18l-4-4 4-4"/>
              </svg>
            </div>
          </div>

          <!-- 到达站 -->
          <div class="flex flex-col items-end w-1/3 cursor-pointer"
               data-action="click->abroad-ticket-search#selectDestination">
            <span class="text-[22px] font-bold text-gray-900 leading-tight" data-abroad-ticket-search-target="destinationText">
              <%= @destination || (@region == 'japan' ? '新大阪站' : '阿姆斯特丹中央车站') %>
            </span>
            <span class="text-xs text-gray-400 mt-1 font-light text-right">
              <%= @region == 'japan' ? 'Shin-Osaka Station' : 'Amsterdam Centraal' %>
            </span>
          </div>
        </div>

        <%= f.hidden_field :origin, value: @origin || (@region == 'japan' ? '东京站' : '巴黎北站'), data: { abroad_ticket_search_target: "originInput" } %>
        <%= f.hidden_field :destination, value: @destination || (@region == 'japan' ? '新大阪站' : '阿姆斯特丹中央车站'), data: { abroad_ticket_search_target: "destinationInput" } %>

        <!-- 日期选择 -->
        <div class="flex justify-between items-center py-4 border-b border-gray-100 mb-6 cursor-pointer"
             data-action="click->abroad-ticket-search#openDatePicker">
          <div class="flex items-baseline gap-2">
            <span class="text-2xl font-bold text-gray-900" data-abroad-ticket-search-target="dateText">
              <%= @date.strftime('%-m月%-d日') %>
            </span>
            <span class="text-sm text-gray-500 font-medium">
              <%= ['周日', '周一', '周二', '周三', '周四', '周五', '周六'][@date.wday] %>
            </span>
          </div>
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#D1D5DB" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M9 18l6-6-6-6"/>
          </svg>
        </div>

        <%= f.hidden_field :date, value: @date.strftime('%Y-%m-%d'), data: { abroad_ticket_search_target: "dateInput" } %>

        <!-- 搜索按钮 -->
        <%= f.submit "搜索", class: "w-full bg-[#FFDD33] text-gray-900 font-bold text-lg py-3.5 rounded-full shadow-[0_2px_10px_rgba(255,221,51,0.3)] hover:bg-[#ffc107] transition-colors tracking-wide cursor-pointer" %>
      <% end %>
    </div>
    
    <!-- Station Selection Modal -->
    <div class="fixed inset-0 bg-black/50 z-50 hidden" data-abroad-ticket-search-target="stationModal">
      <div class="absolute inset-0" data-action="click->abroad-ticket-search#closeStationModal"></div>
      <div class="absolute bottom-0 left-0 right-0 bg-white rounded-t-3xl max-h-[80vh] flex flex-col animate-slide-up">
        <!-- Modal Header -->
        <div class="flex items-center justify-between px-4 py-4 border-b border-gray-100 flex-shrink-0">
          <h2 class="text-lg font-bold text-gray-900">出发地选择</h2>
          <button type="button" 
                  class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100"
                  data-action="click->abroad-ticket-search#closeStationModal">
            <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>

        <!-- Search Input -->
        <div class="px-4 py-3 border-b border-gray-100 flex-shrink-0">
          <div class="relative">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
              </svg>
            </div>
            <input type="text" 
                   placeholder="城市中文/英语/拼音"
                   class="w-full pl-10 pr-4 py-2.5 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:outline-none focus:border-yellow-400"
                   data-abroad-ticket-search-target="searchInput"
                   data-action="input->abroad-ticket-search#searchStations">
          </div>
        </div>

        <!-- Station List -->
        <div class="flex-1 overflow-y-auto" data-abroad-ticket-search-target="stationList">
          <!-- Content will be dynamically rendered by controller -->
        </div>
      </div>
    </div>
    
    <!-- Date Picker Modal -->
    <%= render 'date_picker_modal' %>
  </div>

  <!-- 热门区域车票 -->
  <div class="px-4 mt-6">
    <h2 class="text-[17px] font-bold text-gray-800 mb-4">热门区域车票</h2>
    
    <div class="grid grid-cols-2 gap-3">
      <% @popular_routes.each_with_index do |route, index| %>
        <div class="relative rounded-xl overflow-hidden h-[100px] bg-gradient-to-br <%= ['from-blue-400 to-blue-300', 'from-indigo-400 to-indigo-300', 'from-gray-400 to-gray-300', 'from-orange-400 to-orange-300'][index % 4] %> cursor-pointer hover:opacity-90 transition">
          <div class="absolute bottom-2 left-3 right-2 text-white">
            <div class="font-bold text-[15px] mb-0.5"><%= route[:name] %></div>
            <div class="text-[10px] opacity-90 truncate"><%= route[:cities] %></div>
          </div>
        </div>
      <% end %>
    </div>
  </div>

  <!-- 热门商品 -->
  
</div>

<style>
  .no-scrollbar::-webkit-scrollbar {
    display: none;
  }
  .no-scrollbar {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
</style>
