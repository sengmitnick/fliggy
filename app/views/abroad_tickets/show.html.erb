<div class="bg-surface text-gray-900 font-sans min-h-screen relative max-w-md mx-auto overflow-y-auto no-scrollbar">

  <!-- 顶部导航 -->
  <div class="flex justify-between items-center px-4 py-3 bg-surface sticky top-0 z-50">
    <%= link_to :back, class: "p-1" do %>
      <svg class="w-6 h-6 text-gray-800" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
      </svg>
    <% end %>
    <h1 class="text-lg font-semibold">
      <%= @ticket.departure_date.strftime('%Y年%m月%d日') %>
      <%= ['周日', '周一', '周二', '周三', '周四', '周五', '周六'][@ticket.departure_date.wday] %>
    </h1>
    <button class="p-1">
      <svg class="w-6 h-6 text-gray-800" fill="currentColor" viewBox="0 0 24 24">
        <path d="M6 12a2 2 0 11-4 0 2 2 0 014 0zm8 0a2 2 0 11-4 0 2 2 0 014 0zm8 0a2 2 0 11-4 0 2 2 0 014 0z"/>
      </svg>
    </button>
  </div>

  <!-- 主要行程卡片 -->
  <div class="mx-3 mt-1 bg-white rounded-2xl p-5 shadow-sm">
    <!-- 车站与图标 -->
    <div class="flex justify-between items-start relative mb-6">
      <div class="text-left">
        <div class="text-2xl font-bold text-gray-900 leading-none"><%= @ticket.origin %></div>
        <div class="text-gray-400 text-xs mt-1"><%= @ticket.origin_en %></div>
      </div>
      
      <!-- 中间图标 -->
      <div class="absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-full">
        <div class="w-12 h-6 flex items-center justify-center">
          <svg class="w-8 h-8 text-green-500 opacity-80" viewBox="0 0 24 24" fill="none">
            <path d="M4 16L6.5 6H17.5L20 16" stroke="#10B981" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M2 20H22" stroke="#10B981" stroke-width="2" stroke-linecap="round"/>
            <circle cx="15" cy="16" r="1.5" fill="#10B981"/>
            <path d="M12 9V6M8 12H16" stroke="#10B981" stroke-width="1.5"/>
          </svg>
        </div>
      </div>

      <div class="text-right">
        <div class="text-2xl font-bold text-gray-900 leading-none"><%= @ticket.destination %></div>
        <div class="text-gray-400 text-xs mt-1"><%= @ticket.destination_en %></div>
      </div>
    </div>

    <!-- 时间与日期 -->
    <div class="flex justify-between items-center mb-5">
      <div class="flex items-center space-x-2">
        <div>
          <span class="text-2xl font-bold"><%= @ticket.departure_date.strftime('%-m月%-d日') %></span>
          <span class="text-sm text-gray-500 ml-1">
            <%= ['周日', '周一', '周二', '周三', '周四', '周五', '周六'][@ticket.departure_date.wday] %>
          </span>
          <div class="text-xs text-gray-400 mt-0.5">计划出发日期</div>
        </div>
        <svg class="w-4 h-4 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
        </svg>
      </div>
      
      <div class="flex items-center space-x-2">
        <div class="text-right">
          <span class="text-2xl font-bold"><%= @ticket.time_slot_start %> - <%= @ticket.time_slot_end %></span>
          <div class="text-xs text-gray-400 mt-0.5 text-right">计划出发时间</div>
        </div>
        <svg class="w-4 h-4 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
        </svg>
      </div>
    </div>

    <!-- 提示框 -->
    <div class="bg-[#FFF5ED] rounded-lg p-3 mb-4">
      <p class="text-accent text-xs leading-5">
        所选时间为当地时间，商家将优先按计划出发时间出票，具体发车时间以出票后票面为准。
      </p>
    </div>

    <!-- 商家信息 -->
    <div class="flex justify-between items-center pt-2">
      <div class="flex items-center space-x-2">
        <svg class="w-4 h-4 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
        </svg>
        <span class="text-sm font-semibold text-gray-900">
          <%= @ticket.region == 'japan' ? '惠卓旅游专营店' : '欧铁官方旗舰店' %>
        </span>
      </div>
      <div class="flex items-center text-gray-400 text-xs">
        <span>咨询商家</span>
        <svg class="w-3 h-3 ml-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
        </svg>
      </div>
    </div>
  </div>

  <!-- 车票类型标题 -->
  <div class="flex justify-between items-end px-4 mt-6 mb-3">
    <h2 class="text-lg font-bold text-gray-900">车票类型</h2>
    <div class="flex items-center text-gray-800 text-xs">
      <span>车票&行李说明</span>
      <svg class="w-3 h-3 ml-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
      </svg>
    </div>
  </div>

  <!-- 乘客人数 Tab -->
  <div class="flex space-x-2 px-3 overflow-x-auto no-scrollbar pb-1" data-controller="abroad-passenger-selector">
    <% passenger_types = ['1adult', '2adult', '2adult1child', '2adult2child'] %>
    <% passenger_types.each do |type| %>
      <div class="relative flex-shrink-0 <%= type == '1adult' ? 'bg-[#FFFBF0] border border-[#FFE5B5]' : 'bg-gray-100' %> text-gray-900 px-5 py-2.5 rounded-lg text-sm font-medium cursor-pointer"
           data-action="click->abroad-passenger-selector#select"
           data-abroad-passenger-selector-target="type"
           data-abroad-passenger-selector-type-param="<%= type %>">
        <%= type.gsub('adult', '成人').gsub('child', '儿童') %>
        <% if type == '1adult' %>
          <div class="absolute bottom-0 right-0 w-3 h-3 bg-[#FFCC00] rounded-tl-lg rounded-br-lg flex items-center justify-center">
            <svg class="w-2 h-2 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="4" d="M5 13l4 4L19 7"></path>
            </svg>
          </div>
        <% end %>
      </div>
    <% end %>
    <div class="flex-shrink-0 bg-gray-100 text-gray-800 px-4 py-2.5 rounded-lg text-sm font-medium flex items-center">
      自定义
      <svg class="w-3 h-3 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
      </svg>
    </div>
  </div>

  <!-- 说明文本 -->
  <div class="px-3 mt-2 mb-1 flex items-center text-xs text-gray-500">
    <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
    </svg>
    指定席-有固定的座位；自由席-没固定座位，可坐车厢任意空座位
    <svg class="w-3 h-3 ml-1 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
    </svg>
  </div>

  <!-- 列表：自由席 -->
  <div class="bg-white mx-3 mt-2 rounded-xl p-4 shadow-sm">
    <div class="flex justify-between items-start">
      <div>
        <h3 class="font-bold text-gray-900 text-base">自由席 | 普通车厢(二等座)</h3>
        <div class="flex items-center space-x-2 mt-1.5 text-xs text-gray-500">
          <span>纸质票(需兑换票)</span>
          <span class="w-px h-2.5 bg-gray-300"></span>
          <span>自由席 | 普通车厢(二等座)</span>
          <span class="w-px h-2.5 bg-gray-300"></span>
          <span>条件退</span>
        </div>
        <div class="text-xs text-gray-500 mt-1">不可在线改签</div>
        <div class="flex items-center text-gray-500 text-xs mt-2">
          <span>退改和使用说明</span>
          <svg class="w-3 h-3 ml-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
          </svg>
        </div>
      </div>
    </div>

    <div class="flex justify-end items-end mt-2">
      <div class="mr-3 mb-1">
        <span class="text-xs text-accent">1人共</span>
        <span class="text-lg font-bold text-accent ml-0.5">¥</span>
        <span class="text-2xl font-bold text-accent"><%= @ticket.price.to_i %></span>
        <span class="text-xs text-accent">.<%= sprintf('%02d', (@ticket.price % 1 * 100).to_i) %></span>
      </div>
      <%= link_to new_abroad_ticket_order_path(abroad_ticket_id: @ticket.id, seat_category: '自由席', passenger_type: '1adult'), 
                  class: "bg-orange-600 text-white rounded-lg px-6 py-2.5 font-bold text-lg shadow-sm active:bg-orange-700" do %>
        订
      <% end %>
    </div>
  </div>

  <!-- 列表：指定席 -->
  <div class="bg-white mx-3 mt-3 mb-10 rounded-xl p-4 shadow-sm">
    <div class="flex justify-between items-start">
      <div>
        <h3 class="font-bold text-gray-900 text-base">指定席 | 普通车厢(二等座)</h3>
        <div class="flex items-center space-x-2 mt-1.5 text-xs text-gray-500">
          <span>纸质票(需兑换票)</span>
          <span class="w-px h-2.5 bg-gray-300"></span>
          <span>指定席 | 普通车厢(二等座)</span>
          <span class="w-px h-2.5 bg-gray-300"></span>
          <span>条件退</span>
        </div>
        <div class="text-xs text-gray-500 mt-1">不可在线改签</div>
        <div class="flex items-center text-gray-500 text-xs mt-2">
          <span>退改和使用说明</span>
          <svg class="w-3 h-3 ml-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
          </svg>
        </div>
      </div>
    </div>

    <div class="flex justify-end items-end mt-2">
      <div class="mr-3 mb-1">
        <span class="text-xs text-accent">1人共</span>
        <span class="text-lg font-bold text-accent ml-0.5">¥</span>
        <span class="text-2xl font-bold text-accent"><%= (@ticket.price * 1.06).to_i %></span>
        <span class="text-xs text-accent">.<%= sprintf('%02d', ((@ticket.price * 1.06) % 1 * 100).to_i) %></span>
      </div>
      <%= link_to new_abroad_ticket_order_path(abroad_ticket_id: @ticket.id, seat_category: '指定席', passenger_type: '1adult'), 
                  class: "bg-orange-600 text-white rounded-lg px-6 py-2.5 font-bold text-lg shadow-sm active:bg-orange-700" do %>
        订
      <% end %>
    </div>
  </div>

</div>

<style>
  .no-scrollbar::-webkit-scrollbar {
    display: none;
  }
  .no-scrollbar {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
</style>
