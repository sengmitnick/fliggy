<div class="w-full max-w-[430px] mx-auto bg-[#F5F6F8] min-h-screen pb-20">
  <!-- é¡¶éƒ¨çŠ¶æ€æ å’Œå¯¼èˆªåŒºåŸŸ -->
  <div class="bg-brand pt-2 pb-4 sticky top-0 z-50" style="background-color: #FFE855;">
    <!-- æ¨¡æ‹ŸçŠ¶æ€æ  -->
    

    <!-- å¯¼èˆªæ  -->
    <div class="flex justify-between items-center mb-6">
      <%= link_to root_path, class: "text-black" do %>
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
      <% end %>
      
      <div class="flex items-center gap-2">
        <span class="text-2xl font-black italic tracking-tighter text-slate-900">æ·±åº¦æ—…è¡Œ<span class="text-3xl relative -top-1">+</span></span>
        <span class="bg-slate-900 text-[#FFE855] text-xs font-bold px-1.5 py-0.5 rounded transform -skew-x-12">å‘å¯¼</span>
      </div>

      <button class="text-black">
        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path d="M6 10a2 2 0 11-4 0 2 2 0 014 0zM12 10a2 2 0 11-4 0 2 2 0 014 0zM16 12a2 2 0 100-4 2 2 0 000 4z"/></svg>
      </button>
    </div>

    <div class="text-center text-sm font-medium mb-6">ä¸€èµ·æˆä¸ºæ·±åº¦æ—…è¡Œå®¶</div>

  <!-- Guide Categories (Horizontal scroll) -->
  <div class="pb-2" data-controller="deep-travel">
    <div class="flex gap-4 overflow-x-auto pb-2 scrollbar-hide">
      <!-- Guide - Instructor -->
      <div class="flex-shrink-0 text-center">
        <%= image_tag "deep_travel/è®²è§£.png", class: "w-[84px] h-auto object-cover rounded-full" %>
      </div>

      <!-- Guide - Ski Teaching (æ•¬è¯·æœŸå¾…) -->
      <div class="flex-shrink-0 text-center relative">
        <%= image_tag "deep_travel/æ»‘é›ªæ•™å­¦.png", class: "w-20 h-auto object-cover rounded-full opacity-70" %>
      </div>

      <!-- Guide - Diving Teaching (æ•¬è¯·æœŸå¾…) -->
      <div class="flex-shrink-0 text-center relative">
        <%= image_tag "deep_travel/æ½œæ°´æ•™å­¦.png", class: "w-20 h-auto object-cover rounded-full opacity-70" %>
      </div>

      <!-- Guide - Local Driver (æ•¬è¯·æœŸå¾…) -->
      <div class="flex-shrink-0 text-center relative">
          <%= image_tag "deep_travel/å½“åœ°å¸å¯¼.png", class: "w-20 h-auto object-cover rounded-full opacity-70" %>
      </div>

      <!-- Guide - Photographer (æ•¬è¯·æœŸå¾…) -->
      <div class="flex-shrink-0 text-center relative">
          <%= image_tag "deep_travel/è·Ÿæ‹äººåƒ.png", class: "w-20 h-auto object-cover rounded-full opacity-70" %>
      </div>
    </div>
  </div>

   <!-- Location Tabs -->
  <div class="bg-white border-t border-b border-gray-200 my-2">
    <div class="flex overflow-x-auto scrollbar-hide">
      <% ['å¢ƒå†…ç²¾é€‰', 'å¢ƒå¤–ç²¾é€‰', 'åŒ—äº¬', 'åä¸œ', 'åä¸­', 'é™•è¥¿'].each do |loc| %>
        <%= link_to deep_travels_path(location: loc), 
            class: "flex-shrink-0 px-6 py-3 text-sm font-medium whitespace-nowrap #{@location == loc ? 'text-gray-900 border-b-2 border-yellow-400 bg-yellow-50' : 'text-gray-600'}" do %>
          <%= loc %>
        <% end %>
      <% end %>
    </div>
  </div>

  <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
  <div class="px-3">
    <% if @products.any? %>
      <% @products.group_by(&:deep_travel_guide).each do |guide, products| %>
        <% next unless guide %>
        
        <!-- æ™¯ç‚¹å¡ç‰‡ -->
        <div class="bg-white rounded-xl mb-3 p-4 shadow-sm">
          <!-- æ ‡é¢˜è¡Œ -->
          <div class="flex items-center gap-1 mb-1">
            <h3 class="font-bold text-lg text-slate-900"><%= products.first.subtitle&.split(' ')&.first || products.first.title.split(/[ã€\[]/)[0].truncate(15) %></h3>
            <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
          </div>
          
          <!-- æ¦œå•æ ‡ç­¾ -->
          <% if guide.rank.present? %>
            <div class="flex items-center gap-1 text-xs text-amber-700 mb-1">
              <span class="bg-amber-100 rounded-full p-0.5">
                <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>
              </span>
              <span class="font-medium"><%= guide.title %> Â· ç¬¬<%= guide.rank %>å</span>
            </div>
          <% end %>
          
          <p class="text-xs text-gray-400 mb-4">" <%= guide.description&.truncate(30) || guide.specialties %> "</p>

          <!-- è®²å¸ˆä¸»è¦å†…å®¹ -->
          <div class="flex gap-3 mb-4">
            <!-- å·¦ä¾§ä¿¡æ¯ -->
            <div class="flex-1">
              <span class="text-[10px] text-amber-700 bg-amber-50 px-1 py-0.5 rounded mb-1 inline-block">ç²¾é€‰è®²å¸ˆ</span>
              <h4 class="font-bold text-lg text-slate-800"><%= guide.name %></h4>
              <p class="text-xs text-gray-400 mb-2">
                <%= "ç²‰ä¸#{guide.follower_count}ä¸‡+" if guide.follower_count > 0 %>
                <%= " Â· ä»ä¸š#{guide.experience_years}å¹´+" if guide.experience_years > 0 %>
              </p>
              <p class="text-xs text-slate-600 line-clamp-2 leading-tight mb-2">" <%= guide.description&.truncate(50) %></p>
              
              <div class="flex items-end justify-between mt-2">
                <div class="font-bold text-lg leading-none" style="color: #FF4D3F;">
                  <span class="text-xs">Â¥</span><%= guide.price.to_i %><span class="text-xs font-normal text-gray-400 ml-0.5">èµ·</span>
                </div>
                <button class="text-slate-900 text-xs font-bold px-3 py-1.5 rounded-full" style="background-color: #FFE855;">å»é¢„çº¦</button>
              </div>
              <p class="text-[10px] text-gray-400 mt-1">å·²æœåŠ¡<%= guide.served_count %>+äºº</p>
            </div>
            
            <!-- å³ä¾§å›¾ç‰‡ -->
            <div class="w-[110px] h-[140px] bg-slate-200 rounded-lg overflow-hidden relative flex-shrink-0">
              <% if guide.avatar.attached? %>
                <%= image_tag guide.avatar, class: "w-full h-full object-cover" %>
              <% else %>
                <div class="w-full h-full bg-gradient-to-br from-gray-600 to-gray-800 flex items-center justify-center text-white text-2xl font-bold">
                  <%= guide.name[0] %>
                </div>
              <% end %>
              
              <% if guide.video.attached? %>
                <div class="absolute bottom-2 left-2 right-2 text-white text-[8px] leading-tight">
                  <%= guide.description&.truncate(30) || "æ·±åº¦è®²è§£ä¸“ä¸šæœåŠ¡" %>
                </div>
              <% end %>
            </div>
          </div>

          <!-- å…¶ä»–è®²å¸ˆå¤´åƒ -->
          <div class="flex items-center justify-between bg-yellow-50/50 p-2 rounded-lg mb-3">
            <div class="flex -space-x-2">
              <% @guides.first(5).each_with_index do |other_guide, index| %>
                <div class="w-8 h-8 rounded-lg <%= index == 0 ? 'bg-red-800 border-2 border-brand' : 'bg-gray-' + (300 + index * 100).to_s + ' border-2' %> border-white overflow-hidden relative">
                  <% if other_guide.avatar.attached? %>
                    <%= image_tag other_guide.avatar, class: "w-full h-full object-cover" %>
                  <% elsif index == 0 %>
                    <div class="absolute inset-0 flex items-center justify-center text-white text-[8px]">è®²å¸ˆ</div>
                  <% end %>
                </div>
              <% end %>
            </div>
            <div class="flex items-center text-xs text-gray-500">
              æ›´å¤š <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
            </div>
          </div>

          <!-- çƒ­é”€å•†å“åˆ—è¡¨ -->
          <div class="border-t border-gray-100 pt-3">
            <div class="flex justify-between items-center mb-2">
              <span class="text-xs font-bold text-gray-700">çƒ­é”€è®²è§£å•†å“</span>
              <span class="text-xs text-gray-500 flex items-center">æ›´å¤š <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg></span>
            </div>
            
            <div class="space-y-3">
              <% products.first(2).each do |product| %>
                <div class="flex justify-between items-start">
                  <div class="w-3/4">
                    <p class="text-xs text-slate-800 line-clamp-1 mb-1"><%= product.title %></p>
                    <span class="text-[10px] text-gray-400">å·²å”®<%= product.sales_count %>+</span>
                  </div>
                  <div class="text-xs font-bold" style="color: #FF4D3F;">Â¥<%= product.price.to_i %><span class="font-normal text-[10px]">èµ·</span></div>
                </div>
              <% end %>
            </div>
          </div>
        </div>
      <% end %>
    <% else %>
      <!-- ç©ºçŠ¶æ€ -->
      <div class="text-center py-16">
        <div class="text-6xl mb-4">ğŸ—ºï¸</div>
        <p class="text-gray-500 text-sm">è¯¥åœ°åŒºæš‚æ— æ·±åº¦æ—…è¡Œäº§å“</p>
        <p class="text-gray-400 text-xs mt-2">æ•¬è¯·æœŸå¾…æ›´å¤šç²¾å½©å†…å®¹</p>
      </div>
    <% end %>
  </div>
</div>

<style>
  /* éšè—æ»šåŠ¨æ¡ä½†ä¿ç•™åŠŸèƒ½ */
  .no-scrollbar::-webkit-scrollbar {
    display: none;
  }
  .no-scrollbar {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
  
  .line-clamp-1 {
    display: -webkit-box;
    -webkit-line-clamp: 1;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  
  /* è‡ªå®šä¹‰é¢œè‰²å˜é‡ */
  :root {
    --brand-yellow: #FFE855;
    --bg-gray: #F5F6F8;
    --price-red: #FF4D3F;
    --text-main: #1A1A1A;
    --text-sub: #999999;
  }
</style>
