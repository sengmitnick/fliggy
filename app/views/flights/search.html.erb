<% if @trip_type == 'round_trip' && @return_flights.present? %>
  <!-- Round-trip Split Screen Layout -->
  <div class="min-h-screen bg-white" data-controller="round-trip-selector">
    <!-- Header -->
    <div class="sticky top-0 z-50 bg-white border-b border-gray-200">
      <!-- Top Bar -->
      <div class="flex items-center justify-between px-4 py-3">
        <%= link_to flights_path, class: "flex items-center gap-2" do %>
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
          </svg>
        <% end %>

        <div class="flex-1 text-center">
          <div class="text-lg font-bold">
            <%= @departure_city %> ⇄ <%= @destination_city %>
          </div>
          <div class="text-xs text-gray-500 mt-1">
            <%= I18n.l(@date, format: "%m月%d日") %> - <%= I18n.l(@return_date, format: "%m月%d日") %>
          </div>
        </div>

        <div class="flex items-center gap-3">
          <button class="text-sm text-primary" onclick="window.showToast('精彩即将上线，敬请期待')">低价提醒</button>
          <button onclick="window.showToast('精彩即将上线，敬请期待')">
            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
              <path d="M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"/>
            </svg>
          </button>
        </div>
      </div>
    </div>

    <!-- Split Screen Flight Lists -->
    <div class="flex" style="height: calc(100vh - 140px);">
      <!-- Outbound Flights (Left) -->
      <div class="w-1/2 border-r border-gray-200 overflow-y-auto">
        <!-- Outbound Header -->
        <div class="sticky top-0 bg-yellow-100 px-3 py-2 flex items-center gap-2 z-10">
          <svg class="w-5 h-5 text-yellow-600" fill="currentColor" viewBox="0 0 20 20">
            <path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"/>
          </svg>
          <div>
            <div class="text-sm font-bold">去程</div>
            <div class="text-xs text-gray-600"><%= @departure_city %> → <%= @destination_city %></div>
          </div>
        </div>

        <!-- Outbound Date Selector -->
        <div class="flex gap-1 px-2 py-2 overflow-x-auto no-scrollbar bg-white border-b border-gray-100">
          <% @date_prices.each do |date_info| %>
            <%= link_to search_flights_path(departure_city: @departure_city, destination_city: @destination_city, date: date_info[:date], trip_type: @trip_type, return_date: @return_date), 
                data: { turbo: false },
                class: "flex-shrink-0 px-2 py-1 rounded text-center text-xs #{date_info[:is_today] ? 'bg-yellow-400 text-gray-900' : 'bg-gray-100 text-gray-600'}" do %>
              <div class="font-bold"><%= I18n.l(date_info[:date], format: "%m-%d") %></div>
              <div class="text-xs <%= date_info[:is_today] ? 'text-gray-700' : 'text-gray-500' %>"><%= date_info[:weekday] %></div>
            <% end %>
          <% end %>
        </div>

        <!-- Outbound Flight Cards -->
        <div class="p-2 space-y-2">
          <% @flights.each do |flight| %>
            <div data-round-trip-selector-target="outboundFlight" 
                 data-flight-id="<%= flight.id %>" 
                 data-price="<%= flight.min_offer_price %>"
                 data-action="click->round-trip-selector#selectOutbound"
                 class="bg-white border border-gray-200 rounded-lg p-3 cursor-pointer hover:shadow-md transition-all">
              
              <!-- Time and Route -->
              <div class="flex items-center justify-between mb-2">
                <div>
                  <div class="text-2xl font-bold"><%= flight.departure_time_formatted %></div>
                  <div class="text-xs text-gray-500"><%= flight.departure_airport %></div>
                </div>
                
                <div class="flex-1 px-2">
                  <div class="border-t border-gray-300 relative">
                    <svg class="absolute top-0 left-1/2 -translate-x-1/2 -translate-y-1/2 w-3 h-3 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                      <path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"/>
                    </svg>
                  </div>
                </div>
                
                <div class="text-right">
                  <div class="text-2xl font-bold"><%= flight.arrival_time_formatted %></div>
                  <div class="text-xs text-gray-500"><%= flight.arrival_airport %></div>
                </div>
              </div>

              <!-- Airline and Price -->
              <div class="flex items-center justify-between">
                <div class="text-xs text-gray-600">
                  <span class="text-red-500"><%= flight.airline %></span> <%= flight.flight_number %>(中)
                </div>
                <div class="text-right">
                  <div class="text-lg font-bold text-red-500">¥<%= flight.min_offer_price.to_i %></div>
                  <div class="text-xs text-gray-400">起</div>
                </div>
              </div>

              <!-- Tags -->
              <% cheapest_offer = flight.flight_offers.order(:price).first %>
              <% if cheapest_offer && cheapest_offer.cashback_amount > 0 %>
                <div class="mt-2">
                  <span class="text-xs px-2 py-0.5 bg-red-50 text-red-600 rounded">少量¥<%= cheapest_offer.cashback_amount.to_i %></span>
                </div>
              <% end %>
            </div>
          <% end %>
        </div>
      </div>

      <!-- Return Flights (Right) -->
      <div class="w-1/2 overflow-y-auto">
        <!-- Return Header -->
        <div class="sticky top-0 bg-blue-100 px-3 py-2 flex items-center gap-2 z-10">
          <svg class="w-5 h-5 text-blue-600 transform rotate-180" fill="currentColor" viewBox="0 0 20 20">
            <path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"/>
          </svg>
          <div>
            <div class="text-sm font-bold">返程</div>
            <div class="text-xs text-gray-600"><%= @destination_city %> → <%= @departure_city %></div>
          </div>
        </div>

        <!-- Return Date Selector -->
        <div class="flex gap-1 px-2 py-2 overflow-x-auto no-scrollbar bg-white border-b border-gray-100">
          <% @return_date_prices.each do |date_info| %>
            <%= link_to search_flights_path(departure_city: @departure_city, destination_city: @destination_city, date: @date, trip_type: @trip_type, return_date: date_info[:date]), 
                data: { turbo: false },
                class: "flex-shrink-0 px-2 py-1 rounded text-center text-xs #{date_info[:is_today] ? 'bg-yellow-400 text-gray-900' : 'bg-gray-100 text-gray-600'}" do %>
              <div class="font-bold"><%= I18n.l(date_info[:date], format: "%m-%d") %></div>
              <div class="text-xs <%= date_info[:is_today] ? 'text-gray-700' : 'text-gray-500' %>"><%= date_info[:weekday] %></div>
            <% end %>
          <% end %>
        </div>

        <!-- Return Flight Cards -->
        <div class="p-2 space-y-2">
          <% @return_flights.each do |flight| %>
            <div data-round-trip-selector-target="returnFlight" 
                 data-flight-id="<%= flight.id %>" 
                 data-price="<%= flight.min_offer_price %>"
                 data-action="click->round-trip-selector#selectReturn"
                 class="bg-white border border-gray-200 rounded-lg p-3 cursor-pointer hover:shadow-md transition-all">
              
              <!-- Time and Route -->
              <div class="flex items-center justify-between mb-2">
                <div>
                  <div class="text-2xl font-bold"><%= flight.departure_time_formatted %></div>
                  <div class="text-xs text-gray-500"><%= flight.departure_airport %></div>
                </div>
                
                <div class="flex-1 px-2">
                  <div class="border-t border-gray-300 relative">
                    <svg class="absolute top-0 left-1/2 -translate-x-1/2 -translate-y-1/2 w-3 h-3 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                      <path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"/>
                    </svg>
                  </div>
                </div>
                
                <div class="text-right">
                  <div class="text-2xl font-bold"><%= flight.arrival_time_formatted %></div>
                  <div class="text-xs text-gray-500"><%= flight.arrival_airport %></div>
                </div>
              </div>

              <!-- Airline and Price -->
              <div class="flex items-center justify-between">
                <div class="text-xs text-gray-600">
                  <span class="text-red-500"><%= flight.airline %></span> <%= flight.flight_number %>(中)
                </div>
                <div class="text-right">
                  <div class="text-lg font-bold text-red-500">¥<%= flight.min_offer_price.to_i %></div>
                  <div class="text-xs text-gray-400">起</div>
                </div>
              </div>

              <!-- Tags -->
              <% cheapest_offer = flight.flight_offers.order(:price).first %>
              <% if cheapest_offer && cheapest_offer.cashback_amount > 0 %>
                <div class="mt-2">
                  <span class="text-xs px-2 py-0.5 bg-red-50 text-red-600 rounded">少量¥<%= cheapest_offer.cashback_amount.to_i %></span>
                </div>
              <% end %>
            </div>
          <% end %>
        </div>
      </div>
    </div>

    <!-- Bottom Submit Bar -->
    <div class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 px-4 py-3 z-50">
      <%= form_with url: new_booking_path, method: :get, data: { turbo: false }, class: "flex items-center justify-between gap-3" do |f| %>
        <%= f.hidden_field :flight_id, value: "", data: { round_trip_selector_target: "selectedOutboundId" } %>
        <%= f.hidden_field :return_flight_id, value: "", data: { round_trip_selector_target: "selectedReturnId" } %>
        <%= f.hidden_field :trip_type, value: "round_trip" %>
        
        <div class="flex-1">
          <div class="text-xs text-gray-500">总价</div>
          <div class="text-xl font-bold text-red-500" data-round-trip-selector-target="totalPrice">
            请选择去程和返程航班
          </div>
        </div>
        
        <button type="submit" 
                data-round-trip-selector-target="submitButton"
                data-action="click->round-trip-selector#submit"
                disabled
                class="px-8 py-3 bg-red-500 text-white rounded-lg font-bold opacity-50 cursor-not-allowed">
          下一步
        </button>
      <% end %>
    </div>
  </div>

<% else %>
  <!-- Original Single-Way Layout -->
  <div class="min-h-screen bg-white" data-controller="flight-search flight-filter flight-sort date-picker" data-flight-search-departure-value="<%= @departure_city %>" data-flight-search-destination-value="<%= @destination_city %>" data-flight-search-date-value="<%= @date.to_s %>" data-date-picker-current-date-value="<%= @date.to_s %>" data-flight-sort-initial-sort-value="<%= @sort_by == 'price' ? 'price_asc' : 'default' %>">
    <!-- Header -->
    <div class="sticky top-0 z-50 bg-white border-b border-gray-200">
      <!-- Top Bar -->
      <div class="flex items-center justify-between px-4 py-3">
        <%= link_to flights_path, class: "flex items-center gap-2" do %>
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
          </svg>
        <% end %>

        <div class="flex-1 text-center">
          <div class="text-lg font-bold">
            <%= @departure_city %> → <%= @destination_city %>
            <svg class="inline w-4 h-4 ml-1" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"/>
            </svg>
          </div>
        </div>

        <div class="flex items-center gap-3">
          <button class="text-sm text-primary" onclick="window.showToast('精彩即将上线，敬请期待')">低价提醒</button>
          <button onclick="window.showToast('精彩即将上线，敬请期待')">
            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
              <path d="M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"/>
            </svg>
          </button>
        </div>
      </div>

      <!-- Notice Banner -->
      <button class="mx-4 mb-2 px-3 py-2 rounded-lg bg-blue-50 flex items-center justify-between text-left" onclick="window.showToast('精彩即将上线，敬请期待')">
        <div class="flex items-center gap-2">
          <svg class="w-4 h-4 text-blue-500" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
          </svg>
          <span class="text-xs text-blue-700">伤残军人/警察优惠购票公告</span>
        </div>
        <svg class="w-4 h-4 text-blue-700" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
        </svg>
      </button>

      <!-- Date Selector -->
      <div class="flex gap-2 px-4 pb-3 overflow-x-auto no-scrollbar">
        <% @date_prices.each do |date_info| %>
          <%= link_to search_flights_path(departure_city: @departure_city, destination_city: @destination_city, date: date_info[:date], trip_type: @trip_type, return_date: @return_date), 
              data: { turbo: false },
              class: "flex-shrink-0 px-4 py-2 rounded-lg text-center #{date_info[:is_today] ? 'bg-yellow-400' : 'bg-gray-100'}" do %>
            <div class="text-xs <%= date_info[:is_today] ? 'text-gray-800' : 'text-gray-600' %>"><%= date_info[:weekday] %></div>
            <div class="text-lg font-bold <%= date_info[:is_today] ? 'text-gray-900' : 'text-gray-800' %>">
              <%= I18n.l(date_info[:date], format: "%m-%d") %>
            </div>
            <div class="text-xs <%= date_info[:is_today] ? 'text-red-600' : 'text-gray-600' %>">¥<%= date_info[:price] %></div>
          <% end %>
        <% end %>
        <button class="flex-shrink-0 w-10 h-10 rounded-lg bg-gray-100 flex items-center justify-center" data-action="click->date-picker#openModal">
          <svg class="w-5 h-5 text-gray-600" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"/>
          </svg>
        </button>
      </div>

      <!-- Promotion Banner -->
      <button class="mx-4 mb-3 px-3 py-2 rounded-lg flex items-center justify-between text-left" style="background: linear-gradient(90deg, #FFF4E6 0%, #FFE8CC 100%);" onclick="window.showToast('精彩即将上线，敬请期待')">
        <div class="flex items-center gap-2">
          <span class="text-sm font-bold" style="color: #FF6B35;">机酒联订更优惠</span>
          <span class="text-xs text-gray-600">购买国内机票立减<span class="font-bold text-red-500">20~30元</span></span>
        </div>
        <svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
        </svg>
      </button>

      <!-- Filter Tags -->
      <div class="w-full overflow-x-auto no-scrollbar">
        <div class="flex gap-2 px-4 pb-3 min-w-max">
          <button class="flex-shrink-0 px-3 py-1.5 rounded-full border border-gray-300 text-sm flex items-center gap-1 relative" data-action="click->flight-filter#openModal">
            筛选
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
              <path d="M3 3a1 1 0 011-1h12a1 1 0 011 1v3a1 1 0 01-.293.707L12 11.414V15a1 1 0 01-.293.707l-2 2A1 1 0 018 17v-5.586L3.293 6.707A1 1 0 013 6V3z"/>
            </svg>
            <span data-flight-filter-target="filterBadge" class="hidden absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center font-bold">0</span>
          </button>
          <button class="flex-shrink-0 px-3 py-1.5 rounded-full border border-gray-300 text-sm whitespace-nowrap" data-flight-filter-target="quickDirectFlight" data-action="click->flight-filter#toggleQuickDirectFlight">只看直飞</button>
          <button class="flex-shrink-0 px-3 py-1.5 rounded-full border border-gray-300 text-sm whitespace-nowrap" data-flight-filter-target="quickNoSharedFlight" data-action="click->flight-filter#toggleQuickNoSharedFlight">不看共享航班</button>
          <button class="flex-shrink-0 px-3 py-1.5 rounded-full border border-gray-300 text-sm whitespace-nowrap" data-flight-filter-target="quickCheckedLuggage" data-action="click->flight-filter#toggleQuickCheckedLuggage">含托运行李额</button>
          <button class="flex-shrink-0 px-3 py-1.5 rounded-full border border-gray-300 text-sm whitespace-nowrap" data-flight-filter-target="quickNoTransit" data-action="click->flight-filter#toggleQuickNoTransit">无需过境签</button>
          <button class="flex-shrink-0 px-3 py-1.5 rounded-full border border-gray-300 text-sm whitespace-nowrap" data-flight-filter-target="quickDiscountPrice" data-action="click->flight-filter#toggleQuickDiscountPrice">看优惠前价格</button>
        </div>
      </div>
    </div>

    <!-- Flight List -->
    <div class="w-full space-y-3" data-flight-sort-target="flightList">
      <% @flights.each do |flight| %>
        <%= link_to flight_path(flight), data: { turbo: false }, class: "block w-full" do %>
          <div class="bg-white p-3 relative border-b border-gray-100 w-full max-w-full">
            <!-- 右上角收藏星标 -->
            <div class="absolute top-1 right-4 text-gray-300">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.382-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" />
              </svg>
            </div>

            <div class="flex justify-between items-start">
              <!-- 时间和地点 -->
              <div class="flex items-center space-x-2">
                <!-- 出发 -->
                <div class="text-center">
                  <div class="text-[28px] font-semibold leading-tight text-gray-900"><%= flight.departure_time_formatted %></div>
                  <div class="text-sm text-gray-600 mt-1"><%= flight.departure_airport %></div>
                </div>

                <!-- 航程指示线 -->
                <div class="flex-1 flex flex-col items-center justify-center min-w-[80px]">
                  <span class="text-[11px] text-gray-400 mb-0.5">总<%= flight.duration_minutes / 60 %>h<% if flight.duration_minutes % 60 > 0 %><%= flight.duration_minutes % 60 %>m<% end %></span>
                  <div class="w-full h-[1px] bg-gray-200 relative">
                    <div class="absolute right-0 -top-[2px] w-1 h-1 bg-gray-200 rotate-45 border-t border-r border-gray-200"></div>
                  </div>
                </div>

                <!-- 到达 -->
                <div class="text-center">
                  <% if flight.arrival_time.to_date != flight.departure_time.to_date %>
                    <div class="relative inline-block text-left">
                      <div class="text-[11px] text-gray-500 absolute -top-4 left-0 whitespace-nowrap"><%= flight.arrival_time.strftime('%m-%d') %> <%= ['周日','周一','周二','周三','周四','周五','周六'][flight.arrival_time.wday] %></div>
                      <div class="text-[28px] font-semibold leading-tight text-gray-900"><%= flight.arrival_time_formatted %></div>
                    </div>
                  <% else %>
                    <div class="text-[24px] font-semibold leading-tight text-gray-900"><%= flight.arrival_time_formatted %></div>
                  <% end %>
                  <div class="text-sm text-gray-600 mt-1 text-left"><%= flight.arrival_airport %></div>
                </div>
              </div>

              <!-- 价格区域 -->
              <div class="text-right mt-1">
                <div class="flex items-center justify-end space-x-1">
                  <% original_price = (flight.min_offer_price * (1 + rand(0.01..0.02))).to_i %>
                  <span class="text-xs text-gray-400 line-through">¥<%= original_price %></span>
                  <span class="text-[15px] text-[#ff5500] font-bold">¥</span>
                  <span class="text-[28px] text-[#ff5500] font-bold leading-none"><%= flight.min_offer_price.to_i %></span>
                </div>
                <% discount_count = rand(1..3) %>
                <% discount_amount = rand(20..100) %>
                <div class="mt-2 inline-flex items-center bg-[#fff1ed] text-[#ff5500] px-1.5 py-0.5 rounded text-[11px] font-medium border border-[#ffe0d6]">
                  <%= discount_count %>项至高减¥<%= discount_amount %>
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-2.5 w-2.5 ml-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M9 5l7 7-7 7" />
                  </svg>
                </div>
              </div>
            </div>

            <!-- 底部航班信息 -->
            <div class="flex items-center mt-4 space-x-2 text-xs text-gray-500">
              <% 
                airline_code = case flight.airline
                when '东航' then 'MU'
                when '南航' then 'CZ'
                when '国航' then 'CA'
                when '海航' then 'HU'
                when '川航' then '3U'
                when '深圳航空' then 'ZH'
                else flight.airline[0..1]
                end
                airline_colors = ['bg-red-600', 'bg-red-500', 'bg-blue-600', 'bg-blue-500', 'bg-green-600']
                airline_color = airline_colors[flight.id % airline_colors.length]
              %>
              <div class="w-4 h-4 rounded-full <%= airline_color %> flex items-center justify-center text-[10px] text-white font-bold italic"><%= airline_code %></div>
              <span><%= flight.airline %></span>
              <span class="text-gray-300">|</span>
              <% if rand < 0.3 %>
                <span class="bg-gray-100 px-1 rounded-sm text-gray-500">共享</span>
                <span class="text-gray-300">|</span>
              <% end %>
              <span><%= flight.aircraft_type %></span>
            </div>
          </div>
        <% end %>
      <% end %>

      <% if @flights.empty? %>
        <div class="text-center py-12">
          <div class="text-gray-400 text-lg mb-2">暂无航班</div>
          <div class="text-gray-500 text-sm">请尝试其他日期</div>
        </div>
      <% end %>
    </div>

    <!-- Bottom Navigation -->
    <div class="fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-white border-t border-gray-200 px-4 py-3">
      <div class="flex items-center justify-around">
        <button class="flex flex-col items-center gap-1" 
                data-flight-sort-target="directPriorityButton"
                data-action="click->flight-sort#toggleDirectPriority">
          <svg class="w-6 h-6 text-gray-600" fill="currentColor" viewBox="0 0 20 20">
            <path d="M10 18a8 8 0 100-16 8 8 0 000 16zM4.332 8.027a6.012 6.012 0 011.912-2.706C6.512 5.73 6.974 6 7.5 6A1.5 1.5 0 019 7.5V8a2 2 0 004 0 2 2 0 011.523-1.943A5.977 5.977 0 0116 10c0 .34-.028.675-.083 1H15a2 2 0 00-2 2v2.197A5.973 5.973 0 0110 16v-2a2 2 0 00-2-2 2 2 0 01-2-2 2 2 0 00-1.668-1.973z"/>
          </svg>
          <span class="text-xs text-gray-600">直飞优先</span>
        </button>
        
        <button class="flex flex-col items-center gap-1"
                data-flight-sort-target="pricePriorityButton"
                data-action="click->flight-sort#togglePricePriority">
          <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
            <path d="M8.433 7.418c.155-.103.346-.196.567-.267v1.698a2.305 2.305 0 01-.567-.267C8.07 8.34 8 8.114 8 8c0-.114.07-.34.433-.582zM11 12.849v-1.698c.22.071.412.164.567.267.364.243.433.468.433.582 0 .114-.07.34-.433.582a2.305 2.305 0 01-.567.267z"/>
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v.092a4.535 4.535 0 00-1.676.662C6.602 6.234 6 7.009 6 8c0 .99.602 1.765 1.324 2.246.48.32 1.054.545 1.676.662v1.941c-.391-.127-.68-.317-.843-.504a1 1 0 10-1.51 1.31c.562.649 1.413 1.076 2.353 1.253V15a1 1 0 102 0v-.092a4.535 4.535 0 001.676-.662C13.398 13.766 14 12.991 14 12c0-.99-.602-1.765-1.324-2.246A4.535 4.535 0 0011 9.092V7.151c.391.127.68.317.843.504a1 1 0 101.511-1.31c-.563-.649-1.413-1.076-2.354-1.253V5z" clip-rule="evenodd"/>
          </svg>
          <span class="text-xs text-gray-600">低价优先</span>
        </button>
        
        <button class="flex flex-col items-center gap-1"
                data-flight-sort-target="timeSortButton"
                data-action="click->flight-sort#openTimeSortModal">
          <svg class="w-6 h-6 text-gray-600" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
          </svg>
          <span class="text-xs text-gray-600">时间排序</span>
        </button>
      </div>
    </div>

    <!-- Filter Modal -->
    <%= render 'flights/filter_modal' %>
    
    <!-- Sort Modal -->
    <%= render 'flights/sort_modal' %>
    
    <!-- Date Picker Modal -->
    <%= render 'shared/date_picker_modal' %>
  </div>
<% end %>
