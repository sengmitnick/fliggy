<div class="min-h-screen bg-gray-100 max-w-[450px] mx-auto relative" data-controller="city-selector">

  <!-- 搜索栏区域 -->
  <div class="bg-white px-3 pb-2 pt-3 flex items-center gap-2 sticky top-0 z-40">
    <!-- 返回按钮 -->
    <%= link_to hotels_path(city: @city, check_in: @check_in, check_out: @check_out, rooms: @rooms, adults: @adults, children: @children, price_min: params[:price_min], price_max: params[:price_max], star_level: params[:star_level]), class: "flex-shrink-0" do %>
      <svg class="w-6 h-6 text-gray-800" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
      </svg>
    <% end %>
    
    <!-- 搜索输入框 (黄色边框) -->
    <%= form_with url: search_hotels_path, method: :get, data: { turbo: false }, class: "flex-1" do |f| %>
      <div class="flex-1 flex items-center border-[1.5px] border-[#ffd000] rounded-full h-10 px-3 bg-white shadow-sm overflow-hidden">
        <!-- 城市 -->
        <span class="font-bold text-gray-800 text-sm mr-1 cursor-pointer" data-action="click->city-selector#openHotelCitySelector"><%= @city.gsub('市', '') %></span>
        <!-- 日期 -->
        <div class="flex flex-col justify-center leading-none text-[9px] text-gray-500 mr-2 border-r border-gray-200 pr-2 h-6">
          <span><%= @check_in.strftime('%m-%d') %> <span class="text-gray-400"><%= @rooms %>间</span></span>
          <span><%= @check_out.strftime('%m-%d') %> <span class="text-gray-400"><%= @adults %>人</span></span>
        </div>
        <!-- 关键字 -->
        <%= f.text_field :q, value: params[:q], class: "text-gray-800 text-sm flex-1 truncate border-none outline-none bg-transparent p-0", placeholder: "" %>
        <%= f.hidden_field :city, value: @city %>
        <%= f.hidden_field :check_in, value: @check_in %>
        <%= f.hidden_field :check_out, value: @check_out %>
        <%= f.hidden_field :rooms, value: @rooms %>
        <%= f.hidden_field :adults, value: @adults %>
        <%= f.hidden_field :children, value: @children %>
        <!-- 清除按钮 -->
        <% if params[:q].present? %>
          <div class="bg-gray-200 rounded-full p-0.5 ml-1 cursor-pointer" onclick="this.closest('form').querySelector('[name=q]').value=''; this.closest('form').submit();">
            <svg class="w-3 h-3 text-white" fill="currentColor" viewBox="0 0 20 20">
              <path d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"></path>
            </svg>
          </div>
        <% end %>
      </div>
    <% end %>

    <!-- 右侧图标 -->
    <div class="flex gap-3 text-gray-800">
      <button type="button"
              data-controller="hotel-map-toggle"
              data-action="click->hotel-map-toggle#toggleAndScroll"
              class="cursor-pointer hover:text-primary transition-colors">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
        </svg>
      </button>
      <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
        <circle cx="5" cy="12" r="2"/>
        <circle cx="12" cy="12" r="2"/>
        <circle cx="19" cy="12" r="2"/>
      </svg>
    </div>
  </div>

  <!-- 筛选栏 -->
  <div class="bg-white mt-3 px-4 py-3 flex items-center gap-3 border-b border-gray-100" 
       data-controller="hotel-search-filter" 
       data-hotel-search-filter-city-value="<%= @city %>" 
       data-hotel-search-filter-check-in-value="<%= @check_in %>" 
       data-hotel-search-filter-check-out-value="<%= @check_out %>" 
       data-hotel-search-filter-rooms-value="<%= @rooms %>" 
       data-hotel-search-filter-adults-value="<%= @adults %>" 
       data-hotel-search-filter-children-value="<%= @children %>" 
       data-hotel-search-filter-query-value="<%= params[:q] || '' %>" 
       data-hotel-search-filter-sort-value="<%= params[:sort] || 'recommend' %>" 
       data-hotel-search-filter-district-value="<%= params[:district] || '' %>" 
       data-hotel-search-filter-price-range-value="<%= params[:price_range] || '' %>" 
       data-hotel-search-filter-stars-value="<%= params[:star_level] || '' %>"
       data-hotel-search-filter-brand-value="<%= params[:brand] || '' %>">
    
    <!-- 排序按钮 -->
    <button type="button" 
            data-hotel-search-filter-target="sortButton" 
            data-action="click->hotel-search-filter#openSortModal" 
            class="flex items-center gap-1 text-sm font-medium text-gray-700 hover:text-primary transition-colors">
      <span><%= params[:sort] == 'rating' ? '评分优先' : params[:sort] == 'distance' ? '距离优先' : params[:sort] == 'price' ? '价格优先' : '推荐排序' %></span>
      <svg class="w-3 h-3 fill-current" viewBox="0 0 20 20">
        <path d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"/>
      </svg>
    </button>
    
    <!-- 商圈按钮 -->
    <button type="button" 
            data-hotel-search-filter-target="districtButton" 
            data-action="click->hotel-search-filter#openDistrictModal" 
            class="flex items-center gap-1 text-sm font-medium text-gray-700 hover:text-primary transition-colors">
      <span><%= params[:district].present? ? params[:district] : '位置距离' %></span>
      <svg class="w-3 h-3 fill-current" viewBox="0 0 20 20">
        <path d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"/>
      </svg>
    </button>
    
    <!-- 价格按钮 -->
    <button type="button" 
            data-hotel-search-filter-target="priceButton" 
            data-action="click->hotel-search-filter#openPriceModal" 
            class="flex items-center gap-1 text-sm font-medium text-gray-700 hover:text-primary transition-colors">
      <span><%= params[:price_range] == '0-100' ? '¥100以下' : params[:price_range] == '100-200' ? '¥100-200' : params[:price_range] == '200-300' ? '¥200-300' : params[:price_range] == '300+' ? '¥300以上' : '价格/星级' %></span>
      <svg class="w-3 h-3 fill-current" viewBox="0 0 20 20">
        <path d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"/>
      </svg>
    </button>
    
    <!-- 筛选按钮 -->
    <button type="button" 
            data-hotel-search-filter-target="filterButton" 
            data-action="click->hotel-search-filter#openFilterModal" 
            class="flex items-center gap-1 text-sm font-medium text-gray-700 hover:text-primary transition-colors">
      <span><%= params[:star_level].present? ? "#{params[:star_level]}星" : '筛选' %></span>
      <svg class="w-3 h-3 fill-current" viewBox="0 0 20 20">
        <path d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"/>
      </svg>
    </button>
    
    <!-- 品牌按钮 -->
    <button type="button" 
            data-hotel-search-filter-target="brandButton" 
            data-action="click->hotel-search-filter#openBrandModal" 
            class="flex items-center gap-1 text-sm font-medium text-gray-700 hover:text-primary transition-colors">
      <span><%= params[:brand].present? ? params[:brand] : '品牌' %></span>
      <svg class="w-3 h-3 fill-current" viewBox="0 0 20 20">
        <path d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"/>
      </svg>
    </button>
    
    <!-- 排序模态框 -->
    <div data-hotel-search-filter-target="sortModal" 
         data-action="click->hotel-search-filter#closeAllModals" 
         class="hidden fixed inset-0 bg-black/50 z-50">
      <div data-action="click->hotel-search-filter#stopPropagation" 
           class="absolute bottom-0 left-0 right-0 bg-white rounded-t-2xl max-w-[450px] mx-auto">
        <div class="p-4 space-y-2">
          <h3 class="text-lg font-bold mb-4">排序方式</h3>
          <button data-hotel-search-filter-target="sortOption" 
                  data-value="recommend" 
                  data-action="click->hotel-search-filter#selectSort" 
                  class="w-full text-left px-4 py-3 rounded-lg hover:bg-gray-50 <%= params[:sort].blank? || params[:sort] == 'recommend' ? 'text-primary font-bold' : 'text-gray-700' %>">
            推荐排序
          </button>
          <button data-hotel-search-filter-target="sortOption" 
                  data-value="price" 
                  data-action="click->hotel-search-filter#selectSort" 
                  class="w-full text-left px-4 py-3 rounded-lg hover:bg-gray-50 <%= params[:sort] == 'price' ? 'text-primary font-bold' : 'text-gray-700' %>">
            价格优先
          </button>
          <button data-hotel-search-filter-target="sortOption" 
                  data-value="rating" 
                  data-action="click->hotel-search-filter#selectSort" 
                  class="w-full text-left px-4 py-3 rounded-lg hover:bg-gray-50 <%= params[:sort] == 'rating' ? 'text-primary font-bold' : 'text-gray-700' %>">
            评分优先
          </button>
          <button data-hotel-search-filter-target="sortOption" 
                  data-value="distance" 
                  data-action="click->hotel-search-filter#selectSort" 
                  class="w-full text-left px-4 py-3 rounded-lg hover:bg-gray-50 <%= params[:sort] == 'distance' ? 'text-primary font-bold' : 'text-gray-700' %>">
            距离优先
          </button>
        </div>
      </div>
    </div>
    
    <!-- 商圈模态框 -->
    <div data-hotel-search-filter-target="districtModal" 
         data-action="click->hotel-search-filter#closeAllModals" 
         class="hidden fixed inset-0 bg-black/50 z-50">
      <div data-action="click->hotel-search-filter#stopPropagation" 
           class="absolute bottom-0 left-0 right-0 bg-white rounded-t-2xl max-w-[450px] mx-auto max-h-[70vh] overflow-y-auto">
        <div class="p-4">
          <h3 class="text-lg font-bold mb-4">选择商圈</h3>
          <div class="grid grid-cols-3 gap-2">
            <button data-hotel-search-filter-target="districtOption" 
                    data-value="" 
                    data-action="click->hotel-search-filter#selectDistrict" 
                    class="px-3 py-2 rounded-lg text-sm <%= params[:district].blank? ? 'bg-primary text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200' %>">
              不限
            </button>
            <% @districts.each do |district| %>
              <button data-hotel-search-filter-target="districtOption" 
                      data-value="<%= district %>" 
                      data-action="click->hotel-search-filter#selectDistrict" 
                      class="px-3 py-2 rounded-lg text-sm <%= params[:district] == district ? 'bg-primary text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200' %>">
                <%= district %>
              </button>
            <% end %>
          </div>
        </div>
      </div>
    </div>
    
    <!-- 价格模态框 -->
    <div data-hotel-search-filter-target="priceModal" 
         data-action="click->hotel-search-filter#closeAllModals" 
         class="hidden fixed inset-0 bg-black/50 z-50">
      <div data-action="click->hotel-search-filter#stopPropagation" 
           class="absolute bottom-0 left-0 right-0 bg-white rounded-t-2xl max-w-[450px] mx-auto">
        <div class="p-4">
          <h3 class="text-lg font-bold mb-4">价格区间</h3>
          <div class="grid grid-cols-2 gap-2">
            <button data-hotel-search-filter-target="priceOption" 
                    data-value="" 
                    data-action="click->hotel-search-filter#selectPriceRange" 
                    class="px-3 py-2 rounded-lg text-sm <%= params[:price_range].blank? ? 'bg-primary text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200' %>">
              不限
            </button>
            <button data-hotel-search-filter-target="priceOption" 
                    data-value="0-100" 
                    data-action="click->hotel-search-filter#selectPriceRange" 
                    class="px-3 py-2 rounded-lg text-sm <%= params[:price_range] == '0-100' ? 'bg-primary text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200' %>">
              ¥100以下
            </button>
            <button data-hotel-search-filter-target="priceOption" 
                    data-value="100-200" 
                    data-action="click->hotel-search-filter#selectPriceRange" 
                    class="px-3 py-2 rounded-lg text-sm <%= params[:price_range] == '100-200' ? 'bg-primary text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200' %>">
              ¥100-200
            </button>
            <button data-hotel-search-filter-target="priceOption" 
                    data-value="200-300" 
                    data-action="click->hotel-search-filter#selectPriceRange" 
                    class="px-3 py-2 rounded-lg text-sm <%= params[:price_range] == '200-300' ? 'bg-primary text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200' %>">
              ¥200-300
            </button>
            <button data-hotel-search-filter-target="priceOption" 
                    data-value="300+" 
                    data-action="click->hotel-search-filter#selectPriceRange" 
                    class="px-3 py-2 rounded-lg text-sm <%= params[:price_range] == '300+' ? 'bg-primary text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200' %>">
              ¥300以上
            </button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- 星级筛选模态框 -->
    <div data-hotel-search-filter-target="filterModal" 
         data-action="click->hotel-search-filter#closeAllModals" 
         class="hidden fixed inset-0 bg-black/50 z-50">
      <div data-action="click->hotel-search-filter#stopPropagation" 
           class="absolute bottom-0 left-0 right-0 bg-white rounded-t-2xl max-w-[450px] mx-auto">
        <div class="p-4">
          <h3 class="text-lg font-bold mb-4">星级筛选</h3>
          <div class="space-y-2 mb-4">
            <button data-hotel-search-filter-target="starOption" 
                    data-value="5" 
                    data-action="click->hotel-search-filter#toggleStar" 
                    class="w-full px-4 py-3 rounded-lg text-left <%= params[:star_level] == '5' ? 'bg-primary text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200' %>">
              <div class="font-bold">五星级/豪华</div>
              <div class="text-xs opacity-80">高档豪华型酒店</div>
            </button>
            <button data-hotel-search-filter-target="starOption" 
                    data-value="4" 
                    data-action="click->hotel-search-filter#toggleStar" 
                    class="w-full px-4 py-3 rounded-lg text-left <%= params[:star_level] == '4' ? 'bg-primary text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200' %>">
              <div class="font-bold">四星级/高档</div>
              <div class="text-xs opacity-80">舒适高档型酒店</div>
            </button>
            <button data-hotel-search-filter-target="starOption" 
                    data-value="3" 
                    data-action="click->hotel-search-filter#toggleStar" 
                    class="w-full px-4 py-3 rounded-lg text-left <%= params[:star_level] == '3' ? 'bg-primary text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200' %>">
              <div class="font-bold">三星级/舒适</div>
              <div class="text-xs opacity-80">经济舒适型酒店</div>
            </button>
            <button data-hotel-search-filter-target="starOption" 
                    data-value="2" 
                    data-action="click->hotel-search-filter#toggleStar" 
                    class="w-full px-4 py-3 rounded-lg text-left <%= params[:star_level] == '2' ? 'bg-primary text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200' %>">
              <div class="font-bold">二星级及以下</div>
              <div class="text-xs opacity-80">经济实惠型酒店</div>
            </button>
          </div>
          <div class="flex gap-3 pt-3 border-t">
            <button data-action="click->hotel-search-filter#clearFilters" 
                    class="flex-1 px-4 py-2 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-50">
              清空筛选
            </button>
            <button data-action="click->hotel-search-filter#applyFilters" 
                    class="flex-1 px-4 py-2 rounded-lg bg-primary text-white hover:bg-primary-dark">
              确认
            </button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- 品牌筛选模态框 -->
    <div data-hotel-search-filter-target="brandModal" 
         data-action="click->hotel-search-filter#closeAllModals" 
         class="hidden fixed inset-0 bg-black/50 z-50">
      <div data-action="click->hotel-search-filter#stopPropagation" 
           class="absolute bottom-0 left-0 right-0 bg-white rounded-t-2xl max-w-[450px] mx-auto max-h-[70vh] overflow-y-auto">
        <div class="p-4">
          <h3 class="text-lg font-bold mb-4">选择品牌</h3>
          <div class="grid grid-cols-3 gap-2">
            <button data-hotel-search-filter-target="brandOption" 
                    data-value="" 
                    data-action="click->hotel-search-filter#selectBrand" 
                    class="px-3 py-2 rounded-lg text-sm <%= params[:brand].blank? ? 'bg-primary text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200' %>">
              不限
            </button>
            <% @brands.each do |brand| %>
              <button data-hotel-search-filter-target="brandOption" 
                      data-value="<%= brand %>" 
                      data-action="click->hotel-search-filter#selectBrand" 
                      class="px-3 py-2 rounded-lg text-sm <%= params[:brand] == brand ? 'bg-primary text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200' %>">
                <%= brand %>
              </button>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 快捷标签 (横向滚动) -->
  

  <!-- 地图模块 -->
  <div class="relative w-full h-32 overflow-hidden transition-all duration-300" 
       style="background-color: #eef4f9; background-image: linear-gradient(#dcebf5 2px, transparent 2px), linear-gradient(90deg, #dcebf5 2px, transparent 2px); background-size: 40px 40px;"
       data-controller="hotel-map-toggle"
       data-hotel-map-toggle-target="mapContainer">
    <!-- 地图内容模拟 -->
    <div class="absolute top-0 left-0 w-1/3 h-full bg-blue-100 opacity-50 transform -skew-x-12"></div>
    <div class="absolute bottom-4 left-4 text-xs font-bold text-gray-400">高德地图</div>
    
    <!-- 价格气泡 -->
    <% if @hotels.present? %>
      <% @hotels.first(20).each_with_index do |hotel, index| %>
        <% 
          # 为前20个酒店生成分散的位置
          row = (index / 5).to_i
          col = index % 5
          left_pos = 15 + col * 18
          top_pos = 20 + row * 140
        %>
        <div class="absolute flex flex-col items-center z-10" style="top: <%= top_pos %>px; left: <%= left_pos %>%;">
          <div class="bg-[#5c7cfa] text-white text-[10px] px-1.5 py-0.5 rounded shadow-lg border border-white hover:bg-[#4c6ce8] transition-colors cursor-pointer">
            <span>¥<%= (hotel.price * @rooms).to_i %></span>
          </div>
          <div class="w-1.5 h-1.5 bg-[#5c7cfa] transform rotate-45 -mt-0.5"></div>
        </div>
      <% end %>
    <% end %>
    
    <!-- 红点中心 -->
    <div class="absolute top-5 left-[50%] transform -translate-x-1/2">
      <div class="w-8 h-8 bg-red-500/20 rounded-full flex items-center justify-center animate-pulse">
        <div class="w-3 h-3 bg-red-500 rounded-full border-2 border-white shadow"></div>
      </div>
    </div>

    <!-- 浮动按钮 -->
    <button type="button"
            data-hotel-map-toggle-target="expandButton"
            data-action="click->hotel-map-toggle#toggle"
            class="absolute bottom-3 right-3 bg-white px-2 py-1 rounded shadow text-xs text-gray-700 flex items-center gap-1 border border-gray-200 hover:bg-gray-50 transition-colors">
      <div class="bg-indigo-500 p-0.5 rounded-sm">
        <svg class="w-3 h-3 text-white" fill="currentColor" viewBox="0 0 20 20">
          <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 13a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1h-2a1 1 0 01-1-1v-2z"/>
        </svg>
      </div>
      看大地图 
      <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
      </svg>
    </button>
    <button type="button"
            data-hotel-map-toggle-target="closeButton"
            data-action="click->hotel-map-toggle#toggle"
            class="hidden absolute bottom-3 right-3 bg-white px-2 py-1 rounded shadow text-xs text-gray-700 border border-gray-200 hover:bg-gray-50 transition-colors z-20">
      关闭地图
    </button>
  </div>

  <!-- 酒店列表 -->
  <div class="pb-10">
    <% @hotels.each do |hotel| %>
      <%= link_to hotel_path(hotel, check_in: @check_in, check_out: @check_out, rooms: @rooms, adults: @adults, children: @children, room_category: @room_category), class: "flex bg-white p-3 border-b border-gray-200" do %>
        <!-- 左侧图片 -->
        <div class="relative w-[110px] h-[140px] bg-gray-200 rounded-lg overflow-hidden shrink-0">
          <% if hotel.image.attached? %>
            <%= image_tag hotel.image, class: "w-full h-full object-cover", alt: hotel.name %>
          <% elsif hotel.image_url.present? %>
            <%= image_tag hotel.image_url, class: "w-full h-full object-cover", alt: hotel.name, onerror: "this.src='https://images.unsplash.com/photo-1566073771259-6a8506099945?w=800&q=80'" %>
          <% else %>
            <%= image_tag "https://images.unsplash.com/photo-1566073771259-6a8506099945?w=800&q=80", class: "w-full h-full object-cover", alt: "酒店占位图" %>
          <% end %>
          <!-- 促销标签 -->
          <% if hotel.is_featured %>
            <div class="absolute bottom-0 w-full bg-gradient-to-r from-orange-400 to-orange-500 text-white text-[10px] font-medium text-center py-1">
              限时里程 <span class="text-yellow-100 font-bold text-xs">20</span> 倍抵现金
            </div>
          <% end %>
        </div>
        
        <!-- 右侧内容 -->
        <div class="flex-1 ml-3 flex flex-col justify-between">
          <div>
            <div class="flex items-start">
              <h3 class="font-bold text-base text-gray-900 leading-tight">
                <% if hotel.is_featured %>
                  <span class="bg-[#ff4d4f] text-white text-[10px] px-1 rounded-sm align-middle mr-1 relative -top-0.5">闪促</span>
                <% end %>
                <%= hotel.name %>
              </h3>
            </div>
            <div class="text-[10px] text-gray-400 mt-1"><%= hotel.hotel_type == 'hotel' ? '酒店' : '民宿' %> · <%= hotel.star_level %>星</div>
            <% if hotel.rating.present? %>
              <div class="flex items-center mt-1">
                <span class="bg-[#5c7cfa] text-white text-[10px] font-bold px-1 rounded-sm mr-1"><%= hotel.rating %></span>
                <span class="text-[#5c7cfa] text-xs mr-2">设施齐全</span>
              </div>
            <% end %>
            <div class="text-xs text-gray-500 mt-0.5 truncate"><%= hotel.address %></div>
            
            <!-- 设施标签 -->
            <% if hotel.features.present? && hotel.features.is_a?(Array) %>
              <div class="flex flex-wrap gap-1 mt-1.5">
                <% hotel.features.first(4).each do |feature| %>
                  <span class="text-[10px] text-gray-600 border border-gray-200 px-1 rounded bg-gray-50"><%= feature %></span>
                <% end %>
              </div>
            <% end %>
          </div>

          <div class="flex justify-between items-end mt-1">
            <span class="text-[10px] text-gray-400"><%= rand(50..500) %>+预订</span>
            <div class="text-right">
              <% if hotel.original_price.present? && hotel.original_price > hotel.price %>
                <div class="text-[10px] text-gray-400 line-through">¥<%= (hotel.original_price * @rooms).to_i if hotel.original_price && hotel.original_price > hotel.display_price(@room_category) %></div>
              <% end %>
              <div class="text-[#ff4d4f] leading-none">
                <span class="text-xs font-bold">¥</span><span class="text-2xl font-bold"><%= (hotel.display_price(@room_category) * @rooms).to_i %></span><span class="text-xs text-gray-500">起</span>
              </div>
              <% if hotel.is_featured %>
                <div class="bg-[#ff4d4f] text-white text-[10px] px-1 rounded-sm inline-block mt-0.5 scale-90 origin-right">
                  膨胀神券 <span class="bg-white/20 px-0.5 ml-0.5 rounded-sm">已膨至<%= rand(10..50) %>↗</span>
                </div>
              <% end %>
            </div>
          </div>
        </div>
      <% end %>
    <% end %>
    
    <!-- 分页 -->
    <% if @hotels.present? %>
      <div class="px-4 py-4">
        <%= paginate @hotels %>
      </div>
    <% else %>
      <div class="text-center py-8 text-gray-500">
        暂无符合条件的酒店
      </div>
    <% end %>
  </div>

  <!-- 底部导航 -->
  <%= render 'shared/bottom_navigation' %>

  <!-- 城市选择弹窗 -->
  <div data-city-selector-target="modal" class="hidden fixed inset-0 bg-black/50 z-50" data-action="click->city-selector#closeModal">
    <div class="absolute inset-0 max-w-[450px] mx-auto bg-white" data-action="click->city-selector#stopPropagation">
      <!-- 标题栏 -->
      <div class="flex items-center justify-between p-4 border-b">
        <h2 class="text-lg font-bold">选择目的地</h2>
        <button type="button" data-action="click->city-selector#closeModal" class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>

      <!-- 搜索框 -->
      <div class="p-4 border-b">
        <div class="relative">
          <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
          </svg>
          <input type="text" 
                 data-city-selector-target="searchInput" 
                 data-action="input->city-selector#searchCities"
                 placeholder="搜索国家或城市的中英文名" 
                 class="w-full pl-10 pr-4 py-2 bg-gray-100 rounded-lg border-none outline-none focus:ring-2 focus:ring-primary">
        </div>
      </div>

      <!-- 国内/国际选项卡 -->
      <div class="flex border-b">
        <button type="button" 
                data-city-selector-target="tabDomestic"
                data-region="domestic"
                data-action="click->city-selector#toggleRegion"
                class="flex-1 py-3 text-center font-medium border-b-2 border-primary text-primary">
          国内 (含港澳台)
        </button>
        <button type="button" 
                data-city-selector-target="tabInternational"
                data-region="international"
                data-action="click->city-selector#toggleRegion"
                class="flex-1 py-3 text-center font-medium text-gray-500">
          国际
        </button>
      </div>

      <!-- 内容区域 -->
      <div class="overflow-y-auto" style="height: calc(100vh - 220px);">
        <!-- 国内城市列表 -->
        <div data-city-selector-target="domesticList">
          <!-- 当前定位 -->
          <div class="p-4 border-b">
            <div class="flex items-center justify-between mb-2">
              <h3 class="text-sm font-bold text-gray-700">当前定位</h3>
              <button type="button" 
                      data-city-selector-target="locationButton"
                      data-action="click->city-selector#requestLocation"
                      class="flex items-center gap-1 text-sm text-primary">
                <span data-city-selector-target="locationText">开启定位权限</span>
                <svg data-city-selector-target="locationSpinner" class="hidden animate-spin w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                </svg>
              </button>
            </div>
            <div data-city-selector-target="locatedCity" class="hidden">
              <button type="button" 
                      data-city-selector-target="locatedCityButton"
                      data-action="click->city-selector#selectCity"
                      class="px-3 py-2 bg-gray-100 rounded-lg text-sm hover:bg-gray-200">
              </button>
            </div>
            <div data-city-selector-target="locationStatus" class="flex items-center gap-2 text-sm text-gray-500">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"></path>
              </svg>
              <span>点击上方按钮开启定位</span>
            </div>
          </div>

          <!-- 热门城市 -->
          <div class="p-4 border-b">
            <h3 class="text-sm font-bold text-gray-700 mb-3">热门城市</h3>
            <div class="grid grid-cols-4 gap-2">
              <% @hot_cities.each do |city| %>
                <button type="button" 
                        data-city-name="<%= city.name %>"
                        data-action="click->city-selector#selectCity"
                        class="px-3 py-2 bg-gray-100 rounded-lg text-sm text-center hover:bg-gray-200 <%= @city.gsub('市', '') == city.name ? 'bg-yellow-100 ring-2 ring-yellow-400' : '' %>">
                  <%= city.name %>
                </button>
              <% end %>
            </div>
          </div>

          <!-- 字母索引 -->
          <div class="p-4">
            <h3 class="text-sm font-bold text-gray-700 mb-3">字母索引</h3>
            <div class="grid grid-cols-7 gap-2 mb-4">
              <% ('A'..'Z').each do |letter| %>
                <a href="#letter-<%= letter %>" class="px-2 py-1 text-sm text-center text-gray-600 hover:text-primary">
                  <%= letter %>
                </a>
              <% end %>
            </div>

            <!-- 所有城市按字母分组 -->
            <% @cities_by_letter.sort.each do |letter, cities| %>
              <div class="mb-4" id="letter-<%= letter %>">
                <h4 class="text-xs font-bold text-gray-500 mb-2"><%= letter %></h4>
                <div class="grid grid-cols-4 gap-2">
                  <% cities.each do |city| %>
                    <button type="button" 
                            data-city-name="<%= city %>"
                            data-action="click->city-selector#selectCity"
                            class="px-3 py-2 bg-gray-100 rounded-lg text-sm text-center hover:bg-gray-200">
                      <%= city %>
                    </button>
                  <% end %>
                </div>
              </div>
            <% end %>
          </div>
        </div>

        <!-- 国际城市列表 -->
        <div data-city-selector-target="internationalList" class="hidden">
          <!-- 当前定位 -->
          <div class="px-4 py-3 border-b">
            <div class="flex items-center justify-between mb-3">
              <h3 class="text-sm font-bold text-gray-700">当前定位</h3>
              <button type="button" 
                      data-action="click->city-selector#requestLocation"
                      data-city-selector-target="locationButton"
                      class="text-xs text-primary hover:underline">
                开启定位权限
              </button>
            </div>
            <div class="flex items-center gap-2 text-sm text-gray-500">
              <svg class="w-4 h-4 animate-spin hidden" data-city-selector-target="locationSpinner" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
              </svg>
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"></path>
              </svg>
              <span data-city-selector-target="locationText">点击上方按钮开启定位</span>
            </div>
          </div>

          <!-- 历史/推荐 -->
          <div class="px-4 py-3 border-b">
            <h3 class="text-sm font-bold text-gray-700 mb-3">历史/推荐</h3>
            <div class="text-sm text-gray-400">暂无历史记录</div>
          </div>

          <!-- 热门城市 -->
          <div class="p-4 border-b">
            <div class="flex items-center justify-between mb-3">
              <h3 class="text-sm font-bold text-gray-700">热门城市</h3>
            </div>
            <div class="grid grid-cols-3 gap-2">
              <% @international_cities_by_region['热门城市'].each do |city, country| %>
                <button type="button" 
                        data-city-name="<%= city %>"
                        data-country="<%= country %>"
                        data-international="true"
                        data-action="click->city-selector#selectCity"
                        class="flex flex-col items-center justify-center px-2 py-2 bg-gray-50 rounded-lg text-sm hover:bg-gray-100">
                  <span class="font-medium"><%= city %></span>
                  <span class="text-xs text-gray-400 mt-0.5"><%= country %></span>
                </button>
              <% end %>
            </div>
          </div>

          <!-- 东南亚 -->
          <div class="p-4 border-b">
            <h3 class="text-sm font-bold text-gray-700 mb-3">东南亚</h3>
            <div class="grid grid-cols-3 gap-2">
              <% @international_cities_by_region['东南亚'].each do |city, country| %>
                <button type="button" 
                        data-city-name="<%= city %>"
                        data-country="<%= country %>"
                        data-international="true"
                        data-action="click->city-selector#selectCity"
                        class="flex flex-col items-center justify-center px-2 py-2 bg-gray-50 rounded-lg text-sm hover:bg-gray-100">
                  <span class="font-medium"><%= city %></span>
                  <span class="text-xs text-gray-400 mt-0.5"><%= country %></span>
                </button>
              <% end %>
            </div>
          </div>

          <!-- 日韩 -->
          <div class="p-4 border-b">
            <h3 class="text-sm font-bold text-gray-700 mb-3">日韩</h3>
            <div class="grid grid-cols-3 gap-2">
              <% @international_cities_by_region['日韩'].each do |city, country| %>
                <button type="button" 
                        data-city-name="<%= city %>"
                        data-country="<%= country %>"
                        data-international="true"
                        data-action="click->city-selector#selectCity"
                        class="flex flex-col items-center justify-center px-2 py-2 bg-gray-50 rounded-lg text-sm hover:bg-gray-100">
                  <span class="font-medium"><%= city %></span>
                  <span class="text-xs text-gray-400 mt-0.5"><%= country %></span>
                </button>
              <% end %>
            </div>
          </div>

          <!-- 欧洲 -->
          <div class="p-4 border-b">
            <h3 class="text-sm font-bold text-gray-700 mb-3">欧洲</h3>
            <div class="grid grid-cols-3 gap-2">
              <% @international_cities_by_region['欧洲'].each do |city, country| %>
                <button type="button" 
                        data-city-name="<%= city %>"
                        data-country="<%= country %>"
                        data-international="true"
                        data-action="click->city-selector#selectCity"
                        class="flex flex-col items-center justify-center px-2 py-2 bg-gray-50 rounded-lg text-sm hover:bg-gray-100">
                  <span class="font-medium"><%= city %></span>
                  <span class="text-xs text-gray-400 mt-0.5"><%= country %></span>
                </button>
              <% end %>
            </div>
          </div>

          <!-- 美洲 -->
          <div class="p-4 border-b">
            <h3 class="text-sm font-bold text-gray-700 mb-3">美洲</h3>
            <div class="grid grid-cols-3 gap-2">
              <% @international_cities_by_region['美洲'].each do |city, country| %>
                <button type="button" 
                        data-city-name="<%= city %>"
                        data-country="<%= country %>"
                        data-international="true"
                        data-action="click->city-selector#selectCity"
                        class="flex flex-col items-center justify-center px-2 py-2 bg-gray-50 rounded-lg text-sm hover:bg-gray-100">
                  <span class="font-medium"><%= city %></span>
                  <span class="text-xs text-gray-400 mt-0.5"><%= country %></span>
                </button>
              <% end %>
            </div>
          </div>

          <!-- 大洋洲 -->
          <div class="p-4 border-b">
            <h3 class="text-sm font-bold text-gray-700 mb-3">大洋洲</h3>
            <div class="grid grid-cols-3 gap-2">
              <% @international_cities_by_region['大洋洲'].each do |city, country| %>
                <button type="button" 
                        data-city-name="<%= city %>"
                        data-country="<%= country %>"
                        data-international="true"
                        data-action="click->city-selector#selectCity"
                        class="flex flex-col items-center justify-center px-2 py-2 bg-gray-50 rounded-lg text-sm hover:bg-gray-100">
                  <span class="font-medium"><%= city %></span>
                  <span class="text-xs text-gray-400 mt-0.5"><%= country %></span>
                </button>
              <% end %>
            </div>
          </div>

          <!-- 中东非洲 -->
          <div class="p-4 border-b">
            <h3 class="text-sm font-bold text-gray-700 mb-3">中东非洲</h3>
            <div class="grid grid-cols-3 gap-2">
              <% @international_cities_by_region['中东非洲'].each do |city, country| %>
                <button type="button" 
                        data-city-name="<%= city %>"
                        data-country="<%= country %>"
                        data-international="true"
                        data-action="click->city-selector#selectCity"
                        class="flex flex-col items-center justify-center px-2 py-2 bg-gray-50 rounded-lg text-sm hover:bg-gray-100">
                  <span class="font-medium"><%= city %></span>
                  <span class="text-xs text-gray-400 mt-0.5"><%= country %></span>
                </button>
              <% end %>
            </div>
          </div>

          <!-- 字母索引 -->
          <div class="p-4">
            <h3 class="text-sm font-bold text-gray-700 mb-3">字母索引</h3>
            <div class="text-sm text-gray-400">点击上方城市快速选择</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  /* 隐藏滚动条但保留功能 */
  .no-scrollbar::-webkit-scrollbar {
    display: none;
  }
  .no-scrollbar {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
</style>
