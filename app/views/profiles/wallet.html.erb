<div class="min-h-screen bg-[#f6f6f6] pb-24">
  <!-- 顶部导航 -->
  <div class="bg-white sticky top-0 z-10 shadow-sm">
    <div class="flex items-center justify-between px-4 py-3">
      <%= link_to profile_path, class: "text-gray-600" do %>
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg>
      <% end %>
      <h1 class="text-lg font-bold">我的钱包</h1>
      <div class="w-6"></div>
    </div>
  </div>

  <%= render 'shared/flash_messages' %>

  <!-- 余额卡片 -->
  <div class="mx-4 mt-6 bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl p-6 text-white shadow-lg">
    <div class="flex items-center space-x-2 mb-2">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" />
      </svg>
      <p class="text-sm opacity-90">账户余额</p>
    </div>
    <div class="flex items-end space-x-1 mb-4">
      <span class="text-4xl font-bold">¥</span>
      <span class="text-5xl font-bold"><%= format('%.2f', @user.balance) %></span>
    </div>
    <div class="flex items-center justify-between text-xs opacity-80">
      <span>账号：<%= @user.phone.present? ? @user.phone.gsub(/(\d{3})\d{4}(\d{4})/, '\1****\2') : @user.email.split('@').first %></span>
      <span>实名认证</span>
    </div>
  </div>

  <!-- 充值区域 -->
  <div class="mx-4 mt-6 bg-white rounded-xl p-5 shadow-sm">
    <h2 class="text-base font-bold mb-4">快速充值</h2>
    
    <%= form_with url: recharge_profile_path, method: :post, local: true, class: "space-y-4" do |f| %>
      <!-- 快捷金额选择 -->
      <div class="grid grid-cols-3 gap-3">
        <% [100, 500, 1000, 2000, 5000, 10000].each do |amount| %>
          <button type="button" 
                  class="quick-amount-btn border-2 border-gray-200 rounded-lg py-3 text-center hover:border-blue-500 hover:text-blue-500 transition-colors"
                  data-amount="<%= amount %>">
            <div class="text-lg font-bold">¥<%= amount %></div>
          </button>
        <% end %>
      </div>

      <!-- 自定义金额输入 -->
      <div class="space-y-2">
        <label class="block text-sm font-medium text-gray-700">充值金额</label>
        <div class="relative">
          <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 text-lg">¥</span>
          <input type="number" 
                 name="amount" 
                 id="recharge-amount"
                 step="0.01" 
                 min="0.01"
                 max="50000"
                 placeholder="请输入充值金额" 
                 class="w-full pl-8 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-lg"
                 required>
        </div>
        <p class="text-xs text-gray-500">单次充值限额：¥0.01 - ¥50,000</p>
      </div>

      <!-- 充值须知 -->
      <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
        <div class="flex space-x-2">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-500 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          <div class="text-xs text-gray-700 space-y-1">
            <p>• 充值金额实时到账，可用于支付订单</p>
            <p>• 余额可随时查看，安全有保障</p>
            <p>• 如有疑问请联系客服</p>
          </div>
        </div>
      </div>

      <!-- 充值按钮 -->
      <button type="submit" 
              class="w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white font-bold py-3 rounded-lg hover:shadow-lg transition-shadow">
        立即充值
      </button>
    <% end %>
  </div>

  <!-- 充值记录（占位） -->
  <div class="mx-4 mt-4 bg-white rounded-xl p-5 shadow-sm">
    <h2 class="text-base font-bold mb-4">充值记录</h2>
    <div class="text-center py-8 text-gray-400">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto mb-2 opacity-30" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
      </svg>
      <p class="text-sm">暂无充值记录</p>
    </div>
  </div>
</div>

<%= render 'shared/bottom_navigation', active_tab: :profile %>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const amountInput = document.getElementById('recharge-amount');
    const quickAmountBtns = document.querySelectorAll('.quick-amount-btn');
    
    quickAmountBtns.forEach(btn => {
      btn.addEventListener('click', function() {
        const amount = this.dataset.amount;
        amountInput.value = amount;
        
        // 移除其他按钮的选中状态
        quickAmountBtns.forEach(b => {
          b.classList.remove('border-blue-500', 'text-blue-500', 'bg-blue-50');
          b.classList.add('border-gray-200');
        });
        
        // 添加当前按钮的选中状态
        this.classList.remove('border-gray-200');
        this.classList.add('border-blue-500', 'text-blue-500', 'bg-blue-50');
      });
    });
    
    // 手动输入时取消快捷按钮的选中状态
    amountInput.addEventListener('input', function() {
      quickAmountBtns.forEach(btn => {
        btn.classList.remove('border-blue-500', 'text-blue-500', 'bg-blue-50');
        btn.classList.add('border-gray-200');
      });
    });
  });
</script>
