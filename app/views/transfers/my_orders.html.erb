<div class="bg-[#F5F5F5] min-h-screen pb-20">
  <!-- Navigation Bar -->
  <div class="bg-surface border-b border-border sticky top-0 z-40">
    <div class="flex items-center justify-between px-4 py-3">
      <%= link_to root_path, class: "text-text-primary" do %>
        <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"></path>
        </svg>
      <% end %>
      <h1 class="text-lg font-bold text-text-primary">我的接送</h1>
      <div class="w-6"></div>
    </div>
  </div>

  <!-- Status Filter Tabs -->
  <div class="bg-surface border-b border-border sticky top-[56px] z-30">
    <div class="flex">
      <%= link_to my_orders_transfers_path, class: "flex-1 text-center py-3 text-sm font-medium #{params[:status].nil? ? 'text-primary border-b-2 border-primary' : 'text-text-muted'}" do %>
        全部
      <% end %>
      <%= link_to my_orders_transfers_path(status: 'pending'), class: "flex-1 text-center py-3 text-sm font-medium #{params[:status] == 'pending' ? 'text-primary border-b-2 border-primary' : 'text-text-muted'}" do %>
        待支付
      <% end %>
      <%= link_to my_orders_transfers_path(status: 'paid'), class: "flex-1 text-center py-3 text-sm font-medium #{params[:status] == 'paid' ? 'text-primary border-b-2 border-primary' : 'text-text-muted'}" do %>
        待出行
      <% end %>
      <%= link_to my_orders_transfers_path(status: 'completed'), class: "flex-1 text-center py-3 text-sm font-medium #{params[:status] == 'completed' ? 'text-primary border-b-2 border-primary' : 'text-text-muted'}" do %>
        已完成
      <% end %>
    </div>
  </div>

  <!-- Orders List -->
  <div class="px-3 pt-3 space-y-3">
    <% if @transfers.any? %>
      <% @transfers.each do |transfer| %>
        <%= link_to transfer_path(transfer), class: "block" do %>
          <div class="bg-surface rounded-xl p-4 shadow-sm">
            <!-- Order Header -->
            <div class="flex items-center justify-between mb-3">
              <div class="flex items-center">
                <span class="text-base font-medium text-text-primary mr-2">
                  <%= transfer.service_name %>
                </span>
                <span class="text-xs px-2 py-0.5 rounded <%= transfer.pending? ? 'bg-yellow-50 text-yellow-600' : transfer.paid? ? 'bg-green-50 text-green-600' : transfer.completed? ? 'bg-blue-50 text-blue-600' : 'bg-gray-50 text-gray-600' %>">
                  <%= transfer.status_text %>
                </span>
              </div>
              <svg class="w-5 h-5 text-text-muted" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
              </svg>
            </div>

            <!-- Trip Info -->
            <div class="relative pl-4 space-y-3 mb-3">
              <div class="absolute left-[5px] top-2 bottom-2 w-0.5 bg-border"></div>
              
              <!-- Start Point -->
              <div class="relative">
                <div class="absolute -left-4 top-1 w-2.5 h-2.5 rounded-full bg-[#6D81F6] border-2 border-white shadow-sm"></div>
                <div class="text-sm text-text-primary"><%= transfer.location_from %></div>
              </div>
              
              <!-- End Point -->
              <div class="relative">
                <div class="absolute -left-4 top-1 w-2.5 h-2.5 rounded-full bg-[#FF9343] border-2 border-white shadow-sm"></div>
                <div class="text-sm text-text-primary font-medium"><%= transfer.location_to %></div>
              </div>
            </div>

            <!-- Order Details -->
            <div class="flex items-center justify-between pt-3 border-t border-border text-xs text-text-muted">
              <div class="flex items-center space-x-4">
                <span><%= transfer.created_at.strftime('%Y-%m-%d %H:%M') %></span>
                <span><%= transfer.vehicle_type %></span>
              </div>
              <div class="text-base font-bold text-[#FF5000]">
                ¥<%= transfer.actual_price.to_i %>
              </div>
            </div>

            <!-- Driver Status (if paid) -->
            <% if transfer.paid? || transfer.completed? %>
              <div class="mt-3 pt-3 border-t border-border">
                <div class="flex items-center justify-between text-sm">
                  <span class="text-text-muted">司机状态</span>
                  <span class="<%= transfer.driver_status == 'accepted' ? 'text-[#00B578]' : 'text-[#FF9B00]' %> font-medium">
                    <%= transfer.driver_status_text %>
                  </span>
                </div>
              </div>
            <% end %>

            <!-- Action Buttons (if pending) -->
            <% if transfer.pending? %>
              <div class="mt-3 pt-3 border-t border-border flex items-center justify-end space-x-3">
                <%= button_to '取消订单', cancel_transfer_path(transfer), method: :patch, 
                    class: "text-sm text-text-muted border border-border rounded px-4 py-1.5",
                    form: { data: { turbo_confirm: '确认取消订单？' } } %>
                <%= link_to '去支付', transfer_path(transfer, pay_now: true), 
                    class: "text-sm text-white bg-gradient-to-r from-[#FF9B00] to-[#FF5000] rounded px-4 py-1.5" %>
              </div>
            <% end %>
          </div>
        <% end %>
      <% end %>

      <!-- Pagination -->
      <% if @transfers.total_pages > 1 %>
        <div class="flex justify-center items-center py-4 space-x-2">
          <%= paginate @transfers, theme: 'twitter-bootstrap-4', 
              nav_class: 'pagination justify-content-center',
              previous_label: '上一页',
              next_label: '下一页' %>
        </div>
      <% end %>
    <% else %>
      <!-- Empty State -->
      <div class="flex flex-col items-center justify-center py-20">
        <div class="w-32 h-32 mb-4 opacity-30">
          <svg viewBox="0 0 100 100" class="w-full h-full">
            <path d="M10,70 Q10,50 25,45 L35,30 L65,30 L75,45 Q90,50 90,70 H10 Z" fill="#E0E0E0" stroke="#CCC"/>
            <circle cx="30" cy="70" r="8" fill="#999" />
            <circle cx="70" cy="70" r="8" fill="#999" />
            <path d="M36,32 L64,32 L72,45 L28,45 Z" fill="#666" opacity="0.2"/>
          </svg>
        </div>
        <p class="text-text-muted text-sm">暂无接送订单</p>
        <%= link_to '去预约', transfers_path, class: "mt-4 btn-primary text-sm" %>
      </div>
    <% end %>
  </div>
</div>
