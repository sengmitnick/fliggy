<div class="min-h-screen bg-surface" data-controller="city-selector" data-city-selector-departure-city-value="北京" data-city-selector-destination-city-value="上海">
  <!-- Navigation Bar -->
  <div class="flex justify-between items-center px-4 py-3">
    <%= link_to :back, class: "p-2 -ml-2 text-text-primary" do %>
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M15 18l-6-6 6-6"/>
      </svg>
    <% end %>
    
    <h1 class="text-lg font-bold text-text-primary">选择航班</h1>
    
    <button class="p-2 -mr-2 text-text-primary">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
        <circle cx="5" cy="12" r="2" />
        <circle cx="12" cy="12" r="2" />
        <circle cx="19" cy="12" r="2" />
      </svg>
    </button>
  </div>

  <!-- Tabs -->
  <div class="flex justify-between px-6 mt-4 mb-6 text-base">
    <div class="text-text-muted font-medium cursor-pointer" onclick="window.showToast('精彩即将上线，敬请期待')">我的航班</div>
    <div class="text-text-primary font-bold relative cursor-pointer flex flex-col items-center">
      按起降城市
      <div class="absolute -bottom-3 w-8 h-1 bg-[#FFD800] rounded-full"></div>
    </div>
    <div class="text-text-muted font-medium cursor-pointer" onclick="window.showToast('精彩即将上线，敬请期待')">按航班号</div>
  </div>

  <!-- Search Form -->
  <%= form_with url: search_flights_transfers_path, method: :get, local: true, class: "px-6 mt-6" do |f| %>
    
    <!-- Departure/Arrival City Selection -->
    <div class="flex items-center justify-between pb-4 border-b border-border">
      <!-- Departure City -->
      <button
        type="button"
        data-action="click->city-selector#openDeparture"
        class="text-text-secondary text-lg tracking-wide w-1/3 text-left">
        <span data-city-selector-target="departure">北京</span>
      </button>

      <!-- Airplane Icon (center) -->
      <div class="relative w-12 h-12 flex items-center justify-center">
        <div class="absolute inset-0 rounded-full border border-blue-100/50 bg-gradient-to-tr from-blue-50/50 to-transparent"></div>
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" class="transform rotate-45 text-cyan-400">
          <path d="M21 16v-2l-8-5V3.5c0-.83-.67-1.5-1.5-1.5S10 2.67 10 3.5V9l-8 5v2l8-2.5V19l-2 1.5V22l3.5-1 3.5 1v-1.5L13 19v-5.5l8 2.5z" fill="currentColor"/>
        </svg>
      </div>

      <!-- Arrival City -->
      <button
        type="button"
        data-action="click->city-selector#openDestination"
        class="text-text-secondary text-lg tracking-wide w-1/3 text-right">
        <span data-city-selector-target="destination">上海</span>
      </button>
    </div>
    
    <!-- Hidden inputs for form submission -->
    <%= hidden_field_tag :departure_city, '北京', data: { 'city-selector-target': 'departureCityInput' } %>
    <%= hidden_field_tag :arrival_city, '上海', data: { 'city-selector-target': 'destinationCityInput' } %>

    <!-- Date Selection -->
    <div class="flex items-center justify-between py-6 border-b border-border cursor-pointer">
      <%= date_field_tag :departure_date, params[:departure_date] || Time.zone.today, class: 'text-text-secondary text-lg tracking-wide flex-1 border-0 p-0 focus:ring-0' %>
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M9 18l6-6-6-6"/>
      </svg>
    </div>

    <!-- Search Button -->
    <%= hidden_field_tag :transfer_type, params[:transfer_type] %>
    <%= hidden_field_tag :service_type, params[:service_type] %>
    <%= f.submit '查询', class: 'w-full bg-[#FFD800] text-text-primary text-lg font-medium py-3 rounded-full mt-10 shadow-sm active:scale-95 transition-transform cursor-pointer' %>

  <% end %>

  <!-- Flight List (if searched) -->
  <% if @flights&.any? %>
    <div class="px-4 mt-6">
      <h2 class="text-base font-bold text-text-primary mb-3">搜索结果</h2>
      <div class="space-y-2">
        <% @flights.each do |flight| %>
          <%= link_to transfers_path(
            flight_id: flight.id,
            transfer_type: params[:transfer_type],
            service_type: params[:service_type]
          ), class: "block bg-surface-elevated rounded-lg p-4 border border-border hover:border-primary transition-colors" do %>
            <div class="flex justify-between items-center">
              <div class="flex-1">
                <div class="font-bold text-text-primary text-lg"><%= flight.flight_number %></div>
                <div class="text-sm text-text-secondary mt-1">
                  <%= flight.departure_city %> → <%= flight.destination_city %>
                </div>
                <div class="text-xs text-text-muted mt-1">
                  <%= flight.departure_time&.strftime('%m月%d日 %H:%M') %> - <%= flight.arrival_time&.strftime('%H:%M') %>
                </div>
              </div>
              <svg class="w-5 h-5 text-text-muted" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
              </svg>
            </div>
          <% end %>
        <% end %>
      </div>
    </div>
  <% elsif @flights&.empty? %>
    <div class="px-4 mt-12 text-center">
      <svg class="w-16 h-16 text-text-muted mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
      </svg>
      <p class="text-text-muted">未找到符合条件的航班</p>
    </div>
  <% end %>
  
  <!-- City Selector Modal -->
  <%= render 'shared/city_selector_modal' %>
</div>
