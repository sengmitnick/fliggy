<% content_for :title, "旅行购物" %>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>

<div class="min-h-screen bg-[#f5f6f8] flex flex-col pb-16">
  
  <!-- 顶部导航栏 -->
  <div class="bg-white px-4 py-3 flex justify-between items-center sticky top-0 z-40 shadow-sm">
    <%= link_to root_path, class: "p-1" do %>
      <svg class="w-6 h-6 text-gray-800" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
      </svg>
    <% end %>
    <h1 class="text-lg font-bold text-gray-900">旅行购物</h1>
    <button class="p-1">
      <svg class="w-6 h-6 text-gray-800" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h.01M12 12h.01M19 12h.01M6 12a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0z"></path>
      </svg>
    </button>
  </div>

  <!-- 可滚动内容区域 -->
  <div class="flex-1 overflow-y-auto no-scrollbar">
    
    <!-- 顶部 Banner 背景 -->
    <div class="bg-white pb-4">
      
      <!-- 全球购福利 标题 -->
      <div class="px-4 pt-4 pb-3">
        <h2 class="text-lg font-bold text-gray-900">全球购福利</h2>
      </div>

      <!-- 四宫格卡片 -->
      <div class="px-3 grid grid-cols-2 gap-2">
        <% @featured_brands.each_with_index do |brand, index| %>
          <%= link_to brand_abroad_shop_path(brand), class: "bg-[#eff2ff] rounded-xl p-3 relative h-24 flex flex-col justify-center" do %>
            <div class="flex items-center mb-1">
              <% if brand.logo_url.present? %>
                <div class="w-5 h-5 bg-white rounded-full flex items-center justify-center text-[10px] mr-1 border border-blue-100 overflow-hidden">
                  <%= image_tag brand.logo_url, class: "w-full h-full object-cover", alt: brand.name %>
                </div>
              <% else %>
                <div class="w-5 h-5 bg-white rounded-full flex items-center justify-center text-[10px] mr-1 text-blue-600 font-bold border border-blue-100">
                  <%= brand.name[0..1] %>
                </div>
              <% end %>
              <span class="text-xs text-gray-500"><%= brand.name %></span>
            </div>
            <div class="font-bold text-gray-800 text-sm leading-tight"><%= brand.description&.truncate(20) || '优惠享不停' %></div>
            <div class="absolute right-3 top-1/2 -translate-y-1/2 w-7 h-7 bg-[#ffe033] rounded-full flex items-center justify-center">
              <svg class="w-3 h-3 text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M9 5l7 7-7 7"></path>
              </svg>
            </div>
          <% end %>
        <% end %>
      </div>

      <!-- 中间三个分类入口 -->
      <div class="px-3 mt-3 grid grid-cols-3 gap-2">
        <%= link_to search_abroad_shops_path, class: "h-16 rounded-lg bg-gradient-to-r from-[#ffe8d9] to-[#fff5ee] flex items-center justify-center relative overflow-hidden" do %>
          <div class="absolute left-[-10px] top-[-10px] w-8 h-8 rounded-full border-2 border-white opacity-30"></div>
          <span class="font-bold text-gray-800 z-10">到店优惠</span>
        <% end %>
        <%= link_to cosmeceuticals_abroad_shops_path, class: "h-16 rounded-lg bg-gradient-to-r from-[#ffe4e6] to-[#fff0f2] flex items-center justify-center relative overflow-hidden" do %>
          <div class="absolute left-[-5px] top-[10px] w-6 h-6 rounded-full bg-pink-300 opacity-20 blur-sm"></div>
          <span class="font-bold text-gray-800 z-10">药妆专享</span>
        <% end %>
        <%= link_to duty_free_abroad_shops_path, class: "h-16 rounded-lg bg-gradient-to-r from-[#e8eaff] to-[#f2f4ff] flex items-center justify-center relative overflow-hidden" do %>
          <div class="absolute right-[-5px] bottom-[-5px] w-8 h-8 border-2 border-blue-200 rounded-full opacity-40"></div>
          <span class="font-bold text-gray-800 z-10">免税店</span>
        <% end %>
      </div>

      <!-- 巴黎老佛爷 Banner (示例广告位) -->
      <div class="px-3 mt-3">
        <div class="w-full h-20 rounded-lg bg-gradient-to-r from-[#5a6c85] to-[#8fa2be] relative overflow-hidden flex items-center">
          <div class="pl-4 flex flex-col justify-center z-10 text-white">
            <div class="text-xs opacity-80 italic font-serif">Discover More</div>
            <div class="text-lg font-bold mt-0.5">探索更多品牌优惠!</div>
            <div class="text-[10px] opacity-80">精选全球品牌，专属折扣等你拿</div>
          </div>
          <svg class="absolute right-0 bottom-0 h-full w-32 text-white opacity-20" viewBox="0 0 100 100" fill="currentColor">
            <path d="M50 0 L100 100 L0 100 Z" />
          </svg>
        </div>
      </div>
    </div>

    <!-- 商品瀑布流 (显示所有品牌) -->
    <div class="p-2 grid grid-cols-2 gap-2">
      <% @all_brands.each do |brand| %>
        <%= link_to brand_abroad_shop_path(brand), class: "bg-white rounded-lg overflow-hidden pb-2 shadow-sm" do %>
          <div class="aspect-[4/5] bg-gray-200 relative overflow-hidden">
            <% if brand.logo_url.present? %>
              <%= image_tag brand.logo_url, class: "w-full h-full object-cover", alt: brand.name %>
            <% else %>
              <div class="w-full h-full bg-gradient-to-br from-blue-100 to-blue-200 flex items-center justify-center">
                <span class="text-4xl font-bold text-blue-600"><%= brand.name[0] %></span>
              </div>
            <% end %>
            <div class="absolute bottom-0 w-full h-1/3 bg-gradient-to-t from-black/20 to-transparent"></div>
          </div>
          <div class="px-2 mt-2">
            <div class="text-sm text-gray-900 font-medium leading-5 line-clamp-2">
              <%= brand.name %>
            </div>
            <div class="mt-1.5 flex flex-wrap gap-1">
              <span class="bg-[#fff1eb] text-[#ff5000] text-[10px] px-1 py-0.5 rounded">
                <%= brand.category_text %>
              </span>
              <% if brand.featured? %>
                <span class="bg-[#ffe033] text-gray-800 text-[10px] px-1 py-0.5 rounded">精选</span>
              <% end %>
            </div>
            <div class="mt-2">
              <div class="text-xs text-gray-600 line-clamp-2"><%= brand.description %></div>
            </div>
          </div>
        <% end %>
      <% end %>
    </div>

  </div>

  <!-- 底部Tab导航 -->
  <div class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 z-50">
    <div class="max-w-[480px] mx-auto flex justify-around items-center h-16">
      <%= link_to abroad_shops_path, class: "flex flex-col items-center justify-center flex-1 text-xs" do %>
        <svg class="w-6 h-6 text-[#ff5000]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
        </svg>
        <span class="mt-1 text-[#ff5000] font-medium">首页</span>
      <% end %>
      
      <%= link_to wallet_abroad_coupons_path, class: "flex flex-col items-center justify-center flex-1 text-xs" do %>
        <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path>
        </svg>
        <span class="mt-1 text-gray-600">卡券</span>
      <% end %>
    </div>
  </div>

</div>
