<div class="min-h-screen bg-surface pb-20" data-controller="cruise-search">
  <!-- Header with Route Dropdown -->
  <div class="sticky top-0 z-20 bg-white border-b border-gray-200">
    <div class="max-w-7xl mx-auto px-4 py-3">
      <div class="flex items-center gap-3">
        <%= link_to cruises_path, class: "text-gray-700" do %>
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
          </svg>
        <% end %>
        
        <!-- Route Selector Dropdown -->
        <div class="flex-1 flex items-center justify-center">
          <button class="flex items-center gap-2 text-lg font-semibold text-gray-900" data-action="click->cruise-search#toggleRouteDropdown">
            <% if @selected_route.present? %>
              <%= @selected_route.name %>Ëà™Á∫ø
            <% else %>
              ÈÄâÊã©Ëà™Á∫ø
            <% end %>
            <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
            </svg>
          </button>
        </div>

        <!-- Right Icons -->
        <div class="flex items-center gap-2">
          <button class="p-2 text-gray-500">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"/>
            </svg>
          </button>
          <button class="p-2 text-gray-500">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"/>
            </svg>
          </button>
        </div>
      </div>

      <!-- Route Dropdown Panel -->
      <div class="hidden absolute top-full left-0 right-0 bg-white border-b border-gray-200 shadow-lg" data-cruise-search-target="routeDropdown">
        <div class="max-w-7xl mx-auto px-4 py-4">
          <div class="grid grid-cols-5 gap-3">
            <% @cruise_routes.each do |route| %>
              <% is_selected = @selected_route&.id == route.id %>
              <%= link_to search_cruises_path(route: route.id), class: "flex flex-col items-center gap-2 p-3 rounded-lg transition #{is_selected ? 'bg-primary/10 border-2 border-primary' : 'hover:bg-gray-50'}" do %>
                <% if route.icon_url.present? %>
                  <%= image_tag route.icon_url, alt: route.name, class: "w-12 h-12 object-contain" %>
                <% else %>
                  <div class="w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center">
                    <svg class="w-6 h-6 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
                    </svg>
                  </div>
                <% end %>
                <span class="text-sm text-center <%= is_selected ? 'text-primary font-semibold' : 'text-gray-700' %>"><%= route.name %></span>
              <% end %>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>

  <% if @sailings.any? %>
    <% 
      # Ëé∑ÂèñÁ¨¨‰∏Ä‰∏™Áè≠Ê¨°‰Ωú‰∏∫ÈªòËÆ§Â±ïÁ§∫
      first_sailing = @sailings.first
      cruise_ship = first_sailing.cruise_ship
      cruise_line = cruise_ship.cruise_line
    %>
    
    <!-- Cruise Line Selector (Horizontal Scroll) -->
    <section class="bg-white border-b border-gray-100">
      <div class="max-w-7xl mx-auto px-4 py-4">
        <div class="flex gap-3 overflow-x-auto pb-2" data-cruise-search-target="cruiseLineContainer">
          <% 
            # Ëé∑ÂèñËØ•Ëà™Á∫ø‰∏ãÁöÑÊâÄÊúâÈÇÆËΩÆÂÖ¨Âè∏
            cruise_lines = @sailings.map { |s| s.cruise_ship.cruise_line }.uniq
            cruise_lines.each_with_index do |line, index|
          %>
            <button class="flex-none flex flex-col items-center gap-2 p-3 rounded-lg border-2 transition <%= index == 0 ? 'border-yellow-400 bg-yellow-50' : 'border-gray-200 hover:border-gray-300' %>"
                    data-action="click->cruise-search#selectCruiseLine"
                    data-cruise-line-id="<%= line.id %>">
              <% if line.logo_url.present? %>
                <%= image_tag line.logo_url, alt: line.name, class: "w-16 h-16 object-contain" %>
              <% else %>
                <div class="w-16 h-16 rounded-lg bg-gray-100 flex items-center justify-center">
                  <span class="text-2xl">üö¢</span>
                </div>
              <% end %>
              <span class="text-xs text-gray-700 text-center whitespace-nowrap"><%= line.name %></span>
            </button>
          <% end %>
        </div>
      </div>
    </section>

    <!-- Cruise Ship Card -->
    <section class="bg-white">
      <div class="max-w-7xl mx-auto">
        <!-- Ship Image with Background -->
        <div class="relative h-56 bg-gradient-to-br from-blue-400 to-blue-600">
          <%= image_tag cruise_ship.image_url, alt: cruise_ship.name, class: "w-full h-full object-cover mix-blend-overlay opacity-80" %>
          
          <!-- Ship Info Overlay -->
          <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent p-4">
            <div class="flex items-end justify-between">
              <div>
                <h2 class="text-2xl font-bold text-white mb-1"><%= cruise_ship.name %></h2>
                <p class="text-white/90 text-sm"><%= cruise_ship.name_en %></p>
              </div>
              <% if cruise_line.logo_url.present? %>
                <div class="bg-white rounded-lg p-2">
                  <%= image_tag cruise_line.logo_url, alt: cruise_line.name, class: "h-8 object-contain" %>
                </div>
              <% end %>
            </div>
          </div>
        </div>

        <!-- Ship Features Tags -->
        <div class="px-4 py-3 border-b border-gray-100">
          <div class="flex items-center gap-2 overflow-x-auto">
            <% if cruise_ship.features.present? %>
              <% cruise_ship.feature_list.take(6).each do |feature| %>
                <span class="flex-none inline-flex items-center gap-1 px-3 py-1.5 bg-gray-50 text-gray-700 text-xs rounded-full border border-gray-200">
                  <%= feature %>
                </span>
              <% end %>
            <% end %>
          </div>
        </div>
      </div>
    </section>

    <!-- Tabs: Overview, Entertainment, Dining, Facilities, Cabins -->
    <section class="bg-white border-b border-gray-100 sticky top-[57px] z-10">
      <div class="max-w-7xl mx-auto px-4">
        <div class="flex gap-6 overflow-x-auto">
          <button class="flex-none py-3 px-1 text-sm font-medium border-b-2 border-yellow-400 text-gray-900" data-cruise-search-target="tab" data-tab="overview">
            Ê¶ÇËßà
          </button>
          <button class="flex-none py-3 px-1 text-sm font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-900" data-cruise-search-target="tab" data-tab="entertainment">
            Áé©‰πê
          </button>
          <button class="flex-none py-3 px-1 text-sm font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-900" data-cruise-search-target="tab" data-tab="dining">
            ÁæéÈ£ü
          </button>
          <button class="flex-none py-3 px-1 text-sm font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-900" data-cruise-search-target="tab" data-tab="facilities">
            ËÆæÊñΩ
          </button>
          <button class="flex-none py-3 px-1 text-sm font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-900" data-cruise-search-target="tab" data-tab="cabins">
            Ëà±Êàø
          </button>
        </div>
      </div>
    </section>

    <!-- Departure City & Month Selector (Yellow Background) -->
    <section class="bg-yellow-50 border-b border-yellow-100">
      <div class="max-w-7xl mx-auto px-4 py-4">
        <div class="flex items-center gap-4">
          <!-- Departure City -->
          <div class="flex-1 relative">
            <button class="w-full flex items-center justify-between px-4 py-3 bg-white rounded-lg border border-gray-200 hover:border-yellow-400 transition"
                    data-action="click->cruise-search#toggleCityDropdown">
              <div class="flex items-center gap-2">
                <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                </svg>
                <div class="text-left">
                  <div class="text-xs text-gray-500">Á≠õÈÄâÁôªËàπÂüéÂ∏Ç</div>
                  <div class="text-sm font-medium text-gray-900">
                    <%= params[:city].presence || 'ÂÖ®ÈÉ®ÂüéÂ∏Ç' %>
                  </div>
                </div>
              </div>
              <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
              </svg>
            </button>
            
            <!-- City Dropdown Panel -->
            <div class="hidden absolute top-full left-0 right-0 mt-2 bg-white rounded-lg shadow-lg border border-gray-200 z-20"
                 data-cruise-search-target="cityDropdown">
              <div class="p-3 max-h-64 overflow-y-auto">
                <% departure_cities = @sailings.pluck(:departure_port).uniq.compact %>
                
                <%= link_to 'ÂÖ®ÈÉ®ÂüéÂ∏Ç', search_cruises_path(route: params[:route]), class: 'block px-4 py-2 text-sm text-gray-700 hover:bg-yellow-50 rounded transition' %>
                
                <% departure_cities.each do |city| %>
                  <%= link_to city, search_cruises_path(route: params[:route], city: city), class: 'block px-4 py-2 text-sm text-gray-700 hover:bg-yellow-50 rounded transition' %>
                <% end %>
              </div>
            </div>
          </div>

          <!-- Departure Month -->
          <div class="flex-1 relative">
            <button class="w-full flex items-center justify-between px-4 py-3 bg-white rounded-lg border border-gray-200 hover:border-yellow-400 transition"
                    data-action="click->cruise-search#toggleMonthDropdown">
              <div class="flex items-center gap-2">
                <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                </svg>
                <div class="text-left">
                  <div class="text-xs text-gray-500">Á≠õÈÄâÂá∫ÂèëÊúà‰ªΩ</div>
                  <div class="text-sm font-medium text-gray-900">
                    <% if params[:month].present? %>
                      <%= Date.parse("#{params[:month]}-01").strftime('%YÂπ¥%mÊúà') %>
                    <% else %>
                      ÂÖ®ÈÉ®Êúà‰ªΩ
                    <% end %>
                  </div>
                </div>
              </div>
              <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
              </svg>
            </button>
            
            <!-- Month Dropdown Panel -->
            <div class="hidden absolute top-full left-0 right-0 mt-2 bg-white rounded-lg shadow-lg border border-gray-200 z-20"
                 data-cruise-search-target="monthDropdown">
              <div class="p-3 max-h-64 overflow-y-auto">
                <% 
                  # Ëé∑ÂèñÊâÄÊúâÂèØÁî®ÁöÑÊúà‰ªΩ
                  departure_months = @sailings.pluck(:departure_date).compact.map { |d| d.strftime('%Y-%m') }.uniq.sort
                %>
                
                <%= link_to 'ÂÖ®ÈÉ®Êúà‰ªΩ', search_cruises_path(route: params[:route], city: params[:city]), class: 'block px-4 py-2 text-sm text-gray-700 hover:bg-yellow-50 rounded transition' %>
                
                <% departure_months.each do |month| %>
                  <% month_date = Date.parse("#{month}-01") %>
                  <%= link_to month_date.strftime('%YÂπ¥%mÊúà'), search_cruises_path(route: params[:route], city: params[:city], month: month), class: 'block px-4 py-2 text-sm text-gray-700 hover:bg-yellow-50 rounded transition' %>
                <% end %>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Sailing Dates List -->
    <section class="bg-white">
      <div class="max-w-7xl mx-auto px-4 py-4">
        <div class="space-y-3">
          <% @sailings.group_by(&:cruise_ship_id).first&.last&.take(5)&.each do |sailing| %>
            <%= link_to cruise_path(sailing.cruise_ship.slug, sailing_id: sailing.id), class: "block" do %>
              <div class="flex items-center justify-between p-4 bg-yellow-50 rounded-lg border border-yellow-200 hover:shadow-sm transition">
                <!-- Date Info -->
                <div class="flex-1">
                  <div class="flex items-baseline gap-2 mb-1">
                    <span class="text-base font-semibold text-gray-900">
                      <%= sailing.departure_date.strftime('%mÊúà%dÊó•') %> Âá∫Âèë
                    </span>
                    <span class="text-sm text-gray-500">| <%= sailing.departure_port %></span>
                  </div>
                  <div class="flex items-center gap-4 text-sm text-gray-600">
                    <div class="flex items-center gap-1">
                      <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                      </svg>
                      <span><%= sailing.cruise_route.name %>Ëà™Á∫ø ¬∑ <%= sailing.duration_days %>Â§©<%= sailing.duration_nights %>Êôö</span>
                    </div>
                    <div class="flex items-center gap-1">
                      <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                      </svg>
                      <span><%= sailing.departure_port %> - <%= sailing.arrival_port %></span>
                    </div>
                  </div>
                </div>

                <!-- Check Button -->
                <button class="flex-none ml-4 px-4 py-2 bg-yellow-400 text-gray-900 text-sm font-medium rounded-full hover:bg-yellow-500 transition flex items-center gap-1">
                  Êü•ÁúãË°åÁ®ã
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                  </svg>
                </button>
              </div>
            <% end %>
          <% end %>
        </div>
      </div>
    </section>

    <!-- Cabin Selection -->
    <section class="bg-surface pt-4 pb-8">
      <div class="max-w-7xl mx-auto px-4">
        <h3 class="text-base font-semibold text-gray-900 mb-4">ÈÄâÊã©Ëà±Êàø</h3>
        
        <div class="flex gap-3 overflow-x-auto pb-2">
          <% 
            # Ëé∑ÂèñÁ¨¨‰∏Ä‰∏™Ëà™Áè≠ÁöÑËà±ÊàøÁ±ªÂûã
            cabin_types = cruise_ship.cabin_types.order(:category).take(4)
            cabin_types.each_with_index do |cabin_type, index|
          %>
            <%= link_to cruise_path(cruise_ship.slug, sailing_id: first_sailing.id, cabin_type_id: cabin_type.id), class: "flex-none w-32" do %>
              <div class="bg-white rounded-lg overflow-hidden border border-gray-200 hover:shadow-md transition <%= index == 0 ? 'ring-2 ring-yellow-400' : '' %>">
                <!-- Cabin Image -->
                <% if cabin_type.image_urls.present? && cabin_type.image_urls.first %>
                  <%= image_tag cabin_type.image_urls.first, alt: cabin_type.name, class: "w-full h-24 object-cover" %>
                <% else %>
                  <div class="w-full h-24 bg-gray-100 flex items-center justify-center">
                    <svg class="w-8 h-8 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                    </svg>
                  </div>
                <% end %>
                
                <!-- Cabin Info -->
                <div class="p-3">
                  <div class="text-sm font-medium text-gray-900 mb-1"><%= cabin_type.name %></div>
                  <div class="text-xs text-gray-500 mb-2 line-clamp-2">
                    <%= cabin_type.feature_badges.take(2).join(' ¬∑ ') %>
                  </div>
                  <% 
                    min_product = first_sailing.cruise_products.where(cabin_type: cabin_type, status: 'on_sale').order(:price_per_person).first
                  %>
                  <% if min_product %>
                    <div class="text-sm">
                      <span class="text-xs text-primary">¬•</span>
                      <span class="font-bold text-primary"><%= min_product.price_per_person %></span>
                    </div>
                  <% end %>
                </div>
              </div>
            <% end %>
          <% end %>
        </div>
      </div>
    </section>

    <!-- Expandable Description Section -->
    <section class="bg-white border-t border-gray-100">
      <div class="max-w-7xl mx-auto px-4 py-4">
        <button class="w-full flex items-center justify-between text-left">
          <div class="flex-1">
            <h3 class="text-base font-semibold text-gray-900 mb-1">ÈÉ®ÂàÜÈÅÆÊå°|Ë∂ÖÂÄºÂÆ∂Â∫≠Èò≥...</h3>
            <div class="flex items-center gap-3 text-xs text-gray-600">
              <span class="inline-flex items-center gap-1">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"/>
                </svg>
                6.8-13Â±Ç
              </span>
              <span class="inline-flex items-center gap-1">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8h16M4 16h16"/>
                </svg>
                Èù¢ÁßØ18m¬≤
              </span>
              <span class="inline-flex items-center gap-1 px-2 py-0.5 bg-gray-100 rounded">
                ÊúâÈò≥Âè∞
              </span>
              <span class="inline-flex items-center gap-1 px-2 py-0.5 bg-gray-100 rounded">
                ÊúâÁ™óÊà∑
              </span>
            </div>
          </div>
          <svg class="w-5 h-5 text-gray-400 flex-none ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"/>
          </svg>
        </button>
        
        <p class="mt-3 text-sm text-gray-600 leading-relaxed">
          Âú®ËàíÈÄÇÁöÑÈò≥Âè∞‰∏äËÅÜÂê¨Â§ßÊµ∑ÁöÑÂ£∞Èü≥ÔºåÊîæÊùæË∫´ÂøÉ‰∫´ÂèóÁæéÂ¶ôÂÅáÊúü„ÄÇ
        </p>
      </div>
    </section>

  <% else %>
    <!-- Empty State -->
    <div class="max-w-7xl mx-auto px-4 py-20 text-center">
      <svg class="w-20 h-20 mx-auto text-gray-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
      </svg>
      <h3 class="text-lg font-medium text-gray-900 mb-2">ÊöÇÊó†ÂèØÈ¢ÑËÆ¢ÁöÑÊ∏∏ËΩÆ</h3>
      <p class="text-gray-500 mb-4">ËØ•Ëà™Á∫øÊöÇÊó∂Ê≤°ÊúâÂú®ÂîÆÁè≠Ê¨°</p>
      <%= link_to cruises_path, class: "inline-flex items-center gap-2 px-6 py-3 bg-primary text-white rounded-lg hover:bg-primary-dark transition" do %>
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
        </svg>
        ËøîÂõûÈ¶ñÈ°µ
      <% end %>
    </div>
  <% end %>
</div>
