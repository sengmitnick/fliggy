<div class="bg-surface min-h-screen pb-24">
  <!-- 顶部导航 -->
  <header class="sticky top-0 z-50 bg-white shadow-sm">
    <div class="flex items-center justify-between px-4 py-3">
      <%= link_to root_path, class: "p-1" do %>
        <svg class="w-6 h-6 text-gray-800" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
      <% end %>
      <h1 class="text-lg font-bold">我的保险</h1>
      <button class="p-1">
        <svg class="w-6 h-6 text-gray-800" fill="currentColor" viewBox="0 0 24 24"><path d="M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"></path></svg>
      </button>
    </div>

    <!-- 筛选标签栏 -->
    <div class="px-4 py-2 border-t border-gray-100 flex gap-2 overflow-x-auto no-scrollbar">
      <%= link_to my_orders_insurance_orders_path, 
        class: "px-4 py-1.5 rounded-full text-sm font-medium transition-colors #{params[:status].blank? ? 'bg-primary text-gray-900' : 'bg-white text-gray-700 border border-gray-200'}" do %>
        全部
      <% end %>
      <%= link_to my_orders_insurance_orders_path(status: 'pending'), 
        class: "px-4 py-1.5 rounded-full text-sm font-medium transition-colors #{params[:status] == 'pending' ? 'bg-primary text-gray-900' : 'bg-white text-gray-700 border border-gray-200'}" do %>
        待支付
      <% end %>
      <%= link_to my_orders_insurance_orders_path(status: 'effective'), 
        class: "px-4 py-1.5 rounded-full text-sm font-medium transition-colors #{params[:status] == 'effective' ? 'bg-primary text-gray-900' : 'bg-white text-gray-700 border border-gray-200'}" do %>
        保障中
      <% end %>
      <%= link_to my_orders_insurance_orders_path(status: 'expired'), 
        class: "px-4 py-1.5 rounded-full text-sm font-medium transition-colors #{params[:status] == 'expired' ? 'bg-primary text-gray-900' : 'bg-white text-gray-700 border border-gray-200'}" do %>
        已过期
      <% end %>
    </div>
  </header>

  <!-- 订单列表 -->
  <section class="mt-4 px-4 space-y-3">
    <% if @orders.any? %>
      <% @orders.each do |order| %>
        <%= link_to insurance_order_path(order), class: "block bg-white rounded-2xl p-4 shadow-sm border border-gray-100 hover:shadow-md transition-shadow" do %>
          <!-- 订单状态标签 -->
          <div class="flex items-center justify-between mb-3">
            <span class="text-xs font-medium px-3 py-1 rounded-full <%= case order.status
              when 'pending' then 'bg-orange-50 text-orange-600 border border-orange-100'
              when 'paid' then 'bg-blue-50 text-blue-600 border border-blue-100'
              when 'effective' then 'bg-green-50 text-green-600 border border-green-100'
              when 'expired' then 'bg-gray-50 text-gray-600 border border-gray-100'
              when 'cancelled' then 'bg-red-50 text-red-600 border border-red-100'
              else 'bg-gray-50 text-gray-600'
              end %>">
              <%= order.status_name %>
            </span>
            <span class="text-xs text-gray-400"><%= order.created_at.strftime('%Y-%m-%d') %></span>
          </div>

          <!-- 产品信息 -->
          <div class="flex gap-3 mb-3">
            <% if order.insurance_product.image_url.present? %>
              <div class="w-20 h-20 rounded-xl overflow-hidden bg-gray-100 flex-shrink-0">
                <img src="<%= order.insurance_product.image_url %>" alt="<%= order.insurance_product.name %>" class="w-full h-full object-cover">
              </div>
            <% else %>
              <div class="w-20 h-20 rounded-xl bg-gradient-to-br from-blue-100 to-purple-100 flex items-center justify-center flex-shrink-0">
                <svg class="w-10 h-10 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>
              </div>
            <% end %>

            <div class="flex-1 min-w-0">
              <h3 class="font-bold text-sm text-gray-900 mb-1 line-clamp-1"><%= order.insurance_product.name %></h3>
              <div class="text-xs text-gray-500 mb-2"><%= order.insurance_product.company %></div>
              <div class="flex items-center text-xs text-gray-600">
                <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
                <%= order.start_date.strftime('%m-%d') %> ~ <%= order.end_date.strftime('%m-%d') %> · <%= order.days %>天
              </div>
            </div>
          </div>

          <!-- 被保人信息 -->
          <div class="mb-3 py-2 px-3 bg-gray-50 rounded-lg">
            <div class="flex items-center text-xs text-gray-600">
              <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
              被保人: <%= order.insured_persons.map { |p| p['name'] }.join(', ') %>
            </div>
          </div>

          <!-- 价格和操作 -->
          <div class="flex items-center justify-between pt-3 border-t border-gray-100">
            <div class="flex items-baseline">
              <span class="text-xs text-gray-500">¥</span>
              <span class="text-xl font-bold text-orange-600"><%= order.total_price.to_i %></span>
            </div>

            <% if order.pending? %>
              <div class="flex gap-2">
                <span class="px-4 py-1.5 bg-gray-100 text-gray-700 text-sm rounded-full">取消</span>
                <span class="px-4 py-1.5 bg-primary text-gray-900 text-sm font-bold rounded-full">立即支付</span>
              </div>
            <% elsif order.effective? %>
              <span class="text-sm text-primary font-medium">查看电子保单 ></span>
            <% else %>
              <span class="text-sm text-gray-500">查看详情 ></span>
            <% end %>
          </div>
        <% end %>
      <% end %>

      <!-- 分页 -->
      <% if @orders.total_pages > 1 %>
        <div class="flex justify-center py-6">
          <%= paginate @orders, theme: 'twitter-bootstrap-4' %>
        </div>
      <% end %>
    <% else %>
      <!-- 空状态 -->
      <div class="text-center py-20">
        <svg class="w-24 h-24 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
        <div class="text-gray-500 text-base mb-2">暂无保险订单</div>
        <div class="text-gray-400 text-sm mb-6">为您的旅程增添一份安心保障</div>
        <%= link_to "去投保", insurances_path, class: "inline-block px-6 py-2 bg-primary text-gray-900 font-bold rounded-full hover:opacity-90 transition-opacity" %>
      </div>
    <% end %>
  </section>
</div>

<%= render 'shared/bottom_navigation' %>
