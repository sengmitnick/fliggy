<div data-controller="data-plan">
<!-- 主要内容区域 -->
<div class="bg-white px-4 pt-6 pb-4">
  
  <!-- 手机号区域 -->
  <div class="mb-5">
    <div class="flex items-center space-x-3 mb-1">
      <% phone_number = current_user.passengers.first&.phone || current_user.addresses.first&.phone || '180 2712 8600' %>
      <span class="text-2xl font-bold font-sans tracking-wide"><%= phone_number %></span>
      <span class="text-xs text-gray-400 bg-gray-100 px-1 py-0.5 rounded">中国电信</span>
    </div>
  </div>

  <!-- 漫游说明 -->
  <div class="mb-4">
    <div class="flex items-center mb-2">
      <span class="text-[15px] font-bold mr-2">4G/5G漫游</span>
      <span class="text-sm text-gray-500">网速更快且支持境内APP</span>
    </div>
    
    <!-- 黄色标签 -->
    <div class="flex items-center gap-2 mb-2">
      <div class="inline-flex items-center bg-[#FFF8D6] border border-[#FFEBA4] rounded px-2 py-1 cursor-pointer" 
           data-action="click->data-plan#switchPlanType" 
           data-plan-type="天包"
           data-data-plan-target="typeTab">
        <span class="text-xs text-gray-800">国际漫游天包</span>
        <div class="ml-1 w-2 h-2 bg-[#FFD200] rounded-full flex items-center justify-center text-[6px]">✓</div>
      </div>
      <div class="inline-flex items-center bg-gray-100 border border-gray-200 rounded px-2 py-1 cursor-pointer" 
           data-action="click->data-plan#switchPlanType" 
           data-plan-type="月包"
           data-data-plan-target="typeTab">
        <span class="text-xs text-gray-600">国际漫游月包</span>
      </div>
      <div class="inline-flex items-center bg-gray-100 border border-gray-200 rounded px-2 py-1 cursor-pointer" 
           data-action="click->data-plan#switchPlanType" 
           data-plan-type="语音包"
           data-data-plan-target="typeTab">
        <span class="text-xs text-gray-600">语音包</span>
      </div>
    </div>

    <!-- 蓝色说明 -->
    <div class="flex items-start text-xs text-gray-500 leading-tight mt-1">
      <svg class="w-3.5 h-3.5 text-blue-500 mr-1 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
      </svg>
      <span><span class="text-blue-500">说明：</span>当日用量达到0.4GB将降速至384kbps，次日0时恢复（以北京时间为准）</span>
    </div>
  </div>

  <!-- 套餐 Grid -->
  <div class="grid grid-cols-2 gap-3 mb-8">
    <% @data_plans.each_with_index do |plan, index| %>
      <div class="relative <%= index == 0 ? 'bg-[#FFF9E6] border border-[#FFD200]' : 'bg-[#F7F8FA]' %> rounded-lg p-3 flex flex-col justify-between h-[100px]" 
           data-action="click->data-plan#selectPlan" 
           data-plan-id="<%= plan.id %>" 
           data-plan-price="<%= plan.price %>"
           data-plan-type="<%= plan.plan_type %>"
           data-data-plan-target="planCard">
        <div class="text-sm font-bold text-gray-800 leading-snug">
          <%= plan.name %>
        </div>
        <div class="text-[#FF4D30] font-bold text-lg">
          ¥<span class="text-xl"><%= plan.price.to_i %></span>
        </div>
        <% if index == 0 %>
          <!-- 右下角对勾 -->
          <div class="absolute bottom-0 right-0 w-0 h-0 border-solid border-[0_0_20px_24px] border-transparent border-b-[#FFD200] rounded-br-lg">
            <svg class="absolute bottom-[-16px] right-[2px] w-2 h-2 text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="4">
              <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path>
            </svg>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>

  <div class="text-right text-xs text-gray-400 mb-8">
    *套餐服务由xintv通讯旗舰店提供
  </div>

  <!-- 灰色分割条 -->
  <div class="h-2 bg-gray-50 -mx-4 mb-6"></div>

  <!-- 预订须知 -->
  <div class="mb-8">
    <div class="flex justify-between items-center mb-3">
      <h3 class="font-bold text-[16px]">预订须知</h3>
      <div class="text-blue-500 text-xs flex items-center">
        查看详细规则 
        <svg class="w-3 h-3 ml-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
        </svg>
      </div>
    </div>
    <div class="text-gray-500 text-xs leading-6 space-y-1">
      <p>1. 符合实名登记或实名制认证要求的中国电信后付费用户，受理境外流量包需先开通国际/港澳台语音和数据漫游功能漫游权限；...</p>
      <p>2. 叠加规则：漫游流量包产品均可叠加订购。多个相同方向或范围的漫游流量产品叠加，根据优先级顺序依次激活，只允许存在...</p>
      <p>3. 使用提醒：境外流量包激活后即开始计时，不可退订；流量包有效期内未使用完的流量不可结转...</p>
    </div>
  </div>
</div>

  <!-- 底部支付栏 -->
  <div class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 px-4 py-3 flex justify-between items-center z-50 max-w-[390px] mx-auto">
  <div class="flex items-baseline">
    <span class="text-sm text-gray-600 mr-2">总计:</span>
    <span class="text-xs text-[#FF4400]">¥</span>
    <span class="text-2xl font-bold text-[#FF4400]" data-data-plan-target="totalPrice"><%= @data_plans.first&.price&.to_i || 35 %></span>
  </div>
  <%= link_to "立即支付", "#",
      class: "bg-[#FFDD00] text-black font-bold px-8 py-2.5 rounded-full hover:bg-[#FFD700] inline-block",
      data: { action: "click->data-plan#checkout", data_plan_target: "paymentButton" } %>
  </div>
</div>
