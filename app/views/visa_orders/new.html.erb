<div class="bg-bg-gray min-h-screen pb-32"
     data-controller="visa-order payment-confirmation address-selector"
     data-payment-confirmation-amount-value="<%= @total_price %>"
     data-payment-confirmation-user-email-value="<%= current_user.email %>"
     data-payment-confirmation-payment-url-value=""
     data-payment-confirmation-success-url-value=""
     data-address-selector-address-id-value="<%= @default_address&.id || '' %>">
  <!-- 顶部导航栏 -->
  <header class="relative z-10 px-4 pt-12 pb-4 flex items-center justify-between">
    <%= link_to visa_path(@country), class: "p-1" do %>
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M15 18L9 12L15 6" stroke="#000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
    <% end %>
    <h1 class="text-lg font-bold">填写订单</h1>
    <div class="w-6"></div>
  </header>

  <!-- 主内容滚动区域 -->
  <main class="relative z-10 px-3 space-y-3 pb-6">

    <!-- 1. 商品详情卡片 -->
    <div class="bg-white rounded-xl p-4 shadow-card">
      <h2 class="font-bold text-base leading-snug mb-2"><%= @country.name %> · <%= @visa_product.name %></h2>
      
      <div class="flex items-center justify-between text-xs text-text-gray mb-3 bg-gray-50 p-2 rounded">
        <span class="flex-1 truncate"><span class="text-text-light mr-2">套餐说明</span>需要<%= @visa_product.material_count %>项材料，<%= @visa_product.processing_days %>个工作日</span>
        <div class="flex items-center text-text-dark font-medium whitespace-nowrap">
          详情 
          <svg class="w-3 h-3 ml-0.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18l6-6-6-6"/></svg>
        </div>
      </div>

      <div class="flex items-center justify-between text-xs mb-3">
        <div class="flex items-center text-blue-500">
          <svg class="w-3 h-3 mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M9 12l2 2 4-4"/></svg>
          未办理全额退
        </div>
        <div class="flex items-center text-text-dark">
          详情 
          <svg class="w-3 h-3 ml-0.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18l6-6-6-6"/></svg>
        </div>
      </div>

      <div class="flex items-center justify-between pt-3 border-t border-gray-100">
        <div class="flex items-center text-xs text-text-dark font-medium">
          <svg class="w-4 h-4 mr-1 text-text-dark" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg>
          <%= @visa_product.merchant_name || '专业签证服务商' %> 为你服务
        </div>
        <div class="flex items-center text-xs text-text-gray">
          咨询 
          <svg class="w-3 h-3 ml-0.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18l6-6-6-6"/></svg>
        </div>
      </div>
    </div>

    <!-- 2. 办签人数卡片 -->
    <div class="bg-white rounded-xl p-4 shadow-card">
      <div class="flex justify-between items-center mb-1">
        <span class="font-bold text-base">办签人数</span>
        <span class="font-bold text-base">¥ <%= @unit_price.to_i %><span class="text-sm font-normal">/人</span></span>
      </div>
      
      <div class="flex justify-between items-center mb-4">
        <div class="flex items-center text-xs text-text-light">
          人群及材料详情 
          <svg class="w-3 h-3 ml-0.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18l6-6-6-6"/></svg>
        </div>
        <div class="flex items-center space-x-3" data-controller="passenger-selector">
          <button type="button" class="w-6 h-6 rounded-full border border-gray-300 flex items-center justify-center text-gray-300" data-action="click->passenger-selector#decrease">
            <svg width="12" height="2" viewBox="0 0 12 2"><rect width="12" height="2" fill="currentColor"/></svg>
          </button>
          <span class="font-bold text-lg w-4 text-center" data-passenger-selector-target="count"><%= @traveler_count %></span>
          <button type="button" class="w-6 h-6 rounded-full border border-primary-orange text-primary-orange flex items-center justify-center" data-action="click->passenger-selector#increase">
            <svg width="12" height="12" viewBox="0 0 12 12"><path d="M5 0H7V5H12V7H7V12H5V7H0V5H5V0Z" fill="currentColor"/></svg>
          </button>
        </div>
      </div>

      <% if @visa_product.supports_family %>
      <div class="bg-blue-50 rounded-lg p-3 flex justify-between items-center">
        <div>
          <div class="text-blue-600 font-bold text-sm">家庭办签</div>
          <div class="text-blue-500 text-xs mt-0.5">材料共享 价格更优</div>
        </div>
        <div class="w-12 h-7 bg-gray-200 rounded-full p-1 cursor-pointer transition-colors duration-200 ease-in-out relative">
          <div class="bg-white w-5 h-5 rounded-full shadow-sm transform transition-transform duration-200 ease-in-out translate-x-0"></div>
        </div>
      </div>
      <% end %>
    </div>

    <!-- 3. 流程时长 -->
    <div class="bg-white rounded-xl p-4 shadow-card">
      <h3 class="font-bold text-base mb-2">流程时长 <span class="text-xs font-normal text-text-light ml-1">商家收齐材料后次日起 预计<%= @visa_product.processing_days %>个工作日签证寄出</span></h3>
      
      <!-- 时间轴可视化 -->
      <div class="relative flex justify-between items-start mb-2 px-2">
        <div class="absolute top-3 left-4 right-4 h-[1px] bg-gray-200 -z-10"></div>

        <div class="flex flex-col items-center">
          <div class="w-6 h-6 rounded-full bg-blue-100 text-blue-500 flex items-center justify-center z-10 mb-2">
            <span class="text-xs">¥</span>
          </div>
          <span class="text-xs text-text-dark font-medium">预订支付</span>
          <span class="text-[10px] text-text-light mt-0.5">现在</span>
        </div>

        <div class="flex flex-col items-center">
          <div class="w-6 h-6 rounded-full bg-blue-50 text-blue-400 flex items-center justify-center z-10 mb-2 border border-blue-100">
            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><rect x="2" y="4" width="20" height="16" rx="2"/><path d="M22 10H2"/></svg>
          </div>
          <span class="text-xs text-text-dark">邮寄材料</span>
          <span class="text-[10px] text-text-light mt-0.5">自行安排</span>
        </div>

        <div class="flex flex-col items-center">
          <div class="w-6 h-6 rounded-full bg-gray-100 text-gray-400 flex items-center justify-center z-10 mb-2">
            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"/></svg>
          </div>
          <span class="text-xs text-text-dark">商家审核</span>
          <span class="text-[10px] text-text-light mt-0.5"><%= @review_days %>工作日</span>
        </div>

        <div class="flex flex-col items-center">
          <div class="w-6 h-6 rounded-full bg-gray-100 text-gray-400 flex items-center justify-center z-10 mb-2">
            <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3zM6 8a2 2 0 11-4 0 2 2 0 014 0zM16 18v-3a5.972 5.972 0 00-.75-2.906A3.005 3.005 0 0119 15v3h-3zM4.75 12.094A5.973 5.973 0 004 15v3H1v-3a3 3 0 013.75-2.906z"/></svg>
          </div>
          <span class="text-xs text-text-dark">使领馆…</span>
          <span class="text-[10px] text-text-light mt-0.5"><%= @embassy_days %>工作日</span>
        </div>

        <div class="flex flex-col items-center">
          <div class="w-6 h-6 rounded-full bg-gray-100 text-gray-400 flex items-center justify-center z-10 mb-2">
            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
          </div>
          <span class="text-xs text-text-dark">寄回签证</span>
          <span class="text-[10px] text-text-light mt-0.5"><%= @delivery_days %>工作日</span>
        </div>
      </div>

      <div class="bg-gray-50 rounded p-3 mt-4 text-xs text-text-gray leading-relaxed">
        支付后按照指定地址邮寄纸质材料。最终以实际办理完成时间为准。
      </div>
    </div>

    <!-- 4. 材料返还 -->
    <div class="bg-white rounded-xl overflow-hidden shadow-card">
      <div class="p-4 pb-2">
        <h3 class="font-bold text-base">材料返还</h3>
      </div>
      
      <div class="bg-red-50 px-4 py-2 mx-4 rounded text-xs text-price-red mb-2">
        签证办理成功后，若涉及护照寄回，将按此地址寄送
      </div>

      <div class="px-4 py-3 flex justify-between items-center border-b border-gray-50">
        <span class="text-text-light text-sm w-20">获取方式</span>
        <div class="flex-1 text-sm font-medium flex justify-between items-center">
          <span>快递 免邮</span>
          <svg class="w-4 h-4 text-gray-300" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18l6-6-6-6"/></svg>
        </div>
      </div>

      <button type="button" 
              class="w-full px-4 py-3 flex justify-between items-start text-left hover:bg-gray-50 transition-colors"
              data-action="click->address-selector#openModal">
        <span class="text-text-light text-sm w-20 pt-1">邮寄地址</span>
        <div class="flex-1 text-sm flex justify-between items-center">
          <div class="flex-1" data-address-selector-target="selectedInfo">
            <% if @delivery_address.present? %>
              <div class="font-bold mb-1">
                <span data-address-selector-target="name"><%= @contact_name %></span>
                <span data-address-selector-target="phone"><%= @contact_phone %></span>
              </div>
              <div class="text-text-dark leading-tight pr-4" data-address-selector-target="address"><%= @delivery_address %></div>
            <% else %>
              <div class="text-gray-400">请选择邮寄地址</div>
            <% end %>
          </div>
          <svg class="w-4 h-4 text-gray-300 flex-shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18l6-6-6-6"/></svg>
        </div>
      </button>
      
      <!-- Hidden field to store delivery address for order submission -->
      <input type="hidden" data-visa-order-target="deliveryAddress" value="<%= @delivery_address %>">
    </div>

    <!-- 5. 留言备注 -->
    <div class="bg-white rounded-xl p-4 shadow-card flex items-center">
      <span class="font-bold text-base w-20">留言备注</span>
      <span class="text-gray-300 text-sm">选填，请先和商家协商一致</span>
    </div>

    <!-- 6. 联系人 -->
    <div class="bg-white rounded-xl p-4 shadow-card" 
         data-controller="contact-selector"
         data-contact-selector-selected-contact-id-value="<%= @default_contact&.id || 0 %>">
      <div class="flex items-center justify-between mb-4">
        <h3 class="font-bold text-base">联系人</h3>
        <% if @contacts.any? %>
          <button type="button" 
                  data-action="click->contact-selector#openModal"
                  class="text-sm text-primary font-medium flex items-center gap-1">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"/></svg>
            切换
          </button>
        <% end %>
      </div>
      
      <% if @contacts.any? %>
        <!-- Hidden fields to store contact info -->
        <input type="hidden" data-visa-order-target="contactName" data-contact-selector-target="nameDisplay" value="<%= @default_contact&.name || @contact_name %>">
        <input type="hidden" data-visa-order-target="contactPhone" data-contact-selector-target="phoneDisplay" value="<%= @default_contact&.phone || @contact_phone %>">
        
        <div class="space-y-3">
          <div class="flex items-center">
            <span class="text-sm text-gray-600 w-20">姓名</span>
            <span class="text-sm font-medium text-gray-900" id="contact-name-display"><%= @default_contact&.name || @contact_name || '未设置' %></span>
          </div>

          <div class="flex items-center">
            <span class="text-sm text-gray-600 w-20">手机</span>
            <span class="text-sm font-medium text-gray-900" id="contact-phone-display"><%= @default_contact&.phone || @contact_phone || '未设置' %></span>
          </div>
          
          <% if @default_contact&.email.present? %>
            <div class="flex items-center">
              <span class="text-sm text-gray-600 w-20">邮箱</span>
              <span class="text-sm font-medium text-gray-900" id="contact-email-display"><%= @default_contact.email %></span>
            </div>
          <% end %>
        </div>

        <div class="mt-4 bg-blue-50 rounded-lg p-3 text-xs text-blue-700">
          <div class="flex items-start gap-2">
            <svg class="w-4 h-4 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/></svg>
            <span>联系人信息将用于订单通知和材料寄送确认</span>
          </div>
        </div>
        
        <!-- 联系人选择模态框 -->
        <div data-contact-selector-target="modal" 
             data-action="click->contact-selector#closeOnBackdrop"
             class="hidden fixed inset-0 bg-black/50 z-50 flex items-end">
          <div class="bg-white w-full rounded-t-3xl p-6 max-h-[80vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-lg font-bold">选择联系人</h3>
              <button type="button" 
                      data-action="click->contact-selector#closeModal"
                      class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
              </button>
            </div>
            
            <div class="space-y-3">
              <% @contacts.each do |contact| %>
                <button type="button"
                        data-contact-selector-target="contactItem"
                        data-contact-id="<%= contact.id %>"
                        data-contact-name="<%= contact.name %>"
                        data-contact-phone="<%= contact.phone %>"
                        data-contact-email="<%= contact.email %>"
                        data-action="click->contact-selector#selectContact"
                        class="w-full text-left p-4 rounded-xl border-2 border-gray-200 hover:border-primary transition relative">
                  
                  <% if contact.is_default %>
                    <span class="absolute top-2 right-2 text-[10px] bg-primary/10 text-primary px-2 py-0.5 rounded-full font-medium">默认</span>
                  <% end %>
                  
                  <svg class="check-icon hidden absolute top-4 right-4 w-5 h-5 text-primary" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/></svg>
                  
                  <div class="font-bold text-sm text-gray-900 mb-2"><%= contact.name %></div>
                  
                  <div class="space-y-1 text-xs text-gray-600">
                    <% if contact.phone.present? %>
                      <div class="flex items-center gap-1">
                        <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"/></svg>
                        <%= contact.phone %>
                      </div>
                    <% end %>
                    <% if contact.email.present? %>
                      <div class="flex items-center gap-1">
                        <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"/><path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"/></svg>
                        <%= contact.email %>
                      </div>
                    <% end %>
                  </div>
                </button>
              <% end %>
            </div>
            
            <div class="mt-4">
              <%= link_to '+ 添加新联系人', new_contact_path, class: 'block text-center py-3 bg-gray-100 text-gray-700 rounded-lg font-medium hover:bg-gray-200 transition' %>
            </div>
          </div>
        </div>
      <% else %>
        <!-- 无联系人时显示 -->
        <div class="text-center py-6">
          <svg class="w-12 h-12 text-gray-300 mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
          <p class="text-sm text-gray-500 mb-4">暂无联系人信息</p>
          <%= link_to '+ 添加联系人', new_contact_path, class: 'inline-block px-6 py-2 bg-primary text-white rounded-lg font-medium hover:bg-primary/90 transition' %>
        </div>
      <% end %>
    </div>

    <!-- 7. 保险 -->
    <div class="bg-white rounded-xl overflow-hidden shadow-card">
      <div class="p-4">
        <div class="flex justify-between items-center mb-4">
          <h3 class="font-bold text-base">保险</h3>
          <span class="text-xs text-gray-400">保险由华泰保险承保</span>
        </div>

        <div class="space-y-3">
          <label class="flex items-start p-3 border-2 <%= @insurance_type == 'none' ? 'border-primary' : 'border-gray-200' %> rounded-lg cursor-pointer">
            <input type="radio" name="insurance" value="none" class="mt-1 mr-3" <%= 'checked' if @insurance_type == 'none' %>>
            <div class="flex-1">
              <div class="font-bold text-sm mb-1">不购买保险</div>
            </div>
          </label>

          <label class="flex items-start p-3 border-2 <%= @insurance_type == 'basic' ? 'border-primary' : 'border-gray-200' %> rounded-lg cursor-pointer">
            <input type="radio" name="insurance" value="basic" class="mt-1 mr-3" <%= 'checked' if @insurance_type == 'basic' %>>
            <div class="flex-1">
              <div class="flex justify-between items-center mb-1">
                <div class="font-bold text-sm">基础保障</div>
                <div class="text-primary font-bold">¥50</div>
              </div>
              <div class="text-xs text-gray-500">意外伤害20万，医疗费用5万</div>
            </div>
          </label>

          <label class="flex items-start p-3 border-2 <%= @insurance_type == 'premium' ? 'border-primary' : 'border-gray-200' %> rounded-lg cursor-pointer">
            <input type="radio" name="insurance" value="premium" class="mt-1 mr-3" <%= 'checked' if @insurance_type == 'premium' %>>
            <div class="flex-1">
              <div class="flex justify-between items-center mb-1">
                <div class="font-bold text-sm">尊享保障</div>
                <div class="text-primary font-bold">¥100</div>
              </div>
              <div class="text-xs text-gray-500">意外伤害50万，医疗费用20万，财产保障</div>
            </div>
          </label>
        </div>
      </div>
    </div>

  </main>

  <!-- 底部固定支付栏 - 参考visa-tian.html样式 -->
  <footer class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-100 px-4 py-2 flex items-center justify-between z-50 shadow-footer">
    <div class="flex items-center">
      <span class="text-price-red text-xs font-bold mr-0.5">¥</span>
      <span class="text-price-red text-2xl font-bold mr-2" data-visa-order-target="totalPrice"><%= @total_price.to_i %></span>
      <div class="text-xs text-gray-400 flex items-center">
        明细
        <svg class="w-3 h-3 ml-0.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 15l7-7 7 7"/></svg>
      </div>
    </div>
    <button type="button" 
            class="bg-orange-600 text-white font-bold text-base px-8 py-2.5 rounded-full shadow-lg"
            data-action="click->visa-order#submitOrder"
            data-visa-order-target="payButton"
            data-visa-product-id="<%= @visa_product.id %>"
            data-traveler-count="<%= @traveler_count %>"
            data-total-price="<%= @total_price %>"
            data-insurance-type="<%= @insurance_type %>"
            data-insurance-price="<%= @insurance_price %>"
            data-contact-name="<%= @contact_name %>"
            data-contact-phone="<%= @contact_phone %>"
            data-delivery-address="<%= @delivery_address %>">
      立即支付
    </button>
  </footer>

  <!-- 地址选择模态框 -->
  <div class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden" data-address-selector-target="modal">
    <div class="absolute bottom-0 left-0 right-0 bg-white rounded-t-2xl max-h-[70vh] overflow-y-auto">
      <!-- Modal Header -->
      <div class="sticky top-0 bg-white border-b border-gray-200 px-4 py-3 flex items-center justify-between">
        <h3 class="text-lg font-bold">选择地址</h3>
        <button type="button" 
                class="p-2 -mr-2" 
                data-action="click->address-selector#closeModal">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>
      
      <!-- Address List -->
      <div class="p-4 space-y-3">
        <% if @addresses.any? %>
          <% @addresses.each do |address| %>
            <button type="button"
                    class="w-full text-left p-4 bg-white border-2 <%= address == @default_address ? 'border-primary' : 'border-gray-200' %> rounded-xl hover:border-primary transition-colors"
                    data-action="click->address-selector#selectAddress"
                    data-address-id="<%= address.id %>"
                    data-name="<%= address.name %>"
                    data-phone="<%= address.phone %>"
                    data-address="<%= address.full_address %>">
              <div class="flex items-center justify-between mb-2">
                <div class="flex items-center">
                  <span class="font-bold text-base"><%= address.name %></span>
                  <% if address.is_default %>
                    <span class="ml-2 px-2 py-0.5 text-xs rounded bg-orange-100 text-primary-orange">默认</span>
                  <% end %>
                </div>
              </div>
              <div class="text-sm text-gray-600 mb-2"><%= address.phone %></div>
              <div class="text-sm text-gray-700 bg-blue-50 rounded-lg p-2">
                <%= address.full_address %>
              </div>
            </button>
          <% end %>
        <% else %>
          <div class="py-12 text-center text-gray-400">
            <svg class="w-16 h-16 mx-auto mb-3 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
            </svg>
            <p class="text-base mb-2">暂无收货地址</p>
            <p class="text-sm">请先添加收货地址</p>
          </div>
        <% end %>
        
        <!-- Add New Address Button -->
        <%= link_to new_address_path, class: "block w-full py-3 mt-4 rounded-full border-2 border-gray-300 text-center font-medium text-gray-700 hover:border-primary transition-colors" do %>
          <svg class="w-5 h-5 inline-block mr-2" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"/>
          </svg>
          新增收货地址
        <% end %>
      </div>
    </div>
  </div>

  <!-- Payment Confirmation Modals -->
  <%= render 'shared/payment_confirmation_modals' %>
</div>
